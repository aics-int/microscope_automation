
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>microscope_automation.samples.samples &#8212; Microscope Automation 0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for microscope_automation.samples.samples</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Classes to describe and manipulate samples</span>
<span class="sd">Created on Jul 11, 2016</span>

<span class="sd">@author: winfriedw</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="c1"># import modules from project microscope_automation</span>
<span class="kn">from</span> <span class="nn">..get_path</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_images_path</span><span class="p">,</span>
    <span class="n">add_suffix</span><span class="p">,</span>
    <span class="n">get_well_edge_path</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.draw_plate</span> <span class="kn">import</span> <span class="n">draw_plate</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">automation_messages_form_layout</span> <span class="k">as</span> <span class="n">message</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">find_well_center</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">correct_background</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">tile_images</span>
<span class="kn">from</span> <span class="nn">..load_image_czi</span> <span class="kn">import</span> <span class="n">LoadImageCzi</span>
<span class="kn">from</span> <span class="nn">.positions_list</span> <span class="kn">import</span> <span class="n">CreateTilePositions</span>
<span class="kn">from</span> <span class="nn">.interactive_location_picker_pyqtgraph</span> <span class="kn">import</span> <span class="n">ImageLocationPicker</span>
<span class="kn">from</span> <span class="nn">..automation_exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ObjectiveNotDefinedError</span><span class="p">,</span>
    <span class="ne">FileExistsError</span><span class="p">,</span>
    <span class="n">MetaDataNotSavedError</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># we need module hardware only for testing</span>
<span class="kn">from</span> <span class="nn">..hardware</span> <span class="kn">import</span> <span class="n">hardware_components</span>

<span class="c1"># create logger</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;microscopeAutomation&quot;</span><span class="p">)</span>

<span class="c1">################################################################################</span>
<span class="c1">#</span>
<span class="c1"># constants with valid preferences values</span>
<span class="c1">#</span>
<span class="c1">################################################################################</span>

<span class="n">VALID_FUNCTIONNAME</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;initialize_microscope&quot;</span><span class="p">,</span>
    <span class="s2">&quot;set_up_objectives&quot;</span><span class="p">,</span>
    <span class="s2">&quot;update_plate_well_z_zero&quot;</span><span class="p">,</span>
    <span class="s2">&quot;calculate_plate_correction&quot;</span><span class="p">,</span>
    <span class="s2">&quot;calculate_all_wells_correction&quot;</span><span class="p">,</span>
    <span class="s2">&quot;setup_immersion_system&quot;</span><span class="p">,</span>
    <span class="s2">&quot;scan_samples&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">VALID_SETUPFILES</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_FINDLOAD</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_LASERSAFETY</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_KOEHLER</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_VERBOSE</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_USEAUTOFOCUS</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_MANUELREFOCUS</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_SNAPIMAGE</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_WAIT</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_LOAD</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_LOADBETWEENWELLS</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_ADDIMERSIONWATER</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_USEPUMP</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">VALID_TILE</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;NoTiling&quot;</span><span class="p">,</span> <span class="s2">&quot;Fixed&quot;</span><span class="p">,</span> <span class="s2">&quot;ColonySize&quot;</span><span class="p">,</span> <span class="s2">&quot;Well&quot;</span><span class="p">]</span>
<span class="n">VALID_FINDOBJECTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="s2">&quot;Cells&quot;</span><span class="p">,</span> <span class="s2">&quot;Colonies&quot;</span><span class="p">]</span>
<span class="n">VALID_TYPEFINDCELLS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="s2">&quot;CenterMassCellProfiler&quot;</span><span class="p">,</span> <span class="s2">&quot;TwofoldDistanceMap&quot;</span><span class="p">]</span>

<span class="c1">################################################################################</span>
<span class="c1">#</span>
<span class="c1"># Helper functions</span>
<span class="c1">#</span>
<span class="c1">################################################################################</span>


<div class="viewcode-block" id="create_plate"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.create_plate">[docs]</a><span class="k">def</span> <span class="nf">create_plate</span><span class="p">(</span><span class="n">plate_format</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set up coordinates for different plate layouts for standard plates to be</span>
<span class="sd">    used with class Plate.</span>

<span class="sd">    Input:</span>
<span class="sd">     plate_format: sting for format of plate (&#39;12&#39;, &#39;24&#39;, &#39;96&#39;)</span>

<span class="sd">    Output:</span>
<span class="sd">     plate_layout: dictionary to describe plate with entries</span>
<span class="sd">      name: name of plate</span>

<span class="sd">      well_diameter: diameter of well in mum</span>

<span class="sd">      well_names: (x,y) coordinates of well center in plate coordinates in mum.</span>
<span class="sd">      The center of well A1 = (0,0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plate_format</span> <span class="o">==</span> <span class="s2">&quot;12&quot;</span><span class="p">:</span>
        <span class="n">n_row</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">n_col</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="mi">26000</span>
        <span class="n">diameter</span> <span class="o">=</span> <span class="mi">22050</span>
        <span class="n">z_center_well</span> <span class="o">=</span> <span class="mi">104</span>
    <span class="k">elif</span> <span class="n">plate_format</span> <span class="o">==</span> <span class="s2">&quot;24&quot;</span><span class="p">:</span>
        <span class="n">n_row</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">n_col</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="mi">19300</span>
        <span class="n">diameter</span> <span class="o">=</span> <span class="mi">15540</span>
        <span class="n">z_center_well</span> <span class="o">=</span> <span class="mi">104</span>
    <span class="k">elif</span> <span class="n">plate_format</span> <span class="o">==</span> <span class="s2">&quot;96&quot;</span><span class="p">:</span>
        <span class="n">n_row</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">n_col</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="mi">9000</span>
        <span class="n">diameter</span> <span class="o">=</span> <span class="mi">6134</span>
        <span class="n">z_center_well</span> <span class="o">=</span> <span class="mi">104</span>

    <span class="c1"># calculate name and position of wells</span>
    <span class="c1"># Center of well A1 is considered the origin</span>
    <span class="n">plate_layout</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">plate_format</span><span class="p">,</span> <span class="s2">&quot;well_diameter&quot;</span><span class="p">:</span> <span class="n">diameter</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_col</span><span class="p">):</span>
        <span class="n">x_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">x_coord</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">pitch</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_row</span><span class="p">):</span>
            <span class="n">y_name</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
            <span class="n">y_coord</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">pitch</span>
            <span class="n">plate_layout</span><span class="p">[</span><span class="n">y_name</span> <span class="o">+</span> <span class="n">x_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span><span class="p">,</span> <span class="n">z_center_well</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plate_layout</span></div>


<div class="viewcode-block" id="create_rect_tile"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.create_rect_tile">[docs]</a><span class="k">def</span> <span class="nf">create_rect_tile</span><span class="p">(</span><span class="n">n_col</span><span class="p">,</span> <span class="n">n_row</span><span class="p">,</span> <span class="n">x_pitch</span><span class="p">,</span> <span class="n">y_pitch</span><span class="p">,</span> <span class="n">z_pos</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create coordinates for rectangular tile scan..</span>
<span class="sd">    The tiles will be centered around the current stage position.</span>

<span class="sd">    Input:</span>
<span class="sd">     n_col, n_row: number of tiles in x and y</span>

<span class="sd">     x_pitch, y_pitch: distance between tile centers in x and y</span>

<span class="sd">     z_pos: offset in z in mum</span>

<span class="sd">    Output:</span>
<span class="sd">     pos_list: list with tuples (x,y) for tile centers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pos_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n_col_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_col</span><span class="p">))</span>
    <span class="n">n_row_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_row</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">n_col_int</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_col_int</span><span class="p">)]:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="p">(</span><span class="n">n_row_int</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_row_int</span><span class="p">)]:</span>
            <span class="n">pos_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span> <span class="o">*</span> <span class="n">x_pitch</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="n">y_pitch</span><span class="p">,</span> <span class="n">z_pos</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pos_list</span></div>


<span class="c1">################################################################################</span>
<span class="c1">#</span>
<span class="c1"># Classes for sample hierarchy</span>
<span class="c1">#</span>
<span class="c1">################################################################################</span>


<div class="viewcode-block" id="ImagingSystem"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem">[docs]</a><span class="k">class</span> <span class="nc">ImagingSystem</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">container</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">image</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">x_zero</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">y_zero</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_zero</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_z_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">x_safe_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">y_safe_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">z_safe_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">reference_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">x_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">y_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">z_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">microscope_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stage_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">focus_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_focus_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">objective_changer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">camera_ids</span><span class="o">=</span><span class="p">[],</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is the superclass for all sample related classes</span>
<span class="sd">        (e.g. well, colony, etc).</span>

<span class="sd">        Input:</span>
<span class="sd">         container: class which holds this object (e.g. Plate is container for Well)</span>

<span class="sd">         name: sting name of object</span>

<span class="sd">         image: include in list of samples that will be imaged</span>

<span class="sd">         x_zero, y_zero, z_zero: position of object center in container coordinates</span>
<span class="sd">         in mum</span>

<span class="sd">         x_flip, y_flip, z_flip: -1 if coordinate system is flipped compared to</span>
<span class="sd">         container, otherwise 1. E.g. PlateHolder has origin in lower left corner,</span>
<span class="sd">         Zeiss SD stage has origin in upper left corner, thus x_flip =1 and y_flip=-1</span>

<span class="sd">         x_correction, y_correction, z_correction: correction factor for coordinate</span>
<span class="sd">         system relative to container coordinates,</span>
<span class="sd">         e.g. if 1 mum in well coordinates is not exactly 1 mum in plate coordinates.</span>

<span class="sd">         x_safe_position, y_safe_position, z_safe_position: position to start</span>
<span class="sd">         any movements without danger of objective or other collisions</span>

<span class="sd">         reference_object: any object of type sample used as reference to correct</span>
<span class="sd">         for xyz offset between different objectives.</span>
<span class="sd">         Use only one of reference object or reference positions</span>

<span class="sd">         x_ref, y_ref, z_ref: positions used as reference to correct for xyz</span>
<span class="sd">         offset between different objectives.</span>
<span class="sd">         Use only one of reference object or reference positions</span>

<span class="sd">         microscope_object: object of class Microscope from module hardware</span>

<span class="sd">         stage_id: id string for stage.</span>

<span class="sd">         focus_id: id string with name for focus drive</span>

<span class="sd">         auto_focus_id: id string with name for auto-focus</span>

<span class="sd">         objective_changer_id: id string with name for objective changer</span>

<span class="sd">         safety_id: id string for safety area that prevents objective damage</span>
<span class="sd">         during stage movement</span>

<span class="sd">         camera_ids: list with ids for cameras used with this sample</span>

<span class="sd">        Output:</span>
<span class="sd">         None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># object self is part of, is contained in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_container</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

        <span class="c1"># We can attach images to objects</span>
        <span class="c1"># E.g. images for background correction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Decide weather sample should be imaged</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># positions of object center in container coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_zero</span><span class="p">(</span><span class="n">x_zero</span><span class="p">,</span> <span class="n">y_zero</span><span class="p">,</span> <span class="n">z_zero</span><span class="p">)</span>

        <span class="c1"># set safe position for start of any movement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_safe</span><span class="p">(</span><span class="n">x_safe_position</span><span class="p">,</span> <span class="n">y_safe_position</span><span class="p">,</span> <span class="n">z_safe_position</span><span class="p">)</span>

        <span class="c1"># flip of coordinate system compared to enclosing container</span>
        <span class="c1"># e.g. typically we assume a cartesian coordinate system with origin</span>
        <span class="c1"># in the lower left corner</span>
        <span class="c1"># the Zeiss SD stage coordinates have their origin in the upper left corner,</span>
        <span class="c1"># thus the y axis of the PlateHolder is flipped by -1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_flip</span><span class="p">(</span><span class="n">x_flip</span><span class="p">,</span> <span class="n">y_flip</span><span class="p">,</span> <span class="n">z_flip</span><span class="p">)</span>

        <span class="c1"># correction for calibration.</span>
        <span class="c1"># E.g. these values can be used when well diameter or distance between wells</span>
        <span class="c1"># are used for calibration.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_correction</span><span class="p">(</span>
            <span class="n">x_correction</span><span class="p">,</span>
            <span class="n">y_correction</span><span class="p">,</span>
            <span class="n">z_correction</span><span class="p">,</span>
            <span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="n">z_correction_y_slope</span><span class="p">,</span>
            <span class="n">z_correction_z_slope</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># attach additional meta data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Directory with list of objects to be imaged</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_dirs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_hardware</span><span class="p">(</span>
            <span class="n">microscope_object</span><span class="o">=</span><span class="n">microscope_object</span><span class="p">,</span>
            <span class="n">stage_id</span><span class="o">=</span><span class="n">stage_id</span><span class="p">,</span>
            <span class="n">focus_id</span><span class="o">=</span><span class="n">focus_id</span><span class="p">,</span>
            <span class="n">auto_focus_id</span><span class="o">=</span><span class="n">auto_focus_id</span><span class="p">,</span>
            <span class="n">objective_changer_id</span><span class="o">=</span><span class="n">objective_changer_id</span><span class="p">,</span>
            <span class="n">safety_id</span><span class="o">=</span><span class="n">safety_id</span><span class="p">,</span>
            <span class="n">camera_ids</span><span class="o">=</span><span class="n">camera_ids</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># reference positions for auto-focus</span>
        <span class="c1"># when switching objective user focuses on identical object at this position.</span>
        <span class="c1"># the difference between the stored and the new position is used to calculate</span>
        <span class="c1"># par-centricity and par-focuality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_reference_object</span><span class="p">(</span><span class="n">reference_object</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_reference_position</span><span class="p">(</span><span class="n">x_ref</span><span class="p">,</span> <span class="n">y_ref</span><span class="p">,</span> <span class="n">z_ref</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_objective</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_objective_changer</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Position used to define zero position for plate z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_z_zero_pos</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;class </span><span class="si">{}</span><span class="s2">: &#39;</span><span class="si">{}</span><span class="s2">&#39;&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>

<div class="viewcode-block" id="ImagingSystem.set_hardware"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_hardware">[docs]</a>    <span class="k">def</span> <span class="nf">set_hardware</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">microscope_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stage_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">focus_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_focus_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">objective_changer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">camera_ids</span><span class="o">=</span><span class="p">[],</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store object that describes connection to hardware.</span>

<span class="sd">        Input:</span>
<span class="sd">         microscope_object: object of class Microscope from module hardware</span>

<span class="sd">         stage_id: id string for stage.</span>

<span class="sd">         focus_id: id string with name for focus drive</span>

<span class="sd">         auto_focus_id: id string with name for auto-focus</span>

<span class="sd">         objective_changer_id: id string with name for objective changer</span>

<span class="sd">         safety_id: id string for safety area that prevents objective damage</span>
<span class="sd">         during stage movement</span>

<span class="sd">         camera_ids: list with ids for cameras used with this sample</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microscope</span> <span class="o">=</span> <span class="n">microscope_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_id</span> <span class="o">=</span> <span class="n">stage_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span> <span class="o">=</span> <span class="n">focus_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_focus_id</span> <span class="o">=</span> <span class="n">auto_focus_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer_id</span> <span class="o">=</span> <span class="n">objective_changer_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safety_id</span> <span class="o">=</span> <span class="n">safety_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_ids</span> <span class="o">=</span> <span class="n">camera_ids</span></div>

<div class="viewcode-block" id="ImagingSystem.add_camera_id"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.add_camera_id">[docs]</a>    <span class="k">def</span> <span class="nf">add_camera_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add ID to camera_ids without removing the existing IDs.</span>

<span class="sd">        Input:</span>
<span class="sd">         camera_id: ID to add to the list of IDs</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">camera_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.set_name"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set name of object</span>

<span class="sd">        Input:</span>
<span class="sd">         name: string with name of object</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span></div>

<div class="viewcode-block" id="ImagingSystem.get_name"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return name of object.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         name: string name of object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>

    <span class="c1">################################################################################</span>
    <span class="c1"># Begin</span>
    <span class="c1"># Methods to find positions in image</span>
    <span class="c1">#</span>
    <span class="c1">################################################################################</span>

<div class="viewcode-block" id="ImagingSystem.set_interactive_positions"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_interactive_positions">[docs]</a>    <span class="k">def</span> <span class="nf">set_interactive_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tile_image_data</span><span class="p">,</span> <span class="n">location_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">app</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Opens up the interactive mode and lets user select colonies and</span>
<span class="sd">        return the list of coordinates selected</span>

<span class="sd">        Input:</span>
<span class="sd">        tile_image_data: The pixel data of the image of the well - numpy array</span>

<span class="sd">        location_list: The list of coordinates to be pre plotted on the image.</span>

<span class="sd">        app: pyqt application object initialized in microscopeAutomation.py</span>

<span class="sd">        Output:</span>
<span class="sd">         location_list: Returns the list of colonies selected by the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using pyqtgraph module</span>
        <span class="n">interactive_plot</span> <span class="o">=</span> <span class="n">ImageLocationPicker</span><span class="p">(</span><span class="n">tile_image_data</span><span class="p">,</span> <span class="n">location_list</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
        <span class="n">interactive_plot</span><span class="o">.</span><span class="n">plot_points</span><span class="p">(</span><span class="s2">&quot;Well Overview Image&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">interactive_plot</span><span class="o">.</span><span class="n">location_list</span></div>

    <span class="c1">#################################################################</span>
    <span class="c1">#</span>
    <span class="c1"># Methods to find positions in image</span>
    <span class="c1"># End</span>
    <span class="c1">#################################################################</span>

    <span class="c1">#################################################################</span>
    <span class="c1"># Begin</span>
    <span class="c1"># Methods to handle reference used to correct for xyz offset between objectives.</span>
    <span class="c1">#</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="ImagingSystem.set_reference_object"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_reference_object">[docs]</a>    <span class="k">def</span> <span class="nf">set_reference_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set reference object to correct for xyz offset between different objectives.</span>
<span class="sd">        Avoid setting reference positions and connect reference object to same sample.</span>

<span class="sd">        Input:</span>
<span class="sd">         reference_object: any object of type sample</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_object</span> <span class="o">=</span> <span class="n">reference_object</span></div>

<div class="viewcode-block" id="ImagingSystem.get_reference_object"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_reference_object">[docs]</a>    <span class="k">def</span> <span class="nf">get_reference_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get reference object to correct for xyz offset between different objectives.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         reference_object: any object of type sample</span>

<span class="sd">        Searches through all containers until id is found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">reference_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_object</span>
            <span class="k">if</span> <span class="n">reference_object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">reference_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_reference_object</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">reference_object</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">reference_object</span></div>

<div class="viewcode-block" id="ImagingSystem.set_reference_position"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_reference_position">[docs]</a>    <span class="k">def</span> <span class="nf">set_reference_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set position used as reference to correct for xyz offset between different</span>
<span class="sd">        objectives. Avoid setting reference positions and connect reference object to</span>
<span class="sd">        the same sample.</span>

<span class="sd">        Input:</span>
<span class="sd">         x, y, z: position of reference structure in object coordinates. Can be None</span>

<span class="sd">         Output:</span>
<span class="sd">          none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reference_object</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reference_object</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;The object {} has already the reference object {} attached.</span>
<span class="sd">                            One should avoid to use reference positions and objects at</span>
<span class="sd">                            the same time&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reference_object</span><span class="p">()</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># We have to allow to set reference positions to none during initialization</span>
        <span class="c1"># if x is None and y is None and z is None:</span>
        <span class="c1">#     return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_ref</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_ref</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_ref</span> <span class="o">=</span> <span class="n">z</span></div>

<div class="viewcode-block" id="ImagingSystem.get_reference_position"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_reference_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_reference_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return position used as reference to correct for xyz offset between</span>
<span class="sd">        different objectives.</span>

<span class="sd">        Get position from reference object if available.</span>
<span class="sd">        If none is available use zero postion</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         x, y, z: position of reference structure in object coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reference_object</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reference_object</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ref</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ref</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_ref</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;The object {} has reference positions and the reference</span>
<span class="sd">                                object {} attached. Reference positions from reference</span>
<span class="sd">                                object will be used.&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reference_object</span><span class="p">()</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reference_object</span><span class="p">()</span><span class="o">.</span><span class="n">get_reference_position</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">):</span>  <span class="c1"># noqa</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ref</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ref</span>
                <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_ref</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># reference position was not defined</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>

    <span class="c1">#################################################################</span>
    <span class="c1">#</span>
    <span class="c1"># Methods to handle reference used to correct for xyz offset between objectives.</span>
    <span class="c1"># End</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="ImagingSystem.add_samples"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.add_samples">[docs]</a>    <span class="k">def</span> <span class="nf">add_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_objects_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds samples to imaging system.</span>

<span class="sd">        Input:</span>
<span class="sd">         sample_objects_dict: dictionary of form {&#39;name&#39;: sample_object}</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sample_objects_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.get_well_object"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_well_object">[docs]</a>    <span class="k">def</span> <span class="nf">get_well_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get well object for subclass.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         well_object: object for well</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">well_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">get_well_object</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">well_object</span></div>

<div class="viewcode-block" id="ImagingSystem.set_image"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_image">[docs]</a>    <span class="k">def</span> <span class="nf">set_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define if sample should be included in imaging.</span>

<span class="sd">        Input:</span>
<span class="sd">         image: if True, include in imaging</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span></div>

<div class="viewcode-block" id="ImagingSystem.get_image"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_image">[docs]</a>    <span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return image property that defines if sample is included in imaging.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         image: if True, include in imaging</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="ImagingSystem.add_to_image_dir"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.add_to_image_dir">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_image_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_name</span><span class="p">,</span> <span class="n">sample_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add sample object to list with name list_name of objects to be imaged.</span>

<span class="sd">        Input:</span>
<span class="sd">         list_name: string with name of list (e.g. &#39;ColoniesPreScan&#39;)</span>

<span class="sd">         sample_object: object to be imaged. Can be list. List will always added at end</span>

<span class="sd">         position: position of object in list. Position will determine order of imaging.</span>
<span class="sd">          Default: None = Append to end. Has no effect if object is list.</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">list_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_dirs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_dirs</span><span class="p">[</span><span class="n">list_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample_object</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_dirs</span><span class="p">[</span><span class="n">list_name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sample_object</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sample_object</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image_dirs</span><span class="p">[</span><span class="n">list_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_object</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image_dirs</span><span class="p">[</span><span class="n">list_name</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">sample_object</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.get_from_image_dir"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_from_image_dir">[docs]</a>    <span class="k">def</span> <span class="nf">get_from_image_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get list with name list_name of objects to be imaged.</span>

<span class="sd">        Input:</span>
<span class="sd">         list_name: string with name of list (e.g. &#39;ColoniesPreScan&#39;)</span>

<span class="sd">        Output:</span>
<span class="sd">         sample_objects: list of name list_name with objects to be imaged</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sample_objects</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_dirs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">list_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_dirs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">sample_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_dirs</span><span class="p">[</span><span class="n">list_name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sample_objects</span></div>

<div class="viewcode-block" id="ImagingSystem.set_barcode"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_barcode">[docs]</a>    <span class="k">def</span> <span class="nf">set_barcode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">barcode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set barcode for plate.</span>

<span class="sd">        Input:</span>
<span class="sd">         barcode: string with barcode</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barcode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">set_barcode</span><span class="p">(</span><span class="n">barcode</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.get_barcode"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_barcode">[docs]</a>    <span class="k">def</span> <span class="nf">get_barcode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get barcode for plate.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         barcode: string with barcode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">barcode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">get_barcode</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">barcode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">barcode</span></div>

<div class="viewcode-block" id="ImagingSystem.set_container"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_container">[docs]</a>    <span class="k">def</span> <span class="nf">set_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Object is part of container object (e.g. Plate is container for Well).</span>

<span class="sd">        Input:</span>
<span class="sd">         container: object for container</span>
<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">container</span></div>

<div class="viewcode-block" id="ImagingSystem.get_container"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_container">[docs]</a>    <span class="k">def</span> <span class="nf">get_container</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return container object that encloses object.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         container: container object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span></div>

<div class="viewcode-block" id="ImagingSystem.get_sample_type"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_sample_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_sample_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return sample type.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         sample_type: string with name of object type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sample_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="n">sample_type</span></div>

<div class="viewcode-block" id="ImagingSystem.set_zero"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_zero">[docs]</a>    <span class="k">def</span> <span class="nf">set_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set center position of object in container coordinates.</span>

<span class="sd">        Input:</span>
<span class="sd">         x, y, z: position of object center in mum in coordinate system</span>
<span class="sd">         of enclosing container. If None, use current position</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x_zero, y_zero, z_zero: new center position in container coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">x_zero</span><span class="p">,</span> <span class="n">y_zero</span><span class="p">,</span> <span class="n">z_zero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_corrected_stage_position</span><span class="p">(</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x_zero</span><span class="p">,</span> <span class="n">y_zero</span><span class="p">,</span> <span class="n">z_zero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">get_pos_from_abs_pos</span><span class="p">(</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x_zero</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y_zero</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z_zero</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_zero</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_zero</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_zero</span> <span class="o">=</span> <span class="n">z</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_zero</span></div>

<div class="viewcode-block" id="ImagingSystem.update_zero"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.update_zero">[docs]</a>    <span class="k">def</span> <span class="nf">update_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update center position of object in container coordinates.</span>

<span class="sd">        Input:</span>
<span class="sd">         x, y, z: position of object center in mum in coordinate system</span>
<span class="sd">         of inclosing container. If None, use current position</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x_zero, y_zero, z_zero: new center position in container coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_zero</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_zero</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_zero</span> <span class="o">=</span> <span class="n">z</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_zero</span></div>

<div class="viewcode-block" id="ImagingSystem.get_zero"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_zero">[docs]</a>    <span class="k">def</span> <span class="nf">get_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return center of object in container coordinates.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         x_zero, y_zero, z_zero: center of object in mum in container coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_zero</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.get_abs_zero"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_abs_zero">[docs]</a>    <span class="k">def</span> <span class="nf">get_abs_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return center of object in stage coordinates.</span>

<span class="sd">        Input:</span>
<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x_zero, y_zero, z_zero: center of object in mum in stage coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_stage_zero</span><span class="p">,</span> <span class="n">y_stage_zero</span><span class="p">,</span> <span class="n">z_stage_zero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_pos_from_obj_pos</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x_stage_zero</span><span class="p">,</span> <span class="n">y_stage_zero</span><span class="p">,</span> <span class="n">z_stage_zero</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.set_safe"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_safe">[docs]</a>    <span class="k">def</span> <span class="nf">set_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set safe stage position to start any movement without danger</span>
<span class="sd">        of collision in sample coordinates.</span>

<span class="sd">        Input:</span>
<span class="sd">         x, y, z: safe position in sample coordinates.</span>

<span class="sd">        Output:</span>
<span class="sd">         x_safe, y_safe, z_safe: safe position in sample coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if input is a number or None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_safe</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_safe</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_safe</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_safe</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">z</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                <span class="s2">&quot;safe z position in load position&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z_safe</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z_safe</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> should all be numbers or None&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_safe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_safe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_safe</span></div>

<div class="viewcode-block" id="ImagingSystem.get_safe"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_safe">[docs]</a>    <span class="k">def</span> <span class="nf">get_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get safe stage position to start any movement without danger .</span>
<span class="sd">        of collision in sample coordinates.</span>

<span class="sd">        Input:</span>
<span class="sd">         None</span>

<span class="sd">        Output:</span>
<span class="sd">         x, y, z: safe position in sample coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_safe</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_safe</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_safe</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_safe</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>

<div class="viewcode-block" id="ImagingSystem.set_flip"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_flip">[docs]</a>    <span class="k">def</span> <span class="nf">set_flip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set if object coordinate system is flipped relative</span>
<span class="sd">        to container coordinate system.</span>

<span class="sd">        Input:</span>
<span class="sd">         x_flip, y_flip, z_flip: 1 if system is not flipped, otherwise -1</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_flip</span> <span class="o">=</span> <span class="n">x_flip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_flip</span> <span class="o">=</span> <span class="n">y_flip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_flip</span> <span class="o">=</span> <span class="n">z_flip</span></div>

<div class="viewcode-block" id="ImagingSystem.update_flip"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.update_flip">[docs]</a>    <span class="k">def</span> <span class="nf">update_flip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set if object coordinate system should be flippedcompared</span>
<span class="sd">        to current settings.</span>

<span class="sd">        Input:</span>
<span class="sd">         x_flip, y_flip, z_flip: 1 if coordinate system flip should stay the same,</span>
<span class="sd">         otherwise -1</span>

<span class="sd">        Output:</span>
<span class="sd">         x_flip, y_flip, z_flip: updated parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_flip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_flip</span> <span class="o">*</span> <span class="n">x_flip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_flip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_flip</span> <span class="o">*</span> <span class="n">y_flip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_flip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_flip</span> <span class="o">*</span> <span class="n">z_flip</span></div>

<div class="viewcode-block" id="ImagingSystem.get_flip"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_flip">[docs]</a>    <span class="k">def</span> <span class="nf">get_flip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return if object coordinate system is flipped relative</span>
<span class="sd">        to container coordinate system.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         x_flip, y_flip: 1 if system is not flipped, otherwise -1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_flip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_flip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_flip</span></div>

<div class="viewcode-block" id="ImagingSystem.set_correction"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_correction">[docs]</a>    <span class="k">def</span> <span class="nf">set_correction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_z_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set correction term if scaling for object coordinate system is</span>
<span class="sd">        slightly off relative to container coordinate system.</span>

<span class="sd">        Input:</span>
<span class="sd">         x_correction, y_correction, z_correction: Correction terms</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_correction</span> <span class="o">=</span> <span class="n">x_correction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_correction</span> <span class="o">=</span> <span class="n">y_correction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_correction</span> <span class="o">=</span> <span class="n">z_correction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_x_slope</span> <span class="o">=</span> <span class="n">z_correction_x_slope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_y_slope</span> <span class="o">=</span> <span class="n">z_correction_y_slope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_z_slope</span> <span class="o">=</span> <span class="n">z_correction_z_slope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_offset</span> <span class="o">=</span> <span class="n">z_correction_offset</span></div>

<div class="viewcode-block" id="ImagingSystem.update_correction"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.update_correction">[docs]</a>    <span class="k">def</span> <span class="nf">update_correction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_z_slope</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_offset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply existing correction terms if scaling for object coordinate</span>
<span class="sd">        system is slightly off relative to container coordinate system</span>
<span class="sd">        with additional correction term.</span>

<span class="sd">        Input:</span>
<span class="sd">         x_correction, y_correction, z_correction z_correction_x_slope,</span>
<span class="sd">         z_correction_y_slope, z_correction_z_slope, z_correction_offset:</span>
<span class="sd">         Additional multiplicative correction terms</span>

<span class="sd">        Output:</span>
<span class="sd">         x_correction, y_correction, z_correction: updated parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_correction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_correction</span> <span class="o">*</span> <span class="n">x_correction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_correction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_correction</span> <span class="o">*</span> <span class="n">y_correction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_correction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction</span> <span class="o">*</span> <span class="n">z_correction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_x_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_x_slope</span> <span class="o">*</span> <span class="n">z_correction_x_slope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_y_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_y_slope</span> <span class="o">*</span> <span class="n">z_correction_y_slope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_z_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_z_slope</span> <span class="o">*</span> <span class="n">z_correction_z_slope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_offset</span> <span class="o">*</span> <span class="n">z_correction_offset</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_correction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_correction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction</span></div>

<div class="viewcode-block" id="ImagingSystem.get_correction"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_correction">[docs]</a>    <span class="k">def</span> <span class="nf">get_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get correction term if scaling for object coordinate system is</span>
<span class="sd">        slightly off relative to container coordinate system.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         x_correction, y_correction, z_correction: Correction terms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;x_correction&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_correction</span><span class="p">,</span>
            <span class="s2">&quot;y_correction&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_correction</span><span class="p">,</span>
            <span class="s2">&quot;z_correction&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction</span><span class="p">,</span>
            <span class="s2">&quot;z_correction_x_slope&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="s2">&quot;z_correction_y_slope&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_y_slope</span><span class="p">,</span>
            <span class="s2">&quot;z_correction_z_slope&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_z_slope</span><span class="p">,</span>
            <span class="s2">&quot;z_correction_offset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_offset</span><span class="p">,</span>
        <span class="p">}</span></div>

    <span class="c1">################################################################################</span>
    <span class="c1">#</span>
    <span class="c1"># Methods to move stage and focus</span>
    <span class="c1">#</span>
    <span class="c1">################################################################################</span>

<div class="viewcode-block" id="ImagingSystem.microscope_is_ready"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.microscope_is_ready">[docs]</a>    <span class="k">def</span> <span class="nf">microscope_is_ready</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">experiment</span><span class="p">,</span>
        <span class="n">reference_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">use_reference</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">use_auto_focus</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">make_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">trials</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if microscope is ready and setup up for data acquisition.</span>

<span class="sd">        Input:</span>
<span class="sd">         experiment: string with name of experiment as defined in microscope software</span>

<span class="sd">         reference_object: object used to set parfocality and parcentricity</span>

<span class="sd">         load: move objective into load position before moving stage</span>

<span class="sd">         use_reference: initialize reference position if not set</span>

<span class="sd">         make_ready: if True, make attempt to ready microscope, e.g. setup autofocus</span>
<span class="sd">         (Default: True)</span>

<span class="sd">         trials: maximum number of attempt to initialize microscope.</span>
<span class="sd">         Will allow user to make adjustments on microscope. (Default: 3)</span>

<span class="sd">         verbose: print debug messages (Default: True)</span>

<span class="sd">        Output:</span>
<span class="sd">         ready: True if microscope is ready for use, False if not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stage_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stage_id</span><span class="p">()</span>
        <span class="n">focus_drive_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_focus_id</span><span class="p">()</span>
        <span class="n">auto_focus_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_auto_focus_id</span><span class="p">()</span>
        <span class="n">objective_changer_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_objective_changer_id</span><span class="p">()</span>
        <span class="n">safety_object_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_safety_id</span><span class="p">()</span>
        <span class="n">microscope_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">reference_object</span><span class="p">:</span>
            <span class="n">reference_object_id</span> <span class="o">=</span> <span class="n">reference_object</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reference_object_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">test_ready_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="n">stage_id</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="p">(</span><span class="n">focus_drive_id</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;set_load&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">load</span> <span class="k">else</span> <span class="p">[]),</span>
                <span class="p">(</span><span class="n">objective_changer_id</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;set_reference&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">use_reference</span> <span class="k">else</span> <span class="p">[]),</span>
                <span class="p">(</span><span class="n">auto_focus_id</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;no_find_surface&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">use_auto_focus</span> <span class="k">else</span> <span class="p">[]),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">is_ready</span> <span class="o">=</span> <span class="n">microscope_object</span><span class="o">.</span><span class="n">microscope_is_ready</span><span class="p">(</span>
            <span class="n">experiment</span><span class="o">=</span><span class="n">experiment</span><span class="p">,</span>
            <span class="n">component_dict</span><span class="o">=</span><span class="n">test_ready_dict</span><span class="p">,</span>
            <span class="n">focus_drive_id</span><span class="o">=</span><span class="n">focus_drive_id</span><span class="p">,</span>
            <span class="n">objective_changer_id</span><span class="o">=</span><span class="n">objective_changer_id</span><span class="p">,</span>
            <span class="n">safety_object_id</span><span class="o">=</span><span class="n">safety_object_id</span><span class="p">,</span>
            <span class="n">reference_object_id</span><span class="o">=</span><span class="n">reference_object_id</span><span class="p">,</span>
            <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span>
            <span class="n">make_ready</span><span class="o">=</span><span class="n">make_ready</span><span class="p">,</span>
            <span class="n">trials</span><span class="o">=</span><span class="n">trials</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">is_ready</span><span class="p">[</span><span class="s2">&quot;Microscope&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="ImagingSystem.move_to_abs_position"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.move_to_abs_position">[docs]</a>    <span class="k">def</span> <span class="nf">move_to_abs_position</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reference_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move stage to position x, y, z.</span>

<span class="sd">        Input:</span>
<span class="sd">         x, y: Position stage should move to in stage coordinates in mum.</span>
<span class="sd">         If None, stage will not move</span>

<span class="sd">         z: Focus position in mum. If not provided focus will not be changed,</span>
<span class="sd">         but autofocus might engage</span>

<span class="sd">         reference_object: object of type sample (ImagingSystem) used to correct</span>
<span class="sd">         for xyz offset between different objectives</span>

<span class="sd">         load: Move focus in load position before move. Default: True</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x, y: New stage position</span>

<span class="sd">        If use_autofocus is set, correct z value according to new autofocus position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_stage_position</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">reference_object</span><span class="o">=</span><span class="n">reference_object</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">move_to_abs_position</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">reference_object</span><span class="o">=</span><span class="n">reference_object</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.move_to_zero"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.move_to_zero">[docs]</a>    <span class="k">def</span> <span class="nf">move_to_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move to center of object.</span>

<span class="sd">        Input:</span>
<span class="sd">         load: Move focus in load position before move. Default: True</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x, y, z: new position in stage coordinates in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_xyz</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.move_to_safe"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.move_to_safe">[docs]</a>    <span class="k">def</span> <span class="nf">move_to_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move to safe position for object.</span>

<span class="sd">        Input:</span>
<span class="sd">         load: Move focus in load position before move. Default: True</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x, y, z: new position in stage coordinates in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_safe</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope</span><span class="o">.</span><span class="n">get_load_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_abs_position</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.move_to_xyz"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.move_to_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">move_to_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reference_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move to position in object coordinates in mum.</span>

<span class="sd">        If use_autofocus is set, correct z value according to new autofocus position.</span>

<span class="sd">        Input:</span>
<span class="sd">         x, y, z; Position in object coordinates in mum.</span>
<span class="sd">         If z == None do not change z position</span>

<span class="sd">         reference_object: object of type sample (ImagingSystem) used to correct</span>
<span class="sd">         for xyz offset between different objectives</span>

<span class="sd">         load: Move focus in load position before move. Default: True</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x_abs, y_abs, z_abs: new position in absolute stage coordinates in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_abs</span><span class="p">,</span> <span class="n">y_abs</span><span class="p">,</span> <span class="n">z_abs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_pos_from_obj_pos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_abs_position</span><span class="p">(</span>
            <span class="n">x_abs</span><span class="p">,</span>
            <span class="n">y_abs</span><span class="p">,</span>
            <span class="n">z_abs</span><span class="p">,</span>
            <span class="n">reference_object</span><span class="o">=</span><span class="n">reference_object</span><span class="p">,</span>
            <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.move_to_r_phi"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.move_to_r_phi">[docs]</a>    <span class="k">def</span> <span class="nf">move_to_r_phi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;moves to position r [mum], phi [degree] in radial coordinates.</span>
<span class="sd">        (0,0) is the center of unit (e.g. well). 0 degrees is in direction of x axis.</span>

<span class="sd">        Input:</span>
<span class="sd">         r: radius in mum for radial coordinates (center = 0)</span>

<span class="sd">         phi: angle in degree for radial coordinates (right = 0 degree)</span>

<span class="sd">         load: Move focus in load position before move. Default: True</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x_stage, y_stage: x, y position on stage in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phi_r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_r</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_r</span><span class="p">)</span>
        <span class="n">x_stage</span><span class="p">,</span> <span class="n">y_stage</span><span class="p">,</span> <span class="n">z_stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_xyz</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">x_stage</span><span class="p">,</span> <span class="n">y_stage</span><span class="p">,</span> <span class="n">z_stage</span></div>

<div class="viewcode-block" id="ImagingSystem.move_delta_xyz"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.move_delta_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">move_delta_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move in direction x,y,z in micrometers from current position.</span>

<span class="sd">        Input:</span>
<span class="sd">         x, y, z: step size in micrometers</span>

<span class="sd">         load: Move focus in load position before move. Default: True</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x_stage, y_stage: x, y position on stage in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get current stage position in absolute stage coordinates</span>
        <span class="n">x_stage</span><span class="p">,</span> <span class="n">y_stage</span><span class="p">,</span> <span class="n">z_stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_position</span><span class="p">()</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">x_stage</span> <span class="o">+</span> <span class="n">x</span>
        <span class="n">y_new</span> <span class="o">=</span> <span class="n">y_stage</span> <span class="o">+</span> <span class="n">y</span>
        <span class="n">z_new</span> <span class="o">=</span> <span class="n">z_stage</span> <span class="o">+</span> <span class="n">z</span>

        <span class="n">x_new_stage</span><span class="p">,</span> <span class="n">y_new_stage</span><span class="p">,</span> <span class="n">z_new_stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_abs_position</span><span class="p">(</span>
            <span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">,</span> <span class="n">z_new</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">x_new_stage</span><span class="p">,</span> <span class="n">y_new_stage</span><span class="p">,</span> <span class="n">z_new_stage</span></div>

<div class="viewcode-block" id="ImagingSystem.get_abs_position"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_abs_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_abs_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">focus_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return current stage position.</span>
<span class="sd">        Positions are corrected for centricity and parfocality.</span>

<span class="sd">        Input:</span>
<span class="sd">         stage_id: string id to identify stage information is collected from</span>

<span class="sd">         focus_id: string id to identify focus drive information is collected from</span>

<span class="sd">        Output:</span>
<span class="sd">         abs_pos: absolute (x, y, z) position of stage in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># use stage_id and focus_id from most top level object</span>
        <span class="c1"># (e.g. use from well if available, not from plate)</span>
        <span class="k">if</span> <span class="n">stage_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stage_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_id</span>
        <span class="k">if</span> <span class="n">focus_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">focus_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_stage_position</span><span class="p">(</span><span class="n">stage_id</span><span class="p">,</span> <span class="n">focus_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">abs_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_abs_position</span><span class="p">(</span><span class="n">stage_id</span><span class="p">,</span> <span class="n">focus_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">abs_pos</span></div>

    <span class="c1">##############################################################################</span>
    <span class="c1">#</span>
    <span class="c1"># Transformations from container coordinates to object coordinates</span>
    <span class="c1">#  Correction factors for this transformation are attached to the object</span>
    <span class="c1">#</span>
    <span class="c1">##############################################################################</span>
<div class="viewcode-block" id="ImagingSystem.calculate_slope_correction"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.calculate_slope_correction">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_slope_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate offset in z because of tilted sample.</span>

<span class="sd">        Input:</span>
<span class="sd">         x, y: x and y positions in object coordinates in um the correction is</span>
<span class="sd">         to be calculated</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         z_slope_correction: offset in z in um</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_z_slope</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z_slope_correction</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z_slope_correction</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_offset</span>
                <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_x_slope</span><span class="p">)</span>
                <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_y_slope</span><span class="p">)</span>
            <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_z_slope</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">calculate_slope_correction in module samples.py for object &quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Calculate correction for position (in object coordinates): &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; z_correction_x_slope: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_x_slope</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; z_correction_y_slope: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_y_slope</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; z_correction_z_slope: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_z_slope</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; z_correction_offset: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction_offset</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Calculated slope correction offset: &quot;</span><span class="p">,</span> <span class="n">z_slope_correction</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">z_slope_correction</span></div>

<div class="viewcode-block" id="ImagingSystem.get_obj_pos_from_container_pos"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_obj_pos_from_container_pos">[docs]</a>    <span class="k">def</span> <span class="nf">get_obj_pos_from_container_pos</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">x_container</span><span class="p">,</span> <span class="n">y_container</span><span class="p">,</span> <span class="n">z_container</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate object coordinates from container coordinates.</span>

<span class="sd">        Input:</span>
<span class="sd">         x_container, y_container, z_container: container coordinates in mum</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x_object, y_object, z_object: object coordinates in mum for container</span>
<span class="sd">         coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># calculate translation</span>
        <span class="c1"># the origin of the object coordinate system in container coordinates</span>
        <span class="c1"># is given by (self.x_zero, self.y_zero, self.z_zero)</span>
        <span class="n">x_offfset_container</span> <span class="o">=</span> <span class="n">x_container</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_zero</span>
        <span class="n">y_offfset_container</span> <span class="o">=</span> <span class="n">y_container</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_zero</span>
        <span class="n">z_offfset_container</span> <span class="o">=</span> <span class="n">z_container</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_zero</span>

        <span class="c1"># The coordinate system of the object might be stretched and flipped</span>
        <span class="c1"># compared to the container</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_flip</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">x_object</span> <span class="o">=</span> <span class="n">x_offfset_container</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_flip</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_correction</span>
        <span class="n">y_object</span> <span class="o">=</span> <span class="n">y_offfset_container</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_flip</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_correction</span>
        <span class="n">z_object</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">z_offfset_container</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_flip</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_slope_correction</span><span class="p">(</span><span class="n">x_object</span><span class="p">,</span> <span class="n">y_object</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Output for debugging</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">container_name</span> <span class="o">=</span> <span class="s2">&quot;Stage Position&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">container_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Results from method get_obj_pos_from_container_pos(xContainer, yContainer, zContainer)&quot;</span>  <span class="c1"># noqa</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot; &quot;</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="o">+</span> <span class="s2">&quot; coordinates calculated from &quot;</span>
                <span class="o">+</span> <span class="n">container_name</span>
                <span class="o">+</span> <span class="s2">&quot; coordinates&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Container coordinates: &quot;</span><span class="p">,</span> <span class="n">x_container</span><span class="p">,</span> <span class="n">y_container</span><span class="p">,</span> <span class="n">z_container</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Object coordinates: &quot;</span><span class="p">,</span> <span class="n">x_object</span><span class="p">,</span> <span class="n">y_object</span><span class="p">,</span> <span class="n">z_object</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot; ObjectObject.zero in container coordinates (flip not applied): &quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_zero</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_zero</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z_zero</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot; Object flip relative to container: &quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_flip</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_flip</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z_flip</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">x_object</span><span class="p">,</span> <span class="n">y_object</span><span class="p">,</span> <span class="n">z_object</span></div>

<div class="viewcode-block" id="ImagingSystem.get_pos_from_abs_pos"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_pos_from_abs_pos">[docs]</a>    <span class="k">def</span> <span class="nf">get_pos_from_abs_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return current position in object coordinates in mum.</span>
<span class="sd">        or transforms (x,y,z) from stage coordinates into object coordinates.</span>
<span class="sd">        This method is based on focus coordinates after drift correction.</span>

<span class="sd">        Input:</span>
<span class="sd">         x, y, z: Absolute stage coordinates in mum. If not given or None</span>
<span class="sd">         retrieve current stage position and express in object coordinates.</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x_pos, y_pos, z_pos: current or position passed in stage coordinate</span>
<span class="sd">         returned in object coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">x_stage</span><span class="p">,</span> <span class="n">y_stage</span><span class="p">,</span> <span class="n">z_stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_corrected_stage_position</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x_stage</span>
            <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y_stage</span>
            <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">z_stage</span>
            <span class="n">x_pos</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_zero</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_zero</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_zero</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="n">x_container</span><span class="p">,</span>
                <span class="n">y_container</span><span class="p">,</span>
                <span class="n">z_container</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_pos_from_abs_pos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">z_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obj_pos_from_container_pos</span><span class="p">(</span>
                <span class="n">x_container</span><span class="p">,</span> <span class="n">y_container</span><span class="p">,</span> <span class="n">z_container</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">z_pos</span><span class="p">)</span></div>

    <span class="c1">##############################################################################</span>
    <span class="c1">#</span>
    <span class="c1"># Transformations from object coordinates to container coordinates</span>
    <span class="c1">#  Correction factors for this transformation are attached to the object</span>
    <span class="c1">#</span>
    <span class="c1">##############################################################################</span>
<div class="viewcode-block" id="ImagingSystem.get_container_pos_from_obj_pos"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_container_pos_from_obj_pos">[docs]</a>    <span class="k">def</span> <span class="nf">get_container_pos_from_obj_pos</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">x_object</span><span class="p">,</span> <span class="n">y_object</span><span class="p">,</span> <span class="n">z_object</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate container coordinates for given object coordinates.</span>

<span class="sd">        Input:</span>
<span class="sd">         x_object, y_object, z_object: Object coordinates in mum</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x_container, y_container, z_container: Container coordinates in mum</span>
<span class="sd">         for object coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The coordinate system of the container might be stretched and fliped</span>
        <span class="c1"># compared to the object</span>
        <span class="n">x_container_offset</span> <span class="o">=</span> <span class="n">x_object</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_correction</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_flip</span>
        <span class="n">y_container_offset</span> <span class="o">=</span> <span class="n">y_object</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_correction</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_flip</span>
        <span class="k">if</span> <span class="n">z_object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z_container</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z_container_offset</span> <span class="o">=</span> <span class="n">z_object</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_correction</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_flip</span>

        <span class="c1"># calculate translation</span>
        <span class="c1"># the origin of the object coordinate system in container coordinates</span>
        <span class="c1"># is given by (self.x_zero, self.y_zero, self.z_zero)</span>
        <span class="n">x_container</span> <span class="o">=</span> <span class="n">x_container_offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_zero</span>
        <span class="n">y_container</span> <span class="o">=</span> <span class="n">y_container_offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_zero</span>
        <span class="k">if</span> <span class="n">z_object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z_container</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">z_container_offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_zero</span>
            <span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_slope_correction</span><span class="p">(</span>
                <span class="n">x_container</span><span class="p">,</span> <span class="n">y_container</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
            <span class="p">)</span>

        <span class="c1"># Output for debugging</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">container_name</span> <span class="o">=</span> <span class="s2">&quot;Stage Position&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">container_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Results from method get_container_pos_from_obj_pos(xObject, yObject, zObject)&quot;</span>  <span class="c1"># noqa</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot; &quot;</span>
                <span class="o">+</span> <span class="n">container_name</span>
                <span class="o">+</span> <span class="s2">&quot; coordinates calculated from &quot;</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="o">+</span> <span class="s2">&quot; coordinates&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Object coordinates: &quot;</span><span class="p">,</span> <span class="n">x_object</span><span class="p">,</span> <span class="n">y_object</span><span class="p">,</span> <span class="n">z_object</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Container coordinates: &quot;</span><span class="p">,</span> <span class="n">x_container</span><span class="p">,</span> <span class="n">y_container</span><span class="p">,</span> <span class="n">z_container</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot; Object.zero in container coordinates (flip not applied): &quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_zero</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_zero</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z_zero</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot; Object flip relative to container: &quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_flip</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_flip</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z_flip</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">x_container</span><span class="p">,</span> <span class="n">y_container</span><span class="p">,</span> <span class="n">z_container</span></div>

<div class="viewcode-block" id="ImagingSystem.get_abs_pos_from_obj_pos"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_abs_pos_from_obj_pos">[docs]</a>    <span class="k">def</span> <span class="nf">get_abs_pos_from_obj_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_object</span><span class="p">,</span> <span class="n">y_object</span><span class="p">,</span> <span class="n">z_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert object coordinates into stage coordinates.</span>

<span class="sd">        Input:</span>
<span class="sd">         x_object, y_object, z_object: Object coordinates in mum</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x, y, z: coordinates in absolute stage coordinates in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_container</span><span class="p">,</span> <span class="n">y_container</span><span class="p">,</span> <span class="n">z_container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container_pos_from_obj_pos</span><span class="p">(</span>
            <span class="n">x_object</span><span class="p">,</span> <span class="n">y_object</span><span class="p">,</span> <span class="n">z_object</span><span class="p">,</span> <span class="n">verbose</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x_container</span><span class="p">,</span> <span class="n">y_container</span><span class="p">,</span> <span class="n">z_container</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_object</span> <span class="o">=</span> <span class="n">x_container</span>
            <span class="n">y_object</span> <span class="o">=</span> <span class="n">y_container</span>
            <span class="n">z_object</span> <span class="o">=</span> <span class="n">z_container</span>
            <span class="p">(</span>
                <span class="n">x_container</span><span class="p">,</span>
                <span class="n">y_container</span><span class="p">,</span>
                <span class="n">z_container</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_abs_pos_from_obj_pos</span><span class="p">(</span>
                <span class="n">x_object</span><span class="p">,</span> <span class="n">y_object</span><span class="p">,</span> <span class="n">z_object</span><span class="p">,</span> <span class="n">verbose</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">x_container</span><span class="p">,</span> <span class="n">y_container</span><span class="p">,</span> <span class="n">z_container</span></div>

    <span class="c1">###############################################################</span>
    <span class="c1">#</span>
    <span class="c1"># Methods to control autofocus</span>
    <span class="c1">#</span>
    <span class="c1">###############################################################</span>

<div class="viewcode-block" id="ImagingSystem.set_use_autofocus"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.set_use_autofocus">[docs]</a>    <span class="k">def</span> <span class="nf">set_use_autofocus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set flag to enable the use of autofocus.</span>

<span class="sd">        Input:</span>
<span class="sd">         flag: if true, use autofocus</span>

<span class="sd">        Output:</span>
<span class="sd">         use_autofocus: status of use_autofocus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">set_use_autofocus</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.get_use_autofocus"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_use_autofocus">[docs]</a>    <span class="k">def</span> <span class="nf">get_use_autofocus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return flag about autofocus usage</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         use_autofocus: boolean varaible indicating if autofocus should be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">get_use_autofocus</span><span class="p">()</span></div>

<div class="viewcode-block" id="ImagingSystem.find_surface"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.find_surface">[docs]</a>    <span class="k">def</span> <span class="nf">find_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find cover slip using Definite Focus 2.</span>

<span class="sd">        Input:</span>
<span class="sd">         trials: number of trials before initialization is aborted</span>

<span class="sd">         verbose: if True, print debug messages (Default: True)</span>

<span class="sd">        Output:</span>
<span class="sd">         z: position of focus drive after find surface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">find_surface</span><span class="p">(</span>
            <span class="n">reference_object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_reference_object</span><span class="p">(),</span> <span class="n">trials</span><span class="o">=</span><span class="n">trials</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.store_focus"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.store_focus">[docs]</a>    <span class="k">def</span> <span class="nf">store_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus_reference_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store actual focus position as offset from coverslip.</span>

<span class="sd">        Input:</span>
<span class="sd">         focus_reference_obj: Sample object used as reference for autofocus</span>

<span class="sd">         trials: number of trials before initialization is aborted</span>

<span class="sd">         verbose: if True, print debug messages (Default: True)</span>

<span class="sd">        Output:</span>
<span class="sd">         z: position of focus drive after store focus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">focus_reference_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">focus_reference_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">store_focus</span><span class="p">(</span>
            <span class="n">focus_reference_obj</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="n">trials</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.recall_focus"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.recall_focus">[docs]</a>    <span class="k">def</span> <span class="nf">recall_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto_focus_id</span><span class="p">,</span> <span class="n">pre_set_focus</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find difference between stored focus position and actual autofocus position.</span>
<span class="sd">        Recall focus will move the focus drive to it&#39;s stored position.</span>

<span class="sd">        Input:</span>
<span class="sd">         auto_focus_id: string of ID for autofocus to use</span>

<span class="sd">         pre_set_focus: Move focus to previous auto-focus position.</span>
<span class="sd">         This makes definite focus more robust</span>

<span class="sd">        Output:</span>
<span class="sd">         delta_z: difference between stored z position of focus drive</span>
<span class="sd">         and position after recall focus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">recall_focus</span><span class="p">(</span><span class="n">auto_focus_id</span><span class="p">,</span> <span class="n">pre_set_focus</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.live_mode_start"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.live_mode_start">[docs]</a>    <span class="k">def</span> <span class="nf">live_mode_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">,</span> <span class="n">experiment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start live mode in microscope software.</span>

<span class="sd">        Methods calls method of container instance until container has</span>
<span class="sd">        method implemented that actually performs action.</span>

<span class="sd">        Input:</span>
<span class="sd">         camera_id: string with unique camera ID</span>

<span class="sd">         experiment: string with experiment name as defined within microscope software</span>
<span class="sd">         If None use actual experiment.</span>

<span class="sd">        Output:</span>
<span class="sd">          none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">live_mode_start</span><span class="p">(</span><span class="n">camera_id</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.live_mode_stop"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.live_mode_stop">[docs]</a>    <span class="k">def</span> <span class="nf">live_mode_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop live mode in microscope software.</span>

<span class="sd">        Methods calls method of container instance until container has</span>
<span class="sd">        method implemented that actually performs action.</span>

<span class="sd">        Input:</span>
<span class="sd">         camera_id: string with unique camera ID</span>

<span class="sd">         experiment: string with experiment name as defined within microscope software</span>
<span class="sd">         If None use actual experiment.</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">live_mode_stop</span><span class="p">(</span><span class="n">camera_id</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImagingSystem.execute_experiment"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.execute_experiment">[docs]</a>    <span class="k">def</span> <span class="nf">execute_experiment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">experiment</span><span class="p">,</span>
        <span class="n">camera_id</span><span class="p">,</span>
        <span class="n">reference_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meta_dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Acquire single image using settings defined in microscope software</span>
<span class="sd">        and optionally save.</span>


<span class="sd">        Methods calls method of container instance until container has</span>
<span class="sd">        method implemented that actually performs action.</span>

<span class="sd">        Input:</span>
<span class="sd">         experiment: string with experiment name as defined within microscope software</span>

<span class="sd">         camera_id: string with unique camera ID</span>

<span class="sd">         reference_object: object of type sample (ImagingSystem) used to correct</span>
<span class="sd">         for xyz offset between different objectives</span>

<span class="sd">         file_path: filename with path to save image in original format.</span>
<span class="sd">         Default=None: no saving</span>

<span class="sd">         meta_dict: directory with additional meta data, e.g. {&#39;aics_well&#39;:, &#39;A1&#39;}</span>

<span class="sd">         focus: use autofocus (default = False)</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         image: ImageAICS object. At this moment they do not include the pixel data.</span>
<span class="sd">         Get pixel data with load_image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add name and type of object to meta data</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="n">meta_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">meta_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">meta_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;aics_objectContainerName&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
                <span class="s2">&quot;aics_type&quot;</span><span class="p">:</span> <span class="n">class_name</span><span class="p">,</span>
                <span class="s2">&quot;aics_containerType&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s2">&quot;aics_barcode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_barcode</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># add relative positions to meta data</span>
        <span class="n">posX</span><span class="p">,</span> <span class="n">posY</span><span class="p">,</span> <span class="n">posZ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_zero</span><span class="p">()</span>
        <span class="n">meta_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;aics_cellInColonyPosX&quot;</span><span class="p">:</span> <span class="n">posX</span><span class="p">,</span>
                <span class="s2">&quot;aics_cellInColonyPosY&quot;</span><span class="p">:</span> <span class="n">posY</span><span class="p">,</span>
                <span class="s2">&quot;aics_cellInColonyPosZ&quot;</span><span class="p">:</span> <span class="n">posZ</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># add correction terms to meta data</span>
        <span class="n">corrections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_correction</span><span class="p">()</span>

        <span class="n">meta_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;aics_xCorrection&quot;</span><span class="p">:</span> <span class="n">corrections</span><span class="p">[</span><span class="s2">&quot;x_correction&quot;</span><span class="p">],</span>
                <span class="s2">&quot;aics_yCorrection&quot;</span><span class="p">:</span> <span class="n">corrections</span><span class="p">[</span><span class="s2">&quot;y_correction&quot;</span><span class="p">],</span>
                <span class="s2">&quot;aics_zCorrection&quot;</span><span class="p">:</span> <span class="n">corrections</span><span class="p">[</span><span class="s2">&quot;z_correction&quot;</span><span class="p">],</span>
                <span class="s2">&quot;aics_zCorrectionXSlope&quot;</span><span class="p">:</span> <span class="n">corrections</span><span class="p">[</span><span class="s2">&quot;z_correction_x_slope&quot;</span><span class="p">],</span>
                <span class="s2">&quot;aics_zCorrectionYSlope&quot;</span><span class="p">:</span> <span class="n">corrections</span><span class="p">[</span><span class="s2">&quot;z_correction_y_slope&quot;</span><span class="p">],</span>
                <span class="s2">&quot;aics_zCorrectionZSlope&quot;</span><span class="p">:</span> <span class="n">corrections</span><span class="p">[</span><span class="s2">&quot;z_correction_z_slope&quot;</span><span class="p">],</span>
                <span class="s2">&quot;aics_zCorrectionOffset&quot;</span><span class="p">:</span> <span class="n">corrections</span><span class="p">[</span><span class="s2">&quot;z_correction_offset&quot;</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">flip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_flip</span><span class="p">()</span>
        <span class="n">meta_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;aics_xFlip&quot;</span><span class="p">:</span> <span class="n">flip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;aics_yFlip&quot;</span><span class="p">:</span> <span class="n">flip</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;aics_zFlip&quot;</span><span class="p">:</span> <span class="n">flip</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
        <span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">execute_experiment</span><span class="p">(</span>
            <span class="n">experiment</span><span class="p">,</span>
            <span class="n">camera_id</span><span class="p">,</span>
            <span class="n">reference_object</span><span class="o">=</span><span class="n">reference_object</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
            <span class="n">meta_dict</span><span class="o">=</span><span class="n">meta_dict</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># use x, y, z values corrected for objective offset to calculate object</span>
        <span class="c1"># positions, otherwise they would be different for different objectives</span>
        <span class="n">x_abs</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imagePosX (centricity_corrected)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x_abs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x_abs</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imagePosX (absolute)&quot;</span><span class="p">)</span>
        <span class="n">y_abs</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imagePosY (centricity_corrected)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y_abs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y_abs</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imagePosY (absolute)&quot;</span><span class="p">)</span>
        <span class="n">z_abs</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imagePosZ (focality_drift_corrected)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">z_abs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z_abs</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imagePosZ (absolute)&quot;</span><span class="p">)</span>
        <span class="n">posX</span><span class="p">,</span> <span class="n">posY</span><span class="p">,</span> <span class="n">posZ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pos_from_abs_pos</span><span class="p">(</span>
            <span class="n">x_abs</span><span class="p">,</span> <span class="n">y_abs</span><span class="p">,</span> <span class="n">z_abs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>
        <span class="n">image</span><span class="o">.</span><span class="n">add_meta</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;aics_imageObjectPosX&quot;</span><span class="p">:</span> <span class="n">posX</span><span class="p">,</span>
                <span class="s2">&quot;aics_imageObjectPosY&quot;</span><span class="p">:</span> <span class="n">posY</span><span class="p">,</span>
                <span class="s2">&quot;aics_imageObjectPosZ&quot;</span><span class="p">:</span> <span class="n">posZ</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="ImagingSystem.acquire_images"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.acquire_images">[docs]</a>    <span class="k">def</span> <span class="nf">acquire_images</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">experiment</span><span class="p">,</span>
        <span class="n">camera_id</span><span class="p">,</span>
        <span class="n">reference_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pos_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">use_reference</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">use_auto_focus</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">meta_dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Acquire image or set of images using settings defined in microscope software</span>
<span class="sd">        and optionally save.</span>

<span class="sd">        Methods calls method of container instance until container has</span>
<span class="sd">        method implemented that actually performs action.</span>

<span class="sd">        Input:</span>
<span class="sd">         experiment: string with experiment name as defined within microscope software</span>

<span class="sd">         camera_id: string with unique camera ID</span>

<span class="sd">         reference_object: object used to set parfocality and parcentricity,</span>
<span class="sd">         typically a well in plate</span>

<span class="sd">         file_path: string for filename with path to save image in original format</span>
<span class="sd">         or tuple with string to directory and list with template for file name.</span>
<span class="sd">         Default=None: no saving</span>

<span class="sd">         pos_list: coordinates if multiple images (e.g. tile) should be acquired.</span>
<span class="sd">         The coordinates are absolute stage positions in mum not corrected for</span>
<span class="sd">         objective offset.</span>

<span class="sd">         load: Move focus in load position before move. Default: True</span>


<span class="sd">         meta_dict: directory with additional meta data, e.g. {&#39;aics_well&#39;:, &#39;A1&#39;}</span>

<span class="sd">         use_autofocus: use autofocus (default = False)</span>

<span class="sd">         use_reference: use reference object (default = True)</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         images: list with ImageAICS objects. Does not include the pixel data.</span>
<span class="sd">         Get pixel data with load_image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">images</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">execute_experiment</span><span class="p">(</span>
                    <span class="n">experiment</span><span class="p">,</span>
                    <span class="n">camera_id</span><span class="p">,</span>
                    <span class="n">reference_object</span><span class="o">=</span><span class="n">reference_object</span><span class="p">,</span>
                    <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
                    <span class="n">meta_dict</span><span class="o">=</span><span class="n">meta_dict</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># xCurrent, yCurrent, zCurrent = self.get_abs_position()</span>
            <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">pos_list</span><span class="p">:</span>
                <span class="c1"># check if microscope is ready and initialize if necessary</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">microscope_is_ready</span><span class="p">(</span>
                    <span class="n">experiment</span><span class="o">=</span><span class="n">experiment</span><span class="p">,</span>
                    <span class="n">reference_object</span><span class="o">=</span><span class="n">reference_object</span><span class="p">,</span>
                    <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span>
                    <span class="n">use_reference</span><span class="o">=</span><span class="n">use_reference</span><span class="p">,</span>
                    <span class="n">use_auto_focus</span><span class="o">=</span><span class="n">use_auto_focus</span><span class="p">,</span>
                    <span class="n">make_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">move_to_abs_position</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="n">z</span><span class="p">,</span>
                    <span class="n">reference_object</span><span class="o">=</span><span class="n">reference_object</span><span class="p">,</span>
                    <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">newPath</span> <span class="o">=</span> <span class="n">file_path</span>
                <span class="c1"># Currently not needed - might be needed later for metadata extraction</span>
                <span class="c1"># if file_path != None:</span>
                <span class="c1">#     if isinstance(file_path, tuple):</span>
                <span class="c1">#         # file_path is tuple containing path to directory and template for file name  # noqa</span>
                <span class="c1">#         # use list() to make sure that newTemplate has a copy of file_path[1] and not only a reference  # noqa</span>
                <span class="c1">#         newTemplate = list(file_path[1])</span>
                <span class="c1">#         newTemplate.insert(-1, &#39;_x&#39;+ str(x) + &#39;_y&#39; + str(y) + \</span>
                <span class="c1">#             &#39;_z&#39; + str(z))</span>
                <span class="c1">#         newPath = (file_path[0], newTemplate)</span>
                <span class="c1">#     else:</span>
                <span class="c1">#         # file_path is single string with directory and filename</span>
                <span class="c1">#         splitPath=path.splitext(file_path)</span>
                <span class="c1">#         newPath=splitPath[0]+&#39;_x&#39;+ str(x) + &#39;_y&#39; + str(y) + &#39;_z&#39; \</span>
                <span class="c1">#             + str(z) + splitPath[1]</span>
                <span class="c1"># else:</span>
                <span class="c1">#     newPath=None</span>
                <span class="k">if</span> <span class="n">meta_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1">###############################################################</span>
                    <span class="c1">#</span>
                    <span class="c1"># TODO: add relative pixel positions for stitching to meta data</span>
                    <span class="c1">#</span>
                    <span class="c1">###############################################################</span>
                    <span class="c1"># meta_dict.update({&#39;aics_objectName&#39;: self.get_name()&#39;aics_xTile&#39;: xTileName, &#39;aics_yTile&#39;: yTileName})  # noqa</span>
                    <span class="n">meta_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;aics_objectName&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()})</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">meta_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;aics_positionNumber&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_number</span><span class="p">})</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_experiment</span><span class="p">(</span>
                    <span class="n">experiment</span><span class="p">,</span>
                    <span class="n">camera_id</span><span class="p">,</span>
                    <span class="n">reference_object</span><span class="p">,</span>
                    <span class="n">newPath</span><span class="p">,</span>
                    <span class="n">meta_dict</span><span class="o">=</span><span class="n">meta_dict</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">images</span></div>

    <span class="k">def</span> <span class="nf">_get_tile_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefs</span><span class="p">,</span> <span class="n">tile_object</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve settings to define tiles from preferences.</span>

<span class="sd">        Input:</span>
<span class="sd">         prefs: Preferences object with preferences for tiling</span>

<span class="sd">         verbose: print logging comments</span>

<span class="sd">        Output:</span>
<span class="sd">         tile_params: directory with parameters to calculate tile positions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># retrieve center of sample object. This will be the center of all tiles.</span>
        <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_zero</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># tile_object describes the object (e.g. colony, well) that should be</span>
        <span class="c1"># covered with tiles. This has to be translated into tile_type.</span>
        <span class="c1"># tile_type describes how the arrangement of tiles is calculated</span>
        <span class="c1"># different subclasses might allow additional options</span>
        <span class="k">if</span> <span class="n">tile_object</span> <span class="o">==</span> <span class="s2">&quot;NoTiling&quot;</span><span class="p">:</span>
            <span class="n">tile_type</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
            <span class="n">tile_number</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">tile_size</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">degrees</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">percentage</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">elif</span> <span class="n">tile_object</span> <span class="o">==</span> <span class="s2">&quot;Fixed&quot;</span><span class="p">:</span>
            <span class="n">tile_type</span> <span class="o">=</span> <span class="s2">&quot;rectangle&quot;</span>
            <span class="n">tile_number</span> <span class="o">=</span> <span class="p">(</span><span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;nColTile&quot;</span><span class="p">),</span> <span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;nRowTile&quot;</span><span class="p">))</span>
            <span class="n">tile_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;xPitchTile&quot;</span><span class="p">),</span> <span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;yPitchTile&quot;</span><span class="p">))</span>
            <span class="n">degrees</span> <span class="o">=</span> <span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;RotationTile&quot;</span><span class="p">)</span>
            <span class="n">percentage</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">elif</span> <span class="n">tile_object</span> <span class="o">==</span> <span class="s2">&quot;Well&quot;</span><span class="p">:</span>
            <span class="n">tile_type</span> <span class="o">=</span> <span class="s2">&quot;ellipse&quot;</span>
            <span class="n">percentage</span> <span class="o">=</span> <span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;PercentageWell&quot;</span><span class="p">)</span>
            <span class="n">well_diameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_diameter</span><span class="p">()</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">percentage</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
            <span class="n">tile_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;xPitchTile&quot;</span><span class="p">),</span> <span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;yPitchTile&quot;</span><span class="p">))</span>
            <span class="n">tile_number</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">well_diameter</span> <span class="o">/</span> <span class="n">tile_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">well_diameter</span> <span class="o">/</span> <span class="n">tile_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="n">degrees</span> <span class="o">=</span> <span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;RotationTile&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tile_object</span> <span class="o">==</span> <span class="s2">&quot;ColonySize&quot;</span><span class="p">:</span>
            <span class="n">tile_type</span> <span class="o">=</span> <span class="s2">&quot;ellipse&quot;</span>
            <span class="n">tile_number</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">tile_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;xPitchTile&quot;</span><span class="p">),</span> <span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;yPitchTile&quot;</span><span class="p">))</span>
            <span class="n">degrees</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">percentage</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Tiling object not implemented&quot;</span><span class="p">)</span>

        <span class="n">tile_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="n">center</span><span class="p">,</span>
            <span class="s2">&quot;tile_type&quot;</span><span class="p">:</span> <span class="n">tile_type</span><span class="p">,</span>
            <span class="s2">&quot;tile_number&quot;</span><span class="p">:</span> <span class="n">tile_number</span><span class="p">,</span>
            <span class="s2">&quot;tile_size&quot;</span><span class="p">:</span> <span class="n">tile_size</span><span class="p">,</span>
            <span class="s2">&quot;degrees&quot;</span><span class="p">:</span> <span class="n">degrees</span><span class="p">,</span>
            <span class="s2">&quot;percentage&quot;</span><span class="p">:</span> <span class="n">percentage</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">tile_params</span>

    <span class="k">def</span> <span class="nf">_compute_tile_positions_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tile_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get positions for tiles in absolute coordinates.</span>
<span class="sd">        Private method that is called from get_tile_positions_list().</span>

<span class="sd">        Input:</span>
<span class="sd">         tile_params: directory with parameters to calculate tile positions</span>

<span class="sd">        Output:</span>
<span class="sd">         tile_position_list: list with absolute positions for tiling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tile_object</span> <span class="o">=</span> <span class="n">CreateTilePositions</span><span class="p">(</span>
            <span class="n">tile_type</span><span class="o">=</span><span class="n">tile_params</span><span class="p">[</span><span class="s2">&quot;tile_type&quot;</span><span class="p">],</span>
            <span class="n">tile_number</span><span class="o">=</span><span class="n">tile_params</span><span class="p">[</span><span class="s2">&quot;tile_number&quot;</span><span class="p">],</span>
            <span class="n">tile_size</span><span class="o">=</span><span class="n">tile_params</span><span class="p">[</span><span class="s2">&quot;tile_size&quot;</span><span class="p">],</span>
            <span class="n">degrees</span><span class="o">=</span><span class="n">tile_params</span><span class="p">[</span><span class="s2">&quot;degrees&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">tile_positions_list</span> <span class="o">=</span> <span class="n">tile_object</span><span class="o">.</span><span class="n">get_pos_list</span><span class="p">(</span><span class="n">tile_params</span><span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">tile_positions_list</span>

<div class="viewcode-block" id="ImagingSystem.get_tile_positions_list"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_tile_positions_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_tile_positions_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefs</span><span class="p">,</span> <span class="n">tile_object</span><span class="o">=</span><span class="s2">&quot;NoTiling&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get positions for tiles in absolute coordinates.</span>
<span class="sd">        Subclasses have additional tile_objects (e.g. ColonySize, Well).</span>

<span class="sd">        Input:</span>
<span class="sd">         prefs: Preferences object with preferences for tiling</span>

<span class="sd">         tile_type: tile object passed in by preferences. Possible options:</span>
<span class="sd">          &#39;NoTiling&#39;: do not tile</span>

<span class="sd">          &#39;Fixed&#39;: calculate tiling to image a rectangular area</span>

<span class="sd">          &#39;Well&#39;: cover a well with tiles using an elliptical area</span>

<span class="sd">          &#39;ColonySize&#39;: cover a colony with tiles using an ellipse</span>

<span class="sd">         verbose: print debugging information</span>

<span class="sd">        Output:</span>
<span class="sd">         tile_position_list: list with absolute positions for tiling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tile_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tile_params</span><span class="p">(</span><span class="n">prefs</span><span class="p">,</span> <span class="n">tile_object</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">tile_positions_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_tile_positions_list</span><span class="p">(</span><span class="n">tile_params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tile_positions_list</span></div>

<div class="viewcode-block" id="ImagingSystem.load_image"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.load_image">[docs]</a>    <span class="k">def</span> <span class="nf">load_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">get_meta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load image and meta data in object of type ImageAICS.</span>

<span class="sd">        Methods calls method of container instance until container has</span>
<span class="sd">        method implemented that actually performs action.</span>

<span class="sd">        Input:</span>
<span class="sd">         image: image object of class ImageAICS. Holds meta data at this moment,</span>
<span class="sd">         no image data.</span>

<span class="sd">         get_meta: if true, retrieve meta data from file.</span>

<span class="sd">        Output:</span>
<span class="sd">         image: image with data and meta data as ImageAICS class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">get_meta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="ImagingSystem.get_images"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_images">[docs]</a>    <span class="k">def</span> <span class="nf">get_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">get_meta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve dictionary with images.</span>

<span class="sd">        Input:</span>
<span class="sd">         load: if true, will load image data before returning dictionary</span>

<span class="sd">         get_meta: if true, load meta data</span>

<span class="sd">        Output:</span>
<span class="sd">         images: list of images.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">load</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">image_name</span><span class="p">,</span> <span class="n">image_object</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">image_object</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">image_dict</span><span class="p">[</span><span class="n">image_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span>
                        <span class="n">image_object</span><span class="p">,</span> <span class="n">get_meta</span><span class="o">=</span><span class="n">get_meta</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_dict</span></div>

<div class="viewcode-block" id="ImagingSystem.background_correction"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.background_correction">[docs]</a>    <span class="k">def</span> <span class="nf">background_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uncorrected_image</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Correct background using background images attached to object</span>
<span class="sd">        or one of it&#39;s superclasses.</span>

<span class="sd">        Input:</span>
<span class="sd">         uncorrected_image: object of class ImageAICS</span>

<span class="sd">         settings: object of class Preferences which holds image settings</span>

<span class="sd">        Output:</span>
<span class="sd">         corrected: object of class ImageAICS after background correction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">uncorrected_image</span><span class="p">,</span> <span class="n">get_meta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">image_data</span> <span class="o">=</span> <span class="n">uncorrected_image</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">image_data</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">n_channels</span> <span class="o">=</span> <span class="n">image_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">prefs</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;ChannelDefinitions&quot;</span><span class="p">)</span>

        <span class="c1"># iterate through channels and apply appropriate background correction</span>
        <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">channelPref</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prefs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ch</span> <span class="o">&gt;=</span> <span class="n">n_channels</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">background_name</span> <span class="o">=</span> <span class="n">channelPref</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BackgroundCorrection&quot;</span><span class="p">)</span>
            <span class="n">black_reference_name</span> <span class="o">=</span> <span class="n">channelPref</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BlackReference&quot;</span><span class="p">)</span>
            <span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attached_image</span><span class="p">(</span><span class="n">background_name</span><span class="p">)</span>
            <span class="n">black_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attached_image</span><span class="p">(</span><span class="n">black_reference_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">black_reference</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">background</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">background_data</span> <span class="o">=</span> <span class="n">background</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
            <span class="n">black_reference_data</span> <span class="o">=</span> <span class="n">black_reference</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
            <span class="n">channel_data</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ch</span><span class="p">]</span>
            <span class="n">corrected_data</span> <span class="o">=</span> <span class="n">correct_background</span><span class="o">.</span><span class="n">illumination_correction</span><span class="p">(</span>
                <span class="n">channel_data</span><span class="p">,</span> <span class="n">black_reference_data</span><span class="p">,</span> <span class="n">background_data</span>
            <span class="p">)</span>
            <span class="c1"># corrected_data = channel_data</span>
            <span class="n">image_data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrected_data</span>

        <span class="n">image</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">image_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="ImagingSystem.tile_images"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.tile_images">[docs]</a>    <span class="k">def</span> <span class="nf">tile_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create tile of all images associated with object.</span>

<span class="sd">        Input:</span>
<span class="sd">         images: list with image objects of class ImageAICS</span>

<span class="sd">         settings: object of class Preferences which holds image settings</span>

<span class="sd">        Output:</span>
<span class="sd">         tile: ImageAICS object with tile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Information about tiling should be int he image meta data</span>
        <span class="c1"># (e.g. image positions)</span>
        <span class="c1">#         if not settings.get_pref(&#39;Tile&#39;, validValues = VALID_TILE):</span>
        <span class="c1">#             return images[(len(images)-1)/2] # return the x-0, y-0 image</span>

        <span class="c1"># apply background correction</span>
        <span class="n">corrected_images</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">######################################################################</span>
        <span class="c1">#</span>
        <span class="c1"># Todo: Catch if background image does not exist</span>
        <span class="c1">#</span>
        <span class="c1">######################################################################</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;CorrectBackground&quot;</span><span class="p">):</span>
                <span class="c1"># TODO: figure out if this can be a float with negative values</span>
                <span class="n">corrected_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background_correction</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">settings</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">corrected_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">get_meta</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with Background correction&quot;</span><span class="p">)</span>
        <span class="c1"># create path and filename for tiled image</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="n">get_images_path</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">sub_dir</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;TileFolder&quot;</span><span class="p">))</span>
        <span class="n">file_name_pattern</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;TileFileName&quot;</span><span class="p">)</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">create_file_name</span><span class="p">(</span><span class="n">file_name_pattern</span><span class="p">)</span>
        <span class="n">image_output_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">))</span>
        <span class="c1"># use tiling method &#39;anyShape&#39; for arbitrary shaped tile regions, use &#39;stack&#39;</span>
        <span class="c1"># if tile region is a rectangle.</span>
        <span class="c1"># return _ list = [return_image, x_pos_list, y_pos_list]</span>
        <span class="n">tiled_image</span><span class="p">,</span> <span class="n">x_border_list</span><span class="p">,</span> <span class="n">y_border_list</span> <span class="o">=</span> <span class="n">tile_images</span><span class="o">.</span><span class="n">tile_images</span><span class="p">(</span>
            <span class="n">corrected_images</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;anyShape&quot;</span><span class="p">,</span>
            <span class="n">output_image</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">image_output_path</span><span class="o">=</span><span class="n">image_output_path</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">tiled_image</span><span class="p">,</span> <span class="n">x_border_list</span><span class="p">,</span> <span class="n">y_border_list</span><span class="p">]</span></div>

<div class="viewcode-block" id="ImagingSystem.add_attached_image"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.add_attached_image">[docs]</a>    <span class="k">def</span> <span class="nf">add_attached_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Attach image to sample object.</span>

<span class="sd">        Input:</span>
<span class="sd">         key:  string with name of image (e.g. &#39;backgroundGreen_10x&#39;)</span>

<span class="sd">         image: image object of class ImageAICS</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">image</span><span class="p">})</span></div>

<div class="viewcode-block" id="ImagingSystem.get_attached_image"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_attached_image">[docs]</a>    <span class="k">def</span> <span class="nf">get_attached_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve attached image.</span>

<span class="sd">        Input:</span>
<span class="sd">         key:  string with name of image (e.g. &#39;backgroundGreen_10x&#39;)</span>

<span class="sd">        Output:</span>
<span class="sd">         image: image object of class ImageAICS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">image</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">get_attached_image</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># TODO: need to get a default image here</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default Image&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="ImagingSystem.remove_images"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.remove_images">[docs]</a>    <span class="k">def</span> <span class="nf">remove_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove all images from microscope software display.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">remove_images</span><span class="p">()</span></div>

    <span class="c1">################################################################################</span>
    <span class="c1">#</span>
    <span class="c1"># Get hardware ids and microscope object used to image sample</span>
    <span class="c1">#</span>
    <span class="c1">################################################################################</span>

<div class="viewcode-block" id="ImagingSystem.get_microscope"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_microscope">[docs]</a>    <span class="k">def</span> <span class="nf">get_microscope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return object that describes connection to hardware.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         microscope_object: object of class Microscope from module hardware</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">microscope_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">microscope_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope</span>
        <span class="k">return</span> <span class="n">microscope_object</span></div>

<div class="viewcode-block" id="ImagingSystem.get_stage_id"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_stage_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_stage_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return id for stage used with this sample.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         stage_id: id for stage used with this sample</span>

<span class="sd">        Searches through all containers until id is found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stage_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_id</span>
            <span class="k">if</span> <span class="n">stage_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stage_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_stage_id</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">stage_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">stage_id</span></div>

<div class="viewcode-block" id="ImagingSystem.get_focus_id"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_focus_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_focus_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return id for focus used with this sample.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         focus_id: id for focus used with this sample</span>

<span class="sd">        Searches through all containers until id is found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">focus_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span>
            <span class="k">if</span> <span class="n">focus_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">focus_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_focus_id</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">focus_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">focus_id</span></div>

<div class="viewcode-block" id="ImagingSystem.get_auto_focus_id"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_auto_focus_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_auto_focus_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return id for auto-focus used with this sample.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         auto_focus_id: id for auto-focus used with this sample</span>

<span class="sd">        Searches through all containers until id is found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">auto_focus_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_focus_id</span>
            <span class="k">if</span> <span class="n">auto_focus_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">auto_focus_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_auto_focus_id</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">auto_focus_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">auto_focus_id</span></div>

<div class="viewcode-block" id="ImagingSystem.get_objective_changer_id"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_objective_changer_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_objective_changer_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return id for objective changer used with this sample.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         objective_changer_id: id for objective changer used with this sample</span>

<span class="sd">        Searches through all containers until id is found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">objective_changer_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer_id</span>
            <span class="k">if</span> <span class="n">objective_changer_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">objective_changer_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_objective_changer_id</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">objective_changer_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">objective_changer_id</span></div>

<div class="viewcode-block" id="ImagingSystem.get_safety_id"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_safety_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_safety_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return id for safety object. Safety object describes travel safe areas</span>
<span class="sd">        for stage and objectives.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         saftey_id: id for safety object used with this sample</span>

<span class="sd">        Searches through all containers until id is found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">safety_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">safety_id</span>
            <span class="k">if</span> <span class="n">safety_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">safety_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_safety_id</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">safety_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">safety_id</span></div>

<div class="viewcode-block" id="ImagingSystem.get_camera_ids"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_camera_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return ids for cameras used with this sample.</span>
<span class="sd">        Searches through all containers until id is found.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         camera_ids: list with ids for cameras used with this sample</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">###############################################</span>
        <span class="c1"># TODO: camera_ids not implemented in container</span>
        <span class="c1">###############################################</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">camera_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_ids</span>
            <span class="k">if</span> <span class="n">camera_ids</span> <span class="ow">is</span> <span class="p">[]:</span>
                <span class="n">camera_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_camera_ids</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">camera_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">camera_ids</span></div>

<div class="viewcode-block" id="ImagingSystem.get_immersion_delivery_system"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_immersion_delivery_system">[docs]</a>    <span class="k">def</span> <span class="nf">get_immersion_delivery_system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the object that describes immersion water delivery system</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         immersion_delivery_system: object of class ImmersionDelivery</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">immersion_delivery_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">get_immersion_delivery_system</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">immersion_delivery_system</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">immersion_delivery_system</span></div>

    <span class="c1">################################################################################</span>
    <span class="c1">#</span>
    <span class="c1"># Handle meta data</span>
    <span class="c1">#</span>
    <span class="c1">################################################################################</span>

<div class="viewcode-block" id="ImagingSystem.add_meta"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.add_meta">[docs]</a>    <span class="k">def</span> <span class="nf">add_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update dictionary with meta data.</span>

<span class="sd">        Input:</span>
<span class="sd">         meta_dict: dictionary with meta data</span>

<span class="sd">        Output:</span>
<span class="sd">         updated_meta_dict: dictionary with additional meta data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span> <span class="o">=</span> <span class="n">meta_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">meta_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span></div>

<div class="viewcode-block" id="ImagingSystem.get_meta"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_meta">[docs]</a>    <span class="k">def</span> <span class="nf">get_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return dictionary with meta data.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         meta_dict: dictionary with meta data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span></div>

<div class="viewcode-block" id="ImagingSystem.add_meta_data_file"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.add_meta_data_file">[docs]</a>    <span class="k">def</span> <span class="nf">add_meta_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_data_file_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add object that handles saving of meta data to disk.</span>

<span class="sd">        Input:</span>
<span class="sd">         meta_data_file_object: object of type meta_data_file</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_data_file</span> <span class="o">=</span> <span class="n">meta_data_file_object</span></div>

<div class="viewcode-block" id="ImagingSystem.get_meta_data_file"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImagingSystem.get_meta_data_file">[docs]</a>    <span class="k">def</span> <span class="nf">get_meta_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return object that handles saving of meta data to disk.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         meta_data_file_object: object of type meta_data_file.</span>
<span class="sd">         None if no meta data file exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">meta_data_file_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data_file</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">meta_data_file_object</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">meta_data_file_object</span></div></div>


<div class="viewcode-block" id="Background"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Background">[docs]</a><span class="k">class</span> <span class="nc">Background</span><span class="p">(</span><span class="n">ImagingSystem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for the background object associated with each plate.</span>
<span class="sd">    It will be used to do background correction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Background&quot;</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">well_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">image</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ellipse</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize class Background.</span>

<span class="sd">        Input:</span>
<span class="sd">         name: id for background</span>

<span class="sd">         image: True, if background should be imaged</span>

<span class="sd">         center: (x, y, z) center of background relative to well center in mum</span>

<span class="sd">         ellipse: (long axis, short axis, orientation) for ellipse around the background</span>

<span class="sd">         meta: additional meta data for background</span>

<span class="sd">         well_object: object of type Well the background is associated with</span>

<span class="sd">         x_flip, y_flip, z_flip: -1 if coordinate system of plate holder</span>
<span class="sd">         is flipped in respect to stage</span>

<span class="sd">         x_correction, y_correction, z_correction: correction factor</span>
<span class="sd">         if there is a discrepancy between the stage and the plate holder calibration</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Background</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">well_object</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">image</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">x_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">z_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">x_flip</span><span class="o">=</span><span class="n">x_flip</span><span class="p">,</span>
            <span class="n">y_flip</span><span class="o">=</span><span class="n">y_flip</span><span class="p">,</span>
            <span class="n">z_flip</span><span class="o">=</span><span class="n">z_flip</span><span class="p">,</span>
            <span class="n">x_correction</span><span class="o">=</span><span class="n">x_correction</span><span class="p">,</span>
            <span class="n">y_correction</span><span class="o">=</span><span class="n">y_correction</span><span class="p">,</span>
            <span class="n">z_correction</span><span class="o">=</span><span class="n">z_correction</span><span class="p">,</span>
            <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="n">z_correction_y_slope</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PlateHolder"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder">[docs]</a><span class="k">class</span> <span class="nc">PlateHolder</span><span class="p">(</span><span class="n">ImagingSystem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and navigate Stage.</span>

<span class="sd">    A PlateHolder is the superclass for everything that can be imaged on a microscope</span>
<span class="sd">    (e.g. plates, wells, colonies, cells).</span>

<span class="sd">    A Stage has it&#39;s own coordinate system measured in mum and nows it&#39;s position</span>
<span class="sd">    in stage coordinates.</span>

<span class="sd">    A Stage can be moved to a position and acquire images.</span>
<span class="sd">    It will take track of the last image. To keep the image the user has to save it.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;PlateHolder&quot;</span><span class="p">,</span>
        <span class="n">microscope_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stage_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">focus_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_focus_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">objective_changer_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">immersion_delivery</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">camera_ids</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">x_safe_position</span><span class="o">=</span><span class="mi">55600</span><span class="p">,</span>
        <span class="n">y_safe_position</span><span class="o">=</span><span class="mi">31800</span><span class="p">,</span>
        <span class="n">z_safe_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send all commands to microscope hardware</span>

<span class="sd">        Input:</span>
<span class="sd">         name: string with unique name for plate holder</span>

<span class="sd">         microscope_object: object of class Microscope from module hardware</span>

<span class="sd">         stage_id: id string for stage.</span>

<span class="sd">         focus_id: id string with name for focus drive</span>

<span class="sd">         auto_focus_id: id string with name for auto-focus</span>

<span class="sd">         objective_changer_id: id string with name for objective changer</span>

<span class="sd">         safety_id: id string for safety area that prevents objective damage</span>
<span class="sd">         during stage movement</span>

<span class="sd">         immersion_delivery: instance of class ImmersionDelivery</span>

<span class="sd">         center: [x,y,z] zero position of plate holder in respect to stage</span>

<span class="sd">         x_flip, y_flip, z_flip: -1 if coordinate system of plate holder</span>
<span class="sd">         is flipped in respect to stage</span>

<span class="sd">         x_correction, y_correction, z_correction: correction factor if there</span>
<span class="sd">         is a discrepancy between the stage and the plate holder calibration</span>

<span class="sd">         x_safe_position, y_safe_position, z_safe_position: position to start any</span>
<span class="sd">         movements without danger of objective or other collisions</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">immersion_delivery_system</span> <span class="o">=</span> <span class="n">immersion_delivery</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slides</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plates</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># will hold plate objects</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PlateHolder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">x_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">z_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">x_flip</span><span class="o">=</span><span class="n">x_flip</span><span class="p">,</span>
            <span class="n">y_flip</span><span class="o">=</span><span class="n">y_flip</span><span class="p">,</span>
            <span class="n">z_flip</span><span class="o">=</span><span class="n">z_flip</span><span class="p">,</span>
            <span class="n">x_correction</span><span class="o">=</span><span class="n">x_correction</span><span class="p">,</span>
            <span class="n">y_correction</span><span class="o">=</span><span class="n">y_correction</span><span class="p">,</span>
            <span class="n">z_correction</span><span class="o">=</span><span class="n">z_correction</span><span class="p">,</span>
            <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="n">z_correction_y_slope</span><span class="p">,</span>
            <span class="n">x_safe_position</span><span class="o">=</span><span class="n">x_safe_position</span><span class="p">,</span>
            <span class="n">y_safe_position</span><span class="o">=</span><span class="n">y_safe_position</span><span class="p">,</span>
            <span class="n">z_safe_position</span><span class="o">=</span><span class="n">z_safe_position</span><span class="p">,</span>
            <span class="n">microscope_object</span><span class="o">=</span><span class="n">microscope_object</span><span class="p">,</span>
            <span class="n">stage_id</span><span class="o">=</span><span class="n">stage_id</span><span class="p">,</span>
            <span class="n">focus_id</span><span class="o">=</span><span class="n">focus_id</span><span class="p">,</span>
            <span class="n">auto_focus_id</span><span class="o">=</span><span class="n">auto_focus_id</span><span class="p">,</span>
            <span class="n">objective_changer_id</span><span class="o">=</span><span class="n">objective_changer_id</span><span class="p">,</span>
            <span class="n">safety_id</span><span class="o">=</span><span class="n">safety_id</span><span class="p">,</span>
            <span class="n">camera_ids</span><span class="o">=</span><span class="n">camera_ids</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="PlateHolder.get_microscope"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.get_microscope">[docs]</a>    <span class="k">def</span> <span class="nf">get_microscope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return object that describes connection to hardware.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         microscope_object: object of class Microscope from module hardware</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope</span></div>

<div class="viewcode-block" id="PlateHolder.get_camera_ids"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.get_camera_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of camera objects associated with this sample</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         camera_ids: list of objects of class Camera</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_ids</span></div>

<div class="viewcode-block" id="PlateHolder.get_immersion_delivery_system"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.get_immersion_delivery_system">[docs]</a>    <span class="k">def</span> <span class="nf">get_immersion_delivery_system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return object that describes immersion water delivery system for</span>
<span class="sd">        this plate holder.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         immersion_object: object of class ImmersionDelivery</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">immersion_delivery_system</span></div>

<div class="viewcode-block" id="PlateHolder.add_plates"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.add_plates">[docs]</a>    <span class="k">def</span> <span class="nf">add_plates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plate_object_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds Plate to Stage.</span>

<span class="sd">        Input:</span>
<span class="sd">         plate_object_dict: dictionary of the form {&quot;name&quot;: plate_object}</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plates</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plate_object_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlateHolder.get_plates"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.get_plates">[docs]</a>    <span class="k">def</span> <span class="nf">get_plates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return dictionary of all plate_objects associated with plateholder.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         plate_objects: dictionary with plate objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plates</span></div>

<div class="viewcode-block" id="PlateHolder.add_slides"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.add_slides">[docs]</a>    <span class="k">def</span> <span class="nf">add_slides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slide_object_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds Slide to PlateHolder.</span>

<span class="sd">        Input:</span>
<span class="sd">         slide_object_dict:dictionary of the form {&quot;name&quot;: slide_object}</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slides</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">slide_object_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlateHolder.get_slides"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.get_slides">[docs]</a>    <span class="k">def</span> <span class="nf">get_slides</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return Slide object attached to PlateHolder</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         slide_object: dictionary with slide objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slides</span></div>

<div class="viewcode-block" id="PlateHolder.set_plate_holder_pos_to_zero"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.set_plate_holder_pos_to_zero">[docs]</a>    <span class="k">def</span> <span class="nf">set_plate_holder_pos_to_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set current stage position as zero position for PlateHolder.</span>

<span class="sd">        Input:</span>
<span class="sd">         x, y, z: optional position in stage coordinates to set as zero position</span>
<span class="sd">         for PlateHolder. If omitted, actual stage position will be used.</span>

<span class="sd">        Output:</span>
<span class="sd">         x, y, z: new PlateHolder zero position</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">xStage</span><span class="p">,</span> <span class="n">yStage</span><span class="p">,</span> <span class="n">zStage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_corrected_stage_position</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">xStage</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">yStage</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">zStage</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_zero</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>

<div class="viewcode-block" id="PlateHolder.get_corrected_stage_position"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.get_corrected_stage_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_corrected_stage_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get current position in stage coordinates and focus position in mum.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         x, y, z: Stage position after centricity correction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get position in x and y from stage and z focus drive</span>
        <span class="n">positions_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span><span class="o">.</span><span class="n">get_information</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_id</span><span class="p">])</span>

        <span class="n">xy_positions</span> <span class="o">=</span> <span class="n">positions_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_id</span><span class="p">][</span><span class="s2">&quot;centricity_corrected&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xy_positions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xy_positions</span> <span class="o">=</span> <span class="n">positions_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_id</span><span class="p">][</span><span class="s2">&quot;absolute&quot;</span><span class="p">]</span>
        <span class="n">z_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span><span class="o">.</span><span class="n">get_z_position</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_focus_id</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;focality_drift_corrected&quot;</span> <span class="ow">in</span> <span class="n">z_positions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z_positions</span><span class="p">[</span><span class="s2">&quot;focality_drift_corrected&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z_positions</span><span class="p">[</span><span class="s2">&quot;absolute&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">xy_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy_positions</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span></div>

<div class="viewcode-block" id="PlateHolder.get_abs_stage_position"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.get_abs_stage_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_abs_stage_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">focus_drive_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get current position in stage coordinates and focus position</span>
<span class="sd">        in mum corrected for parcentricity.</span>

<span class="sd">        Input:</span>
<span class="sd">         stage_id: id string for stage.</span>

<span class="sd">         focus_id: id string with name for focus drive</span>

<span class="sd">        Output:</span>
<span class="sd">         x, y, z: real focus position not corrected for drift.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stage_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stage_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_id</span>
        <span class="k">if</span> <span class="n">focus_drive_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">focus_drive_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span>

        <span class="c1"># get position in x and y from stage and z focus drive</span>
        <span class="n">positions_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span><span class="o">.</span><span class="n">get_information</span><span class="p">(</span>
            <span class="p">[</span><span class="n">stage_id</span><span class="p">,</span> <span class="n">focus_drive_id</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">positions_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_id</span><span class="p">][</span><span class="s2">&quot;centricity_corrected&quot;</span><span class="p">]</span>
        <span class="n">z_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span><span class="o">.</span><span class="n">get_z_position</span><span class="p">(</span>
            <span class="n">focus_drive_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_focus_id</span>
        <span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">z_positions</span><span class="p">[</span><span class="s2">&quot;focality_corrected&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>

<div class="viewcode-block" id="PlateHolder.set_stage_position"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.set_stage_position">[docs]</a>    <span class="k">def</span> <span class="nf">set_stage_position</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_stage</span><span class="p">,</span>
        <span class="n">y_stage</span><span class="p">,</span>
        <span class="n">z_stage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">reference_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move stage to position in stage coordinates in mum.</span>

<span class="sd">        Input:</span>
<span class="sd">         x_stage, y_stage, z_stage: stage position in mum</span>

<span class="sd">         reference_object: object of type sample (ImagingSystem).</span>
<span class="sd">         Used to correct for xyz offset between different objectives</span>

<span class="sd">         load: Move focus in load position before move. Default: True</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x, y, z: actual stage position</span>

<span class="sd">        If use_autofocus is set, correct z value according to new autofocus position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">reference_object</span><span class="p">:</span>
            <span class="n">reference_object_id</span> <span class="o">=</span> <span class="n">reference_object</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reference_object_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope</span><span class="o">.</span><span class="n">move_to_abs_pos</span><span class="p">(</span>
            <span class="n">stage_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_id</span><span class="p">,</span>
            <span class="n">focus_drive_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span><span class="p">,</span>
            <span class="n">objective_changer_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objective_changer_id</span><span class="p">,</span>
            <span class="n">auto_focus_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_focus_id</span><span class="p">,</span>
            <span class="n">safety_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">safety_id</span><span class="p">,</span>
            <span class="n">x_target</span><span class="o">=</span><span class="n">x_stage</span><span class="p">,</span>
            <span class="n">y_target</span><span class="o">=</span><span class="n">y_stage</span><span class="p">,</span>
            <span class="n">z_target</span><span class="o">=</span><span class="n">z_stage</span><span class="p">,</span>
            <span class="n">reference_object_id</span><span class="o">=</span><span class="n">reference_object_id</span><span class="p">,</span>
            <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>

<div class="viewcode-block" id="PlateHolder.set_use_autofocus"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.set_use_autofocus">[docs]</a>    <span class="k">def</span> <span class="nf">set_use_autofocus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set flag to enable the use of autofocus.</span>

<span class="sd">        Input:</span>
<span class="sd">         flag: if true, use autofocus</span>

<span class="sd">        Output:</span>
<span class="sd">         use_autofocus: status of use_autofocus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">microscope_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span>
        <span class="n">microscope_object</span><span class="o">.</span><span class="n">set_microscope</span><span class="p">(</span>
            <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_auto_focus_id</span><span class="p">():</span> <span class="p">{</span><span class="s2">&quot;use_auto_focus&quot;</span><span class="p">:</span> <span class="n">flag</span><span class="p">}}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_use_autofocus</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlateHolder.get_use_autofocus"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.get_use_autofocus">[docs]</a>    <span class="k">def</span> <span class="nf">get_use_autofocus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return flag about autofocus usage</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         use_autofocus: boolean variable indicating if autofocus should be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">microscope_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span>
        <span class="n">use_autofocus</span> <span class="o">=</span> <span class="n">microscope_object</span><span class="o">.</span><span class="n">get_information</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_auto_focus_id</span><span class="p">()])[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_auto_focus_id</span><span class="p">()</span>
        <span class="p">][</span><span class="s2">&quot;use&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">use_autofocus</span></div>

<div class="viewcode-block" id="PlateHolder.find_surface"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.find_surface">[docs]</a>    <span class="k">def</span> <span class="nf">find_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find cover slip using Definite Focus 2 and store position</span>
<span class="sd">        focus_drive object</span>

<span class="sd">        Input:</span>
<span class="sd">         reference_object: Used for setting up of autofocus</span>

<span class="sd">         trials: number of trials before initialization is aborted</span>

<span class="sd">         verbose: if True, print debug messages (Default: True)</span>

<span class="sd">        Output:</span>
<span class="sd">         positions_dict: dictionary {&#39;absolute&#39;: z_abs, &#39;focality_corrected&#39;: z_cor}</span>
<span class="sd">         with focus position in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">reference_object</span><span class="p">:</span>
            <span class="n">reference_object_id</span> <span class="o">=</span> <span class="n">reference_object</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reference_object_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">microscope_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span>
        <span class="n">microscope_object</span><span class="o">.</span><span class="n">initialize_hardware</span><span class="p">(</span>
            <span class="n">initialize_components_ordered_dict</span><span class="o">=</span><span class="p">{</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_auto_focus_id</span><span class="p">():</span> <span class="p">[</span><span class="s2">&quot;find_surface&quot;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">reference_object_id</span><span class="o">=</span><span class="n">reference_object_id</span><span class="p">,</span>
            <span class="n">trials</span><span class="o">=</span><span class="n">trials</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">positions_dict</span> <span class="o">=</span> <span class="n">microscope_object</span><span class="o">.</span><span class="n">get_information</span><span class="p">(</span>
            <span class="n">components_list</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_auto_focus_id</span><span class="p">()]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">positions_dict</span></div>

<div class="viewcode-block" id="PlateHolder.store_focus"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.store_focus">[docs]</a>    <span class="k">def</span> <span class="nf">store_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus_reference_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store actual focus position as offset from coverslip.</span>

<span class="sd">        Input:</span>
<span class="sd">         focus_reference_obj: Sample object used as reference for autofocus</span>

<span class="sd">         trials: number of trials before initialization is aborted</span>

<span class="sd">         verbose: if True, print debug messages (Default: True)</span>

<span class="sd">        Output:</span>
<span class="sd">         positions_dict: dictionary {&#39;absolute&#39;: z_abs, &#39;focality_corrected&#39;: z_cor}</span>
<span class="sd">         with focus position in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">focus_reference_obj</span><span class="p">:</span>
            <span class="n">reference_object_id</span> <span class="o">=</span> <span class="n">focus_reference_obj</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reference_object_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">microscope_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span>
        <span class="n">microscope_object</span><span class="o">.</span><span class="n">initialize_hardware</span><span class="p">(</span>
            <span class="n">initialize_components_ordered_dict</span><span class="o">=</span><span class="p">{</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_auto_focus_id</span><span class="p">():</span> <span class="p">[</span><span class="s2">&quot;no_find_surface&quot;</span><span class="p">,</span> <span class="s2">&quot;no_interaction&quot;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">reference_object_id</span><span class="o">=</span><span class="n">reference_object_id</span><span class="p">,</span>
            <span class="n">trials</span><span class="o">=</span><span class="n">trials</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">positions_dict</span> <span class="o">=</span> <span class="n">microscope_object</span><span class="o">.</span><span class="n">get_information</span><span class="p">(</span>
            <span class="n">components_list</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_auto_focus_id</span><span class="p">()]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">positions_dict</span></div>

<div class="viewcode-block" id="PlateHolder.execute_experiment"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.execute_experiment">[docs]</a>    <span class="k">def</span> <span class="nf">execute_experiment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">experiment</span><span class="p">,</span>
        <span class="n">camera_id</span><span class="p">,</span>
        <span class="n">reference_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meta_dict</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;aics_well&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;aics_barcode&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;aics_xTile&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;aics_yTile&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Acquire image using settings defined in microscope software</span>
<span class="sd">        and optionally save.</span>

<span class="sd">        Input:</span>
<span class="sd">         experiment: string with experiment name as defined within microscope software</span>

<span class="sd">         camera_id: string with unique camera ID</span>

<span class="sd">         reference_object: object of type sample (ImagingSystem) used to correct for .</span>
<span class="sd">         xyz offset between different objectives</span>

<span class="sd">         file_path: filename with path to save image in original format.</span>
<span class="sd">         Default=None: no saving</span>

<span class="sd">         meta_dict: directory with additional meta data, e.g. {&#39;aics_well&#39;:, &#39;A1&#39;}</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">          image: image of class ImageAICS</span>

<span class="sd">        Method adds camera_id to image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The method execute_experiment will send a command to the microscope</span>
        <span class="c1"># software to acquire an image.</span>
        <span class="c1"># experiment is the name of the settings used by the microscope software</span>
        <span class="c1"># to acquire the image. The method does not return the image, nor does it</span>
        <span class="c1"># save it. use PlateHolder.save_image to trigger the microscope software</span>
        <span class="c1"># to save the image.</span>
        <span class="k">if</span> <span class="n">reference_object</span><span class="p">:</span>
            <span class="n">reference_object_id</span> <span class="o">=</span> <span class="n">reference_object</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reference_object_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Use an instance of Microscope from module hardware.</span>
        <span class="n">microscope_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">microscope_instance</span><span class="o">.</span><span class="n">execute_experiment</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span>

        <span class="c1"># retrieve information about camera and add to meta data</span>
        <span class="n">image</span><span class="o">.</span><span class="n">add_meta</span><span class="p">({</span><span class="s2">&quot;aics_cameraID&quot;</span><span class="p">:</span> <span class="n">camera_id</span><span class="p">})</span>

        <span class="c1"># retrieve information hardware status</span>
        <span class="n">information_dict</span> <span class="o">=</span> <span class="n">microscope_instance</span><span class="o">.</span><span class="n">get_information</span><span class="p">()</span>
        <span class="n">stage_z_corrected</span> <span class="o">=</span> <span class="n">microscope_instance</span><span class="o">.</span><span class="n">get_z_position</span><span class="p">(</span>
            <span class="n">focus_drive_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span><span class="p">,</span>
            <span class="n">auto_focus_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_focus_id</span><span class="p">,</span>
            <span class="n">reference_object_id</span><span class="o">=</span><span class="n">reference_object_id</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">information_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_id</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">image</span><span class="o">.</span><span class="n">add_meta</span><span class="p">({</span><span class="s2">&quot;aics_imagePosX (&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
            <span class="n">image</span><span class="o">.</span><span class="n">add_meta</span><span class="p">({</span><span class="s2">&quot;aics_imagePosX (&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>

        <span class="c1"># stage_z_corrected is dictionary with</span>
        <span class="c1">#     &#39;absolute&#39;: absolute position of focus drive as shown in software</span>
        <span class="c1">#     &#39;z_focus_offset&#39;: parfocality offset</span>
        <span class="c1">#     &#39;focality_corrected&#39;: absolute focus position - z_focus_offset</span>
        <span class="c1">#     &#39;auto_focus_offset&#39;: change in autofocus position</span>
        <span class="c1">#     &#39;focality_drift_corrected&#39;: focality_corrected position -</span>
        <span class="c1">#         auto_focus_offset</span>
        <span class="c1">#     &#39;load_position&#39;: load position of focus drive</span>
        <span class="c1">#     &#39;work_position&#39;: work position of focus drive</span>
        <span class="c1"># with focus positions in um</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">stage_z_corrected</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">image</span><span class="o">.</span><span class="n">add_meta</span><span class="p">({</span><span class="s2">&quot;aics_imagePosZ (&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span> <span class="n">position</span><span class="p">})</span>

        <span class="c1"># image.add_meta({&#39;aics_imageAbsPosZ&#39;: stage_z_corrected[&#39;absolute&#39;]})</span>
        <span class="c1"># image.add_meta({&#39;aics_imageAbsPosZ(focality_corrected)&#39;: stage_z_corrected[&#39;focality_corrected&#39;]})  # noqa</span>
        <span class="c1"># image.add_meta({&#39;aics_imageAbsPosZ(z_focus_offset)&#39;: stage_z_corrected[&#39;z_focus_offset&#39;]})  # noqa</span>
        <span class="c1"># image.add_meta({&#39;aics_imageAbsPosZ(focality_drift_corrected)&#39;: stage_z_corrected[&#39;focality_drift_corrected&#39;]})  # noqa</span>
        <span class="c1"># image.add_meta({&#39;aics_imageAbsPosZ(auto_focus_offset)&#39;: stage_z_corrected[&#39;auto_focus_offset&#39;]})  # noqa</span>
        <span class="c1"># image.add_meta({&#39;aics_imageAbsPosZ(load_position)&#39;: stage_z_corrected[&#39;load_position&#39;]})  # noqa</span>
        <span class="c1"># image.add_meta({&#39;aics_imageAbsPosZ(work_position)&#39;: stage_z_corrected[&#39;work_position&#39;]})  # noqa</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer_id</span> <span class="ow">in</span> <span class="n">information_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">image</span><span class="o">.</span><span class="n">add_meta</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;aics_objectiveMagnification&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="n">information_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">objective_changer_id</span><span class="p">][</span><span class="s2">&quot;magnification&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;aics_objectiveName&quot;</span><span class="p">:</span> <span class="n">information_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">objective_changer_id</span><span class="p">][</span>
                        <span class="s2">&quot;name&quot;</span>
                    <span class="p">],</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="c1"># add meta data imported into method</span>
        <span class="n">image</span><span class="o">.</span><span class="n">add_meta</span><span class="p">(</span><span class="n">meta_dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="PlateHolder.recall_focus"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.recall_focus">[docs]</a>    <span class="k">def</span> <span class="nf">recall_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto_focus_id</span><span class="p">,</span> <span class="n">pre_set_focus</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find difference between stored focus position and actual autofocus position.</span>
<span class="sd">        Recall focus will move the focus drive to it&#39;s stored position.</span>

<span class="sd">        Input:</span>
<span class="sd">         auto_focus_id: string of ID for autofocus to use</span>

<span class="sd">         pre_set_focus: Move focus to previous auto-focus position.</span>
<span class="sd">         This makes definite focus more robust</span>

<span class="sd">        Output:</span>
<span class="sd">          delta_z: difference between stored z position of focus drive</span>
<span class="sd">          and position after recall focus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope</span><span class="o">.</span><span class="n">recall_focus</span><span class="p">(</span>
            <span class="n">auto_focus_id</span><span class="p">,</span>
            <span class="n">reference_object_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
            <span class="n">pre_set_focus</span><span class="o">=</span><span class="n">pre_set_focus</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PlateHolder.live_mode_start"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.live_mode_start">[docs]</a>    <span class="k">def</span> <span class="nf">live_mode_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start live mode in microscope software.</span>

<span class="sd">        Input:</span>
<span class="sd">         camera_id: string with unique camera ID</span>

<span class="sd">         experiment: string with experiment name as defined within microscope software</span>
<span class="sd">         If None use actual experiment.</span>

<span class="sd">        Output:</span>
<span class="sd">          none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use an instance of a Camera from module hardware.</span>
        <span class="c1"># The method starts live mode for adjustments in the software.</span>
        <span class="c1"># It does not acquire an image</span>
        <span class="c1"># experiment is the name of the settings used by the microscope software</span>
        <span class="c1"># to acquire the image.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microscope</span><span class="o">.</span><span class="n">live_mode</span><span class="p">(</span><span class="n">camera_id</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">live</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlateHolder.live_mode_stop"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.live_mode_stop">[docs]</a>    <span class="k">def</span> <span class="nf">live_mode_stop</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">camera_id</span><span class="p">,</span>
        <span class="n">experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start live mode in microscopy software.</span>

<span class="sd">        Input:</span>
<span class="sd">         camera_id: string with unique camera ID</span>

<span class="sd">         experiment: string with experiment name as defined within microscope software</span>
<span class="sd">         If None use actual experiment.</span>

<span class="sd">        Output:</span>
<span class="sd">          None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use an instance of a Camera from module hardware.</span>
        <span class="c1"># The method stops live mode for adjustments in the software.</span>
        <span class="c1"># It does not acquire an image</span>
        <span class="c1"># experiment is the name of the settings used by the microscope software</span>
        <span class="c1"># to acquire the image.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microscope</span><span class="o">.</span><span class="n">live_mode</span><span class="p">(</span><span class="n">camera_id</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">live</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlateHolder.save_image"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.save_image">[docs]</a>    <span class="k">def</span> <span class="nf">save_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;save original image acquired with given camera using microscope software</span>

<span class="sd">        Input:</span>
<span class="sd">         file_path: string with filename with path for saved image in original format</span>
<span class="sd">         or tuple with path to directory and template for file name</span>

<span class="sd">         camera_id: name of camera used for data acquisition</span>

<span class="sd">         image: image of class ImageAICS</span>

<span class="sd">        Output:</span>
<span class="sd">         image: image of class ImageAICS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if file_path is a string use this string</span>
        <span class="c1"># if file_path is a list create file name including meta data defined in list</span>
        <span class="n">file_path_updated</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">create_file_name</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="c1"># create new filename if filename already exists</span>
        <span class="n">splitExt</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path_updated</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Do Not need the file_path counter - Better for uploading it to FMS</span>
                <span class="c1"># file_pathCounter = splitExt[0] + &#39;_{}&#39;.format(counter) + splitExt[1]</span>
                <span class="c1"># image=self.cameras[camera_id].save_image(file_pathCounter, image)</span>
                <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="n">file_path_updated</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
                <span class="c1"># We need to update the file_path, otherwise there&#39;s an infinite loop</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">file_path_updated</span> <span class="o">=</span> <span class="n">splitExt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span> <span class="o">+</span> <span class="n">splitExt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">meta_data</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_meta_data_file</span><span class="p">()</span><span class="o">.</span><span class="n">write_meta</span><span class="p">(</span><span class="n">meta_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">MetaDataNotSavedError</span><span class="p">(</span>
                <span class="s2">&quot;Sample object </span><span class="si">{}</span><span class="s2"> has not meta data file path.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="PlateHolder.load_image"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.load_image">[docs]</a>    <span class="k">def</span> <span class="nf">load_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">get_meta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;load image and meta data in object of type ImageAICS</span>

<span class="sd">        Input:</span>
<span class="sd">         image: meta data as ImageAICS object. No image data loaded so far</span>
<span class="sd">         (if image data exists, it will be replaced)</span>

<span class="sd">         get_meta: boolean of whether to obtain meta data for the image</span>

<span class="sd">        Output:</span>
<span class="sd">         image: image and meta data (if requested) as ImageAICS object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">get_meta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="PlateHolder.remove_images"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.PlateHolder.remove_images">[docs]</a>    <span class="k">def</span> <span class="nf">remove_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove all images from microscope software display.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span><span class="o">.</span><span class="n">remove_images</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="ImmersionDelivery"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImmersionDelivery">[docs]</a><span class="k">class</span> <span class="nc">ImmersionDelivery</span><span class="p">(</span><span class="n">ImagingSystem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for pump and tubing to deliver immersion water to objective.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ImmersionDelivery&quot;</span><span class="p">,</span>
        <span class="n">plate_holder_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pump_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">microscope_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize immersion water delivery system.</span>

<span class="sd">        Input:</span>
<span class="sd">         name: name of immersion delivery system (string)</span>

<span class="sd">         plate_holder_object: objet for plateHolder the system is attached to</span>

<span class="sd">         safety_id: id string for safety area that prevents objective damage</span>
<span class="sd">         during stage movement</span>

<span class="sd">         center: position of the water outlet in plateholder coordinates in mum</span>

<span class="sd">         x_flip, y_flip, z_flip: -1 if coordinate system of plate holder</span>
<span class="sd">         is flipped in respect to stage</span>

<span class="sd">         x_correction, y_correction, z_correction: correction factor if</span>
<span class="sd">         there is a discrepancy between the stage and the plate holder calibration</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImmersionDelivery</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">plate_holder_object</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">x_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">z_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">x_correction</span><span class="o">=</span><span class="n">x_correction</span><span class="p">,</span>
            <span class="n">y_correction</span><span class="o">=</span><span class="n">y_correction</span><span class="p">,</span>
            <span class="n">z_correction</span><span class="o">=</span><span class="n">z_correction</span><span class="p">,</span>
            <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="n">z_correction_y_slope</span><span class="p">,</span>
            <span class="n">microscope_object</span><span class="o">=</span><span class="n">microscope_object</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_pump_id</span><span class="p">(</span><span class="n">pump_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safety_id</span> <span class="o">=</span> <span class="n">safety_id</span>
        <span class="c1"># counter will be incremented by self.add_counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="ImmersionDelivery.set_pump_id"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImmersionDelivery.set_pump_id">[docs]</a>    <span class="k">def</span> <span class="nf">set_pump_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pump_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store id of pump associated with this ImmersionDelivery object.</span>

<span class="sd">        Input:</span>
<span class="sd">         stage_id: id string for pump</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span> <span class="o">=</span> <span class="n">pump_id</span></div>

<div class="viewcode-block" id="ImmersionDelivery.get_pump_id"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImmersionDelivery.get_pump_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_pump_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return id for pump used with this ImmersionDelivery object.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         pump_id: id for objective changer used with this sample</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span></div>

<div class="viewcode-block" id="ImmersionDelivery.trigger_pump"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImmersionDelivery.trigger_pump">[docs]</a>    <span class="k">def</span> <span class="nf">trigger_pump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pump_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Trigger pump to deliver immersion water.</span>

<span class="sd">        Input:</span>
<span class="sd">         pump_id: id of pump to trigger. None by default, which selects the pump_id</span>
<span class="sd">         already associated with this ImmersionDelivery object</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pump_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span><span class="o">.</span><span class="n">trigger_pump</span><span class="p">(</span><span class="n">pump_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span><span class="o">.</span><span class="n">trigger_pump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pump_id</span><span class="p">())</span></div>

<div class="viewcode-block" id="ImmersionDelivery.get_water"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImmersionDelivery.get_water">[docs]</a>    <span class="k">def</span> <span class="nf">get_water</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">objective_magnification</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pump_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">automatic</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move objective to water outlet and add drop of water to objective.</span>

<span class="sd">        Input:</span>
<span class="sd">         objective_magnification: add water to specific objective with given</span>
<span class="sd">         magnification as float number. Keep current objective if set to None.</span>

<span class="sd">         pump_id: id of pump to trigger. None by default, which selects the pump_id</span>
<span class="sd">         already associated with this ImmersionDelivery object</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">         automatic: if True, trigger pump, else show dialog</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get autofocus status and switch off autofocus</span>
        <span class="n">autofocus_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_use_autofocus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_use_autofocus</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Get original position of stage and focus</span>
        <span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">z_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_position</span><span class="p">()</span>
        <span class="c1"># Move objective in load positionss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microscope</span><span class="o">.</span><span class="n">goto_load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_focus_id</span><span class="p">())</span>

        <span class="c1"># Change objective</span>
        <span class="k">if</span> <span class="n">objective_magnification</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># objective_changer_object = self.get_objective_changer_id()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_microscope</span><span class="p">()</span><span class="o">.</span><span class="n">change_magnification</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_objective_changer_id</span><span class="p">(),</span>
                    <span class="n">objective_magnification</span><span class="p">,</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="n">use_safe_position</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">ObjectiveNotDefinedError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="n">message</span><span class="o">.</span><span class="n">error_message</span><span class="p">(</span>
                    <span class="s1">&#39;Please switch objective manually.</span><span class="se">\n</span><span class="s1">Error:</span><span class="se">\n</span><span class="s1">&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">error</span><span class="o">.</span><span class="n">message</span>
                    <span class="p">),</span>
                    <span class="n">returnCode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="c1"># Move objective below water outlet, do not use autofocus</span>
        <span class="n">store_autofocus_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_use_autofocus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_use_autofocus</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to_zero</span><span class="p">(</span><span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_use_autofocus</span><span class="p">(</span><span class="n">store_autofocus_flag</span><span class="p">)</span>
        <span class="c1"># trigger pump</span>
        <span class="k">if</span> <span class="n">automatic</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_pump</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span><span class="o">.</span><span class="n">operate_message</span><span class="p">(</span>
                <span class="s2">&quot;Please add immersion water to objective.&quot;</span><span class="p">,</span> <span class="n">returnCode</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>

        <span class="c1"># Return to original position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to_abs_position</span><span class="p">(</span>
            <span class="n">x_pos</span><span class="p">,</span>
            <span class="n">y_pos</span><span class="p">,</span>
            <span class="n">z_pos</span><span class="p">,</span>
            <span class="n">reference_object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_reference_object</span><span class="p">(),</span>
            <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Switch autofocus back on if it was switch on when starting get_water</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_use_autofocus</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="n">autofocus_use</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImmersionDelivery.add_counter"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImmersionDelivery.add_counter">[docs]</a>    <span class="k">def</span> <span class="nf">add_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">increment</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Increment counter.</span>

<span class="sd">        Input:</span>
<span class="sd">         increment: integer to increment counter value.</span>
<span class="sd">                     default = 1</span>

<span class="sd">        Output:</span>
<span class="sd">         count: counter setting after increment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="n">increment</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span></div>

<div class="viewcode-block" id="ImmersionDelivery.get_counter"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImmersionDelivery.get_counter">[docs]</a>    <span class="k">def</span> <span class="nf">get_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get current counter value.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         count: current counter value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span></div>

<div class="viewcode-block" id="ImmersionDelivery.reset_counter"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImmersionDelivery.reset_counter">[docs]</a>    <span class="k">def</span> <span class="nf">reset_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset counter value to 0.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         count: current counter value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span></div>

<div class="viewcode-block" id="ImmersionDelivery.set_counter_stop_value"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImmersionDelivery.set_counter_stop_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_counter_stop_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counter_stop_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set value to stop counter and trigger pumping of immersion water.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         counter_stop_value: current counter stop value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter_stop_value</span> <span class="o">=</span> <span class="n">counter_stop_value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter_stop_value</span></div>

<div class="viewcode-block" id="ImmersionDelivery.get_counter_stop_value"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImmersionDelivery.get_counter_stop_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_counter_stop_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get value for counter to stop.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         counter_stop_value: value for counter to stop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">counter_stop_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter_stop_value</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">counter_stop_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">counter_stop_value</span></div>

<div class="viewcode-block" id="ImmersionDelivery.count_and_get_water"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.ImmersionDelivery.count_and_get_water">[docs]</a>    <span class="k">def</span> <span class="nf">count_and_get_water</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">objective_magnification</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pump_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">increment</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">automatic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move objective to water outlet and add drop of water to objective.</span>

<span class="sd">        Input:</span>
<span class="sd">         objective_magnification: add water to specific objective with given</span>
<span class="sd">         magnification as float number. Keep current objective if set to None.</span>

<span class="sd">         pump_id: id of pump to trigger. None by default, which selects the pump_id</span>
<span class="sd">         already associated with this ImmersionDelivery object</span>

<span class="sd">         increment: integer to increment counter value. Default = 1</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">         automatic: if True, trigger pump, else show dialog (Default = False)</span>

<span class="sd">        Output:</span>
<span class="sd">         counter: counter value after increment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_counter_stop_value</span><span class="p">():</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_counter</span><span class="p">(</span><span class="n">increment</span><span class="o">=</span><span class="n">increment</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_water</span><span class="p">(</span>
                <span class="n">objective_magnification</span><span class="o">=</span><span class="n">objective_magnification</span><span class="p">,</span>
                <span class="n">pump_id</span><span class="o">=</span><span class="n">pump_id</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="n">automatic</span><span class="o">=</span><span class="n">automatic</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">counter</span></div></div>


<div class="viewcode-block" id="Plate"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Plate">[docs]</a><span class="k">class</span> <span class="nc">Plate</span><span class="p">(</span><span class="n">ImagingSystem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and navigate Plate.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Plate&quot;</span><span class="p">,</span>
        <span class="n">plate_holder_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="c1"># reference_well = None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize microwell plate</span>

<span class="sd">        Input:</span>
<span class="sd">         microscope_object: object of class Microscope from module hardware</span>

<span class="sd">         name: name of plate, typically barcode</span>

<span class="sd">         x_flip, y_flip, z_flip: -1 if coordinate system of plate holder</span>
<span class="sd">         is flipped in respect to stage</span>

<span class="sd">         x_correction, y_correction, z_correction: correction factor if there is a</span>
<span class="sd">         discrepancy between the stage and the plate holder calibration</span>

<span class="sd">         reference_well: name of reference well to get initial coordinates</span>
<span class="sd">         for reference position to correct parfocality</span>

<span class="sd">        Output:</span>
<span class="sd">         None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Plate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">plate_holder_object</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">x_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">z_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">x_flip</span><span class="o">=</span><span class="n">x_flip</span><span class="p">,</span>
            <span class="n">y_flip</span><span class="o">=</span><span class="n">y_flip</span><span class="p">,</span>
            <span class="n">z_flip</span><span class="o">=</span><span class="n">z_flip</span><span class="p">,</span>
            <span class="n">x_correction</span><span class="o">=</span><span class="n">x_correction</span><span class="p">,</span>
            <span class="n">y_correction</span><span class="o">=</span><span class="n">y_correction</span><span class="p">,</span>
            <span class="n">z_correction</span><span class="o">=</span><span class="n">z_correction</span><span class="p">,</span>
            <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="n">z_correction_y_slope</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># self.name=name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">plate_holder_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wells</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># reference well to get initial coordinates for reference position</span>
        <span class="c1"># to correct parfocality</span>
        <span class="c1"># self.reference_well = reference_well</span>

<div class="viewcode-block" id="Plate.set_barcode"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Plate.set_barcode">[docs]</a>    <span class="k">def</span> <span class="nf">set_barcode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">barcode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set barcode for plate.</span>

<span class="sd">        Input:</span>
<span class="sd">         barcode: string with barcode</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barcode</span> <span class="o">=</span> <span class="n">barcode</span></div>

<div class="viewcode-block" id="Plate.get_barcode"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Plate.get_barcode">[docs]</a>    <span class="k">def</span> <span class="nf">get_barcode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get barcode for plate.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         barcode: string with barcode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">barcode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">barcode</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">barcode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">barcode</span></div>

<div class="viewcode-block" id="Plate.add_wells"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Plate.add_wells">[docs]</a>    <span class="k">def</span> <span class="nf">add_wells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">well_objects_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds well to plate.</span>

<span class="sd">        Input:</span>
<span class="sd">         well_objects_dict: dictionary of form {&#39;name&#39;: instance of Well class}</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">well_objects_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Plate.get_wells"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Plate.get_wells">[docs]</a>    <span class="k">def</span> <span class="nf">get_wells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return list with all instancess of class Well associated with plate.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         wells: dict with well objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span></div>

<div class="viewcode-block" id="Plate.get_wells_by_type"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Plate.get_wells_by_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_wells_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return dictionary with all Well Objects associated with plate that</span>
<span class="sd">        contain samples of given type.</span>

<span class="sd">        Input:</span>
<span class="sd">         sample_type: string or set with sample type(s)</span>
<span class="sd">         (e.g. {&#39;Sample&#39;, &#39;Colony&#39;, &#39;Barcode&#39;})</span>

<span class="sd">        Output:</span>
<span class="sd">         well_objects_of_type: dict with well objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create set of sample_type if only one same type was given as string</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">sample_type</span> <span class="o">=</span> <span class="p">{</span><span class="n">sample_type</span><span class="p">}</span>
            <span class="c1"># retrieve list of all well objects for plate</span>
            <span class="n">well_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wells</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">well_objects</span><span class="p">)</span>
            <span class="n">well_objects_of_type</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">well_name</span><span class="p">:</span> <span class="n">well_object</span>
                <span class="k">for</span> <span class="n">well_name</span><span class="p">,</span> <span class="n">well_object</span> <span class="ow">in</span> <span class="n">well_objects</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">well_object</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="n">sample_type</span><span class="o">=</span><span class="n">sample_type</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">well_objects_of_type</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">well_objects_of_type</span></div>

<div class="viewcode-block" id="Plate.get_well"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Plate.get_well">[docs]</a>    <span class="k">def</span> <span class="nf">get_well</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">well_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return wellOjbect for well with name wellName.</span>

<span class="sd">        Input:</span>
<span class="sd">         well_name: name of well in form &#39;A1&#39;</span>

<span class="sd">        Output:</span>
<span class="sd">         well_object: object for one well with name wellName.</span>
<span class="sd">         None if no Well object with well_name exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">well_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Plate.move_to_well"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Plate.move_to_well">[docs]</a>    <span class="k">def</span> <span class="nf">move_to_well</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">well</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Moves stage to center of well</span>

<span class="sd">        Input:</span>
<span class="sd">         well: name of well in format &#39;A1&#39;</span>

<span class="sd">        Output:</span>
<span class="sd">         x_stage, y_stage, z_stage: x, y, z position on Stage in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">well_x</span><span class="p">,</span> <span class="n">well_y</span><span class="p">,</span> <span class="n">well_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_well</span><span class="p">(</span><span class="n">well</span><span class="p">)</span><span class="o">.</span><span class="n">get_zero</span><span class="p">()</span>
        <span class="n">x_stage</span><span class="p">,</span> <span class="n">y_stage</span><span class="p">,</span> <span class="n">z_stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_zero</span><span class="p">(</span><span class="n">well_x</span><span class="p">,</span> <span class="n">well_y</span><span class="p">,</span> <span class="n">well_z</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x_stage</span><span class="p">,</span> <span class="n">y_stage</span><span class="p">,</span> <span class="n">z_stage</span></div>

<div class="viewcode-block" id="Plate.show"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Plate.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_col</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">n_row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="mf">22.05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;show ImageAICS of plate layout</span>

<span class="sd">        Input:</span>
<span class="sd">         n_col: number of columns, labeled from 1 to n_col</span>

<span class="sd">         n_row: number of rows, labeled alphabetically</span>

<span class="sd">         pitch: distance between individual wells in mm</span>

<span class="sd">         diameter: diameter of Well in mm</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">draw_plate</span><span class="p">(</span><span class="n">n_col</span><span class="p">,</span> <span class="n">n_row</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">diameter</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Slide"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Slide">[docs]</a><span class="k">class</span> <span class="nc">Slide</span><span class="p">(</span><span class="n">ImagingSystem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and navigate slide.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Slide&quot;</span><span class="p">,</span>
        <span class="n">plate_holder_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize slide</span>

<span class="sd">        Input:</span>
<span class="sd">         plate_holder_object: object of class PlateHolder</span>

<span class="sd">         name: name of slide</span>

<span class="sd">         x_flip, y_flip, z_flip: -1 if coordinate system of plate holder</span>
<span class="sd">         is flipped in respect to stage</span>

<span class="sd">         x_correction, y_correction, z_correction: correction factor if</span>
<span class="sd">         there is a discrepancy between the stage and the plate holder calibration</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Slide</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">plate_holder_object</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">x_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">z_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">x_flip</span><span class="o">=</span><span class="n">x_flip</span><span class="p">,</span>
            <span class="n">y_flip</span><span class="o">=</span><span class="n">y_flip</span><span class="p">,</span>
            <span class="n">z_flip</span><span class="o">=</span><span class="n">z_flip</span><span class="p">,</span>
            <span class="n">x_correction</span><span class="o">=</span><span class="n">x_correction</span><span class="p">,</span>
            <span class="n">y_correction</span><span class="o">=</span><span class="n">y_correction</span><span class="p">,</span>
            <span class="n">z_correction</span><span class="o">=</span><span class="n">z_correction</span><span class="p">,</span>
            <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="n">z_correction_y_slope</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">plate_holder_object</span></div>


<div class="viewcode-block" id="Well"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well">[docs]</a><span class="k">class</span> <span class="nc">Well</span><span class="p">(</span><span class="n">ImagingSystem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and navigate single Well&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Well&quot;</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">diameter</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">plate_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">well_position_numeric</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">well_position_string</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">),</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize class Well</span>

<span class="sd">        Input:</span>
<span class="sd">         name: string with well name in format &#39;A1&#39;</span>

<span class="sd">         center: center position of well in plate coordinates in mum</span>

<span class="sd">         diameter: diameter of well in mum</span>

<span class="sd">         plate_object: object of type Plate the well is associated with</span>

<span class="sd">         well_position_numeric: (column, row) as integer tuple (e.g. (0,0) for well A1)</span>

<span class="sd">         well_position_string: (row, column) as string tuple (e.g. (&#39;A&#39;,&#39;1&#39;))</span>

<span class="sd">         x_flip, y_flip, z_flip: -1 if coordinate system of plate holder</span>
<span class="sd">         is flipped in respect to stage</span>

<span class="sd">         x_correction, y_correction, z_correction: correction factor if there</span>
<span class="sd">         is a discrepancy between the stage and the plate holder calibration</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Well</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">plate_object</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">x_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">z_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">x_flip</span><span class="o">=</span><span class="n">x_flip</span><span class="p">,</span>
            <span class="n">y_flip</span><span class="o">=</span><span class="n">y_flip</span><span class="p">,</span>
            <span class="n">z_flip</span><span class="o">=</span><span class="n">z_flip</span><span class="p">,</span>
            <span class="n">x_correction</span><span class="o">=</span><span class="n">x_correction</span><span class="p">,</span>
            <span class="n">y_correction</span><span class="o">=</span><span class="n">y_correction</span><span class="p">,</span>
            <span class="n">z_correction</span><span class="o">=</span><span class="n">z_correction</span><span class="p">,</span>
            <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="n">z_correction_y_slope</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># As long as only a set diameter from specifications exists,</span>
        <span class="c1"># use this value for all calculation.</span>
        <span class="c1"># Replace this value with a measured value as soon as possible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_diameter</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_assigned_diameter</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_well_position_numeric</span><span class="p">(</span><span class="n">well_position_numeric</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_well_position_string</span><span class="p">(</span><span class="n">well_position_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_failed_image</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Well.get_name"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>

<div class="viewcode-block" id="Well.get_failed_image"><a class="viewcode-back" href="../../../microscope_automation.samples.html#microscope_automation.samples.samples.Well.get_failed_image">[docs]</a>    <span class="k">def</span> <span class="nf">get_failed_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_failed_image</span></div>

<div class="viewcode-block" id="Well.set_interactive_positions"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.set_interactive_positions">[docs]</a>    <span class="k">def</span> <span class="nf">set_interactive_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tile_image_data</span><span class="p">,</span> <span class="n">location_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">app</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Opens up the interactive mode and lets user select colonies</span>
<span class="sd">        and return the list of coordinates selected</span>

<span class="sd">        Input:</span>
<span class="sd">         tile_image_data: The pixel data of the image of the well - numpy array</span>

<span class="sd">         location_list: The list of coordinates to be pre plotted on the image.</span>

<span class="sd">         app: pyqt application object initialized in microscopeAutomation.py</span>

<span class="sd">        Output:</span>
<span class="sd">         location_list: Returns the list of colonies selected by the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">location_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">location_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Using pyqtgraph module</span>
        <span class="n">interactive_plot</span> <span class="o">=</span> <span class="n">ImageLocationPicker</span><span class="p">(</span><span class="n">tile_image_data</span><span class="p">,</span> <span class="n">location_list</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Well Overview Image - Well &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">interactive_plot</span><span class="o">.</span><span class="n">plot_points</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_failed_image</span> <span class="o">=</span> <span class="n">interactive_plot</span><span class="o">.</span><span class="n">failed_image</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_failed_image</span><span class="p">():</span>
            <span class="c1"># A failed image has no locations</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">interactive_plot</span><span class="o">.</span><span class="n">location_list</span></div>

<div class="viewcode-block" id="Well.find_colonies"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.find_colonies">[docs]</a>    <span class="k">def</span> <span class="nf">find_colonies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find locations of colonies to be imaged in well and add them to well.</span>

<span class="sd">        Input:</span>
<span class="sd">         location_list: list of the colony locations relative to the center of the well</span>

<span class="sd">        Output:</span>
<span class="sd">         colony_list: List of Colony Objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">colony_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">colony_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">location_list</span><span class="p">:</span>
            <span class="n">colony_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_00&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">number</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">new_colony</span> <span class="o">=</span> <span class="n">Colony</span><span class="p">(</span>
                <span class="n">colony_name</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">well_object</span><span class="o">=</span><span class="bp">self</span>
            <span class="p">)</span>
            <span class="n">colony_dict</span><span class="p">[</span><span class="n">colony_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_colony</span>
            <span class="n">colony_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_colony</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_colonies</span><span class="p">(</span><span class="n">colony_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">colony_list</span></div>

<div class="viewcode-block" id="Well.get_well_object"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.get_well_object">[docs]</a>    <span class="k">def</span> <span class="nf">get_well_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get well object for subclass.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         well_object: object for well</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">well_object</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">well_object</span></div>

<div class="viewcode-block" id="Well.set_well_position_numeric"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.set_well_position_numeric">[docs]</a>    <span class="k">def</span> <span class="nf">set_well_position_numeric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set row and column number.</span>

<span class="sd">        Input:</span>
<span class="sd">         position: (column, row) as integer tuple (e.g. (0,0) for well A1</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">well_position_numeric</span> <span class="o">=</span> <span class="n">position</span></div>

<div class="viewcode-block" id="Well.get_well_position_numeric"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.get_well_position_numeric">[docs]</a>    <span class="k">def</span> <span class="nf">get_well_position_numeric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get row and column number.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         well_position_numeric: (column, row) as integer tuple (e.g. (0,0) for well A1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">well_position_numeric</span></div>

<div class="viewcode-block" id="Well.set_well_position_string"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.set_well_position_string">[docs]</a>    <span class="k">def</span> <span class="nf">set_well_position_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set row and column as strings.</span>

<span class="sd">        Input:</span>
<span class="sd">         position: (row, column) as string tuple (e.g. (&#39;A&#39;,&#39;1&#39;) for well A1)</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">well_position_string</span> <span class="o">=</span> <span class="n">position</span></div>

<div class="viewcode-block" id="Well.get_well_position_string"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.get_well_position_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_well_position_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get row and column as string.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         well_position_string: (row, column) as string tuple</span>
<span class="sd">         (e.g. (&#39;A&#39;,&#39;1&#39;) for well A1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">well_position_string</span></div>

<div class="viewcode-block" id="Well.set_assigned_diameter"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.set_assigned_diameter">[docs]</a>    <span class="k">def</span> <span class="nf">set_assigned_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assigned_diameter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set diameter from specifications or measured externally for well.</span>

<span class="sd">        Input:</span>
<span class="sd">         assigned_diameter: predefined diameter in mum</span>
<span class="sd">         (e.g from plate specifications or other instrument)</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assigned_diameter</span> <span class="o">=</span> <span class="n">assigned_diameter</span></div>

<div class="viewcode-block" id="Well.get_assigned_diameter"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.get_assigned_diameter">[docs]</a>    <span class="k">def</span> <span class="nf">get_assigned_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get well diameter for well as measured by external means.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output</span>
<span class="sd">         assigned_diameter: predefined diameter in mum</span>
<span class="sd">         (e.g from plate specifications or other instrument)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assigned_diameter</span></div>

<div class="viewcode-block" id="Well.set_measured_diameter"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.set_measured_diameter">[docs]</a>    <span class="k">def</span> <span class="nf">set_measured_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measured_diameter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set diameter measured during experiment for well.</span>

<span class="sd">        Input:</span>
<span class="sd">         measured_diameter: diameter in mum as measured in find_well_center_fine</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measured_diameter</span> <span class="o">=</span> <span class="n">measured_diameter</span>
        <span class="c1"># A measured diameter is always preferred over a diameter from specifications</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_diameter</span><span class="p">(</span><span class="n">measured_diameter</span><span class="p">)</span></div>

<div class="viewcode-block" id="Well.get_measured_diameter"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.get_measured_diameter">[docs]</a>    <span class="k">def</span> <span class="nf">get_measured_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get well diameter for well as measured in find_well_center_fine.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output</span>
<span class="sd">         measured_diameter: diameter in mum as measured in find_well_center_fine</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">measured_diameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measured_diameter</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">measured_diameter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">measured_diameter</span></div>

<div class="viewcode-block" id="Well.set_diameter"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.set_diameter">[docs]</a>    <span class="k">def</span> <span class="nf">set_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diameter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set diameter for well. If measured diameter is available it will used,</span>
<span class="sd">        otherwise the set_diameter from specifications is used.</span>

<span class="sd">        Input:</span>
<span class="sd">         diameter: diameter in mum</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span> <span class="o">=</span> <span class="n">diameter</span></div>

<div class="viewcode-block" id="Well.get_diameter"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.get_diameter">[docs]</a>    <span class="k">def</span> <span class="nf">get_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get well diameter for well. If measured diameter is available it will used,</span>
<span class="sd">        otherwise the set_diameter from specifications is used.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output</span>
<span class="sd">         diameter: diameter in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span></div>

<div class="viewcode-block" id="Well.calculate_well_correction"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.calculate_well_correction">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_well_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate correction factor for well coordinate system.</span>

<span class="sd">        We find position within the well (e.g. colonies) based on their distance</span>
<span class="sd">        from the center in mum. For some experiments we use coordinates measured</span>
<span class="sd">        on other systems. Their might be a slight difference in calibration for</span>
<span class="sd">        different systems. We will use the well diameter to calculate a compensation</span>
<span class="sd">        factor for these differences.</span>

<span class="sd">        Input:</span>
<span class="sd">         update: if True update correction factor and do not replace to keep</span>
<span class="sd">         earlier corrections in place</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">measured_diameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measured_diameter</span><span class="p">()</span>
        <span class="n">assigned_diameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_assigned_diameter</span><span class="p">()</span>

        <span class="c1"># if any of the diameters in not defined (None)</span>
        <span class="c1"># set correction factor to 1 and print warning</span>
        <span class="k">if</span> <span class="n">measured_diameter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">assigned_diameter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">correction</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">correction</span> <span class="o">=</span> <span class="n">measured_diameter</span> <span class="o">/</span> <span class="n">assigned_diameter</span>

        <span class="c1"># if update==True update correction factor</span>
        <span class="c1"># and do not replace to keep earlier corrections in place</span>
        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_correction</span><span class="p">(</span><span class="n">correction</span><span class="p">,</span> <span class="n">correction</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_correction</span><span class="p">(</span><span class="n">correction</span><span class="p">,</span> <span class="n">correction</span><span class="p">)</span></div>

<div class="viewcode-block" id="Well.add_colonies"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.add_colonies">[docs]</a>    <span class="k">def</span> <span class="nf">add_colonies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colony_objects_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds colonies to well.</span>
<span class="sd">        Raises TypeError if non-colony object is added.</span>

<span class="sd">        Input:</span>
<span class="sd">         colony_objects_dict: dictionary of form {&#39;name&#39;: colony_object}</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Colony</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">colony_objects_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;All objects must be of type Colony&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">colony_objects_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Well.add_samples"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.add_samples">[docs]</a>    <span class="k">def</span> <span class="nf">add_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_objects_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds samples to well.</span>

<span class="sd">        Input:</span>
<span class="sd">         sample_objects_dict: dictionary of form {&#39;name&#39;: sample_object}</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sample_objects_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Well.get_samples"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.get_samples">[docs]</a>    <span class="k">def</span> <span class="nf">get_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_type</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Sample&quot;</span><span class="p">,</span> <span class="s2">&quot;Barcode&quot;</span><span class="p">,</span> <span class="s2">&quot;Colony&quot;</span><span class="p">}):</span>
        <span class="sd">&quot;&quot;&quot;Get all samples in well.</span>

<span class="sd">        Input:</span>
<span class="sd">         sample_type: list with types of samples to retrieve.</span>
<span class="sd">         At this moment {&#39;Sample&#39;, &#39;Barcode&#39;, &#39;Colony&#39;} are supported</span>

<span class="sd">        Output:</span>
<span class="sd">         samples: dict with sample objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">sample_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sample_obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">sample_type</span><span class="p">:</span>
                    <span class="n">samples</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">name</span><span class="p">:</span> <span class="n">sample_obj</span><span class="p">})</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">samples</span></div>

<div class="viewcode-block" id="Well.get_colonies"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.get_colonies">[docs]</a>    <span class="k">def</span> <span class="nf">get_colonies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all colonies in well.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         colonies: dict with colony objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">colonies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="n">sample_type</span><span class="o">=</span><span class="s2">&quot;Colony&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">colonies</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">colonies</span></div>

<div class="viewcode-block" id="Well.add_barcode"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.add_barcode">[docs]</a>    <span class="k">def</span> <span class="nf">add_barcode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">barcode_objects_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds barcode to well.</span>
<span class="sd">        Raises TypeError if non-barcode object is added.</span>

<span class="sd">        Input:</span>
<span class="sd">         barcode_objects_dict: dictionary of form {&#39;name&#39;: barcodeObject}</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Barcode</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">barcode_objects_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;All objects must be of type Barcode&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">barcode_objects_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Well.find_well_center_fine"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.find_well_center_fine">[docs]</a>    <span class="k">def</span> <span class="nf">find_well_center_fine</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">well_diameter</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find center of well with higher precision.</span>

<span class="sd">        Method takes four images of well edges and calculates center.</span>
<span class="sd">        Will set origin of well coordinate system to this value.</span>

<span class="sd">        Input:</span>
<span class="sd">         experiment: string with imaging conditions defined within microscope software</span>

<span class="sd">         well_diameter: diameter of reference well in mum</span>

<span class="sd">         camera_id: string with name of camera</span>

<span class="sd">         settings: object of class Preferences which holds image settings</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">         test: if True will call find_well_center.find_well_center_fine</span>
<span class="sd">         in test mode. (Default = False)</span>

<span class="sd">        Output:</span>
<span class="sd">         x_center, y_center, z_center: Center of well in absolute stage coordinates</span>
<span class="sd">         in mum. z after drift correction (as if no drift had occured)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># user positioned right well edge in center of 10x FOW</span>
        <span class="c1"># acquire image and find edge coordinates</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">get_well_edge_path</span><span class="p">(</span><span class="n">settings</span><span class="p">))</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_well_edge_path</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.czi&quot;</span><span class="p">)</span>
        <span class="n">meta_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;aics_well&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
            <span class="s2">&quot;aics_barcode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_barcode</span><span class="p">(),</span>
            <span class="s2">&quot;aics_xTile&quot;</span><span class="p">:</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;aics_yTile&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_experiment</span><span class="p">(</span>
            <span class="n">experiment</span><span class="p">,</span>
            <span class="n">camera_id</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">add_suffix</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;-1_0&quot;</span><span class="p">),</span>
            <span class="n">meta_dict</span><span class="o">=</span><span class="n">meta_dict</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">get_meta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">pixel_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;PhysicalSizeX&quot;</span><span class="p">)</span>
        <span class="n">edge_pos_pixels</span> <span class="o">=</span> <span class="n">find_well_center</span><span class="o">.</span><span class="n">find_well_center_fine</span><span class="p">(</span>
            <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;-x&quot;</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">test</span>
        <span class="p">)</span>

        <span class="n">x_pos_0</span> <span class="o">=</span> <span class="n">edge_pos_pixels</span> <span class="o">*</span> <span class="n">pixel_size</span>
        <span class="n">x_edge_0</span> <span class="o">=</span> <span class="n">x_pos_0</span> <span class="o">+</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imageAbsPosX&quot;</span><span class="p">)</span>

        <span class="c1"># move to right edge, take image, and find edge coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_delta_xyz</span><span class="p">(</span><span class="n">well_diameter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">meta_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;aics_well&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
            <span class="s2">&quot;aics_barcode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_barcode</span><span class="p">(),</span>
            <span class="s2">&quot;aics_xTile&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;aics_yTile&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_experiment</span><span class="p">(</span>
            <span class="n">experiment</span><span class="p">,</span>
            <span class="n">camera_id</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">add_suffix</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;1_0&quot;</span><span class="p">),</span>
            <span class="n">meta_dict</span><span class="o">=</span><span class="n">meta_dict</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">get_meta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">edge_pos_pixels</span> <span class="o">=</span> <span class="n">find_well_center</span><span class="o">.</span><span class="n">find_well_center_fine</span><span class="p">(</span>
            <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">test</span>
        <span class="p">)</span>

        <span class="n">x_pos_1</span> <span class="o">=</span> <span class="n">edge_pos_pixels</span> <span class="o">*</span> <span class="n">pixel_size</span>
        <span class="n">x_edge_1</span> <span class="o">=</span> <span class="n">x_pos_1</span> <span class="o">+</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imageAbsPosX&quot;</span><span class="p">)</span>

        <span class="n">x_radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_edge_1</span> <span class="o">-</span> <span class="n">x_edge_0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">x_center</span> <span class="o">=</span> <span class="n">x_edge_0</span> <span class="o">+</span> <span class="n">x_radius</span>

        <span class="c1"># move to top edge, take image, and find edge coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_delta_xyz</span><span class="p">(</span>
            <span class="o">-</span><span class="n">well_diameter</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="n">well_diameter</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>
        <span class="n">meta_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;aics_well&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
            <span class="s2">&quot;aics_barcode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_barcode</span><span class="p">(),</span>
            <span class="s2">&quot;aics_xTile&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;aics_yTile&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_experiment</span><span class="p">(</span>
            <span class="n">experiment</span><span class="p">,</span>
            <span class="n">camera_id</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">add_suffix</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;0_1&quot;</span><span class="p">),</span>
            <span class="n">meta_dict</span><span class="o">=</span><span class="n">meta_dict</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">get_meta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">edge_pos_pixels</span> <span class="o">=</span> <span class="n">find_well_center</span><span class="o">.</span><span class="n">find_well_center_fine</span><span class="p">(</span>
            <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;-y&quot;</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">test</span>
        <span class="p">)</span>
        <span class="n">y_pos_0</span> <span class="o">=</span> <span class="n">edge_pos_pixels</span> <span class="o">*</span> <span class="n">pixel_size</span>
        <span class="n">y_edge_0</span> <span class="o">=</span> <span class="n">y_pos_0</span> <span class="o">+</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imageAbsPosY&quot;</span><span class="p">)</span>

        <span class="c1"># move to bottom edge, take image, and find edge coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_delta_xyz</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">well_diameter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">meta_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;aics_well&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
            <span class="s2">&quot;aics_barcode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_barcode</span><span class="p">(),</span>
            <span class="s2">&quot;aics_xTile&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;aics_yTile&quot;</span><span class="p">:</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_experiment</span><span class="p">(</span>
            <span class="n">experiment</span><span class="p">,</span>
            <span class="n">camera_id</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">add_suffix</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;0_-1&quot;</span><span class="p">),</span>
            <span class="n">meta_dict</span><span class="o">=</span><span class="n">meta_dict</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">get_meta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">edge_pos_pixels</span> <span class="o">=</span> <span class="n">find_well_center</span><span class="o">.</span><span class="n">find_well_center_fine</span><span class="p">(</span>
            <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">test</span>
        <span class="p">)</span>

        <span class="n">y_pos_1</span> <span class="o">=</span> <span class="n">edge_pos_pixels</span> <span class="o">*</span> <span class="n">pixel_size</span>
        <span class="n">y_edge_1</span> <span class="o">=</span> <span class="n">y_pos_1</span> <span class="o">+</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imageAbsPosY&quot;</span><span class="p">)</span>

        <span class="n">y_radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_edge_1</span> <span class="o">-</span> <span class="n">y_edge_0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">y_center</span> <span class="o">=</span> <span class="n">y_edge_0</span> <span class="o">+</span> <span class="n">y_radius</span>

        <span class="n">z_center</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imageAbsPosZ(driftCorrected)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measured_diameter</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">x_radius</span><span class="p">,</span> <span class="n">y_radius</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Radius in x (length, x position): &quot;</span><span class="p">,</span> <span class="n">x_radius</span><span class="p">,</span> <span class="n">x_center</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Radius in y (length, y position): &quot;</span><span class="p">,</span> <span class="n">y_radius</span><span class="p">,</span> <span class="n">y_center</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Focus position: &quot;</span><span class="p">,</span> <span class="n">z_center</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x_center</span><span class="p">,</span> <span class="n">y_center</span><span class="p">,</span> <span class="n">z_center</span></div>

<div class="viewcode-block" id="Well.get_tile_positions_list"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Well.get_tile_positions_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_tile_positions_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefs</span><span class="p">,</span> <span class="n">tile_type</span><span class="o">=</span><span class="s2">&quot;Well&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get positions for tiles in absolute coordinates.</span>
<span class="sd">        Other classes have additional tile_objects (e.g. ColonySize).</span>

<span class="sd">        Input:</span>
<span class="sd">         prefs: Preferences object with preferences for tiling</span>

<span class="sd">         tile_type: type of tiling.  Possible options:</span>
<span class="sd">          &#39;None&#39;: do not tile</span>

<span class="sd">          &#39;Fixed&#39;: use fixed number of tiles</span>

<span class="sd">          &#39;Well&#39;: use enough tiles to cover one well</span>

<span class="sd">         verbose: print debugging information</span>

<span class="sd">        Output:</span>
<span class="sd">         tile_position_list: list with absolute positions for tiling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># retrieve common tiling parameters, than adjust them for wells if necessary</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tile_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tile_params</span><span class="p">(</span><span class="n">prefs</span><span class="p">,</span> <span class="n">tile_type</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">tile_positions_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_tile_positions_list</span><span class="p">(</span><span class="n">tile_params</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">tile_positions_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">tile_positions_list</span></div></div>


<span class="c1">################################################################</span>


<div class="viewcode-block" id="Sample"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Sample">[docs]</a><span class="k">class</span> <span class="nc">Sample</span><span class="p">(</span><span class="n">ImagingSystem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and manipulate samples within a Well.</span>
<span class="sd">    Input:</span>

<span class="sd">    Output:</span>
<span class="sd">     None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Sample&quot;</span><span class="p">,</span>
        <span class="n">well_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize class Sample</span>

<span class="sd">        Input:</span>
<span class="sd">         well: object of class Well that contains Sample</span>

<span class="sd">         center: center of sample relative to well center used for imaging</span>
<span class="sd">         in mum in form [x, y, z]</span>

<span class="sd">         experiment: string with name of experiment as defined in microscope software.</span>
<span class="sd">         Used to ImageAICS experiment</span>

<span class="sd">         sample: string with name of sample (optional)</span>

<span class="sd">         x_flip, y_flip, z_flip: -1 if coordinate system of plate holder</span>
<span class="sd">         is flipped in respect to stage</span>

<span class="sd">         x_correction, y_correction, z_correction: correction factor if</span>
<span class="sd">         there is a discrepancy between the stage and the plate holder calibration</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Sample</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">well_object</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">x_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">z_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">x_flip</span><span class="o">=</span><span class="n">x_flip</span><span class="p">,</span>
            <span class="n">y_flip</span><span class="o">=</span><span class="n">y_flip</span><span class="p">,</span>
            <span class="n">z_flip</span><span class="o">=</span><span class="n">z_flip</span><span class="p">,</span>
            <span class="n">x_correction</span><span class="o">=</span><span class="n">x_correction</span><span class="p">,</span>
            <span class="n">y_correction</span><span class="o">=</span><span class="n">y_correction</span><span class="p">,</span>
            <span class="n">z_correction</span><span class="o">=</span><span class="n">z_correction</span><span class="p">,</span>
            <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="n">z_correction_y_slope</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">well_object</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microscope</span> <span class="o">=</span> <span class="n">well_object</span><span class="o">.</span><span class="n">microscope</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">well</span> <span class="o">=</span> <span class="n">well_object</span><span class="o">.</span><span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plate_layout</span> <span class="o">=</span> <span class="n">well_object</span><span class="o">.</span><span class="n">plate_layout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stage_id</span> <span class="o">=</span> <span class="n">well_object</span><span class="o">.</span><span class="n">stage_id</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span> <span class="o">=</span> <span class="n">experiment</span></div>


<div class="viewcode-block" id="Barcode"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Barcode">[docs]</a><span class="k">class</span> <span class="nc">Barcode</span><span class="p">(</span><span class="n">ImagingSystem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to image and read barcode.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Barcode&quot;</span><span class="p">,</span>
        <span class="n">well_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize class Well</span>

<span class="sd">        Input:</span>
<span class="sd">         name: string with name for barcode. Name has to be unique</span>
<span class="sd">         if multiple barcodes are attached to single well.</span>

<span class="sd">         well_object: object of class well of well the barcode is attached to</span>

<span class="sd">         x_flip, y_flip, z_flip: -1 if coordinate system of plate holder</span>
<span class="sd">         is flipped in respect to stage</span>

<span class="sd">         x_correction, y_correction, z_correction: correction factor if</span>
<span class="sd">         there is a discrepancy between the stage and the plate holder calibration</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Barcode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">well_object</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">x_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">z_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">x_flip</span><span class="o">=</span><span class="n">x_flip</span><span class="p">,</span>
            <span class="n">y_flip</span><span class="o">=</span><span class="n">y_flip</span><span class="p">,</span>
            <span class="n">z_flip</span><span class="o">=</span><span class="n">z_flip</span><span class="p">,</span>
            <span class="n">x_correction</span><span class="o">=</span><span class="n">x_correction</span><span class="p">,</span>
            <span class="n">y_correction</span><span class="o">=</span><span class="n">y_correction</span><span class="p">,</span>
            <span class="n">z_correction</span><span class="o">=</span><span class="n">z_correction</span><span class="p">,</span>
            <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="n">z_correction_y_slope</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># self.container = well_object</span>

<div class="viewcode-block" id="Barcode.read_barcode_data_acquisition"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Barcode.read_barcode_data_acquisition">[docs]</a>    <span class="k">def</span> <span class="nf">read_barcode_data_acquisition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Take image of barcode.</span>

<span class="sd">        Input:</span>
<span class="sd">         experiment: string with name for experiment used in microscope software</span>

<span class="sd">         camera_id: unique ID for camera used to acquire image</span>

<span class="sd">         file_path: filename with path to store images.</span>
<span class="sd">         If None, image is not saved</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         image: Image of barcode. Images will be used to decode barcode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_experiment</span><span class="p">(</span>
            <span class="n">experiment</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="Barcode.read_barcode"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Barcode.read_barcode">[docs]</a>    <span class="k">def</span> <span class="nf">read_barcode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Take image of barcode and return code.</span>

<span class="sd">        Input:</span>
<span class="sd">         experiment: string with imaging conditions as defined within microscope sofware</span>

<span class="sd">         camera_id: string with name of camera</span>

<span class="sd">         file_path: filename with path to store images.</span>
<span class="sd">         If None, image is not saved</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         code: string encoded in barcode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_barcode_data_acquisition</span><span class="p">(</span>
            <span class="n">experiment</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">get_meta</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># code = read_barcode(image)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;Not implemented&quot;</span>
        <span class="k">return</span> <span class="n">code</span></div></div>


<div class="viewcode-block" id="Colony"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony">[docs]</a><span class="k">class</span> <span class="nc">Colony</span><span class="p">(</span><span class="n">ImagingSystem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and manipulate colonies within a Well.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Colony&quot;</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">well_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">image</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ellipse</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize class Colony.</span>

<span class="sd">        Input:</span>
<span class="sd">         name: id for colony</span>

<span class="sd">         image: True, if colony should be imaged</span>

<span class="sd">         center: (x, y, z) center of colony relative to well center in mum</span>

<span class="sd">         ellipse: (long axis, short axis, orientation) for ellipse around colony</span>

<span class="sd">         meta: additional meta data for colony</span>

<span class="sd">         well_object: object of type Well the colony is associated with</span>

<span class="sd">         x_flip, y_flip, z_flip: -1 if coordinate system of plate holder .</span>
<span class="sd">         is flipped in respect to stage</span>

<span class="sd">         x_correction, y_correction, z_correction: correction factor if</span>
<span class="sd">         there is a discrepancy between the stage and the plate holder calibration</span>

<span class="sd">        Output:</span>
<span class="sd">         None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Colony</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">well_object</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">image</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">x_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">z_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">x_flip</span><span class="o">=</span><span class="n">x_flip</span><span class="p">,</span>
            <span class="n">y_flip</span><span class="o">=</span><span class="n">y_flip</span><span class="p">,</span>
            <span class="n">z_flip</span><span class="o">=</span><span class="n">z_flip</span><span class="p">,</span>
            <span class="n">x_correction</span><span class="o">=</span><span class="n">x_correction</span><span class="p">,</span>
            <span class="n">y_correction</span><span class="o">=</span><span class="n">y_correction</span><span class="p">,</span>
            <span class="n">z_correction</span><span class="o">=</span><span class="n">z_correction</span><span class="p">,</span>
            <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="n">z_correction_y_slope</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1">#         self.container=well_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1">#         self.name=name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ellipse</span> <span class="o">=</span> <span class="n">ellipse</span>
        <span class="c1">#         self.xCenter, self.yCenter=center</span>
        <span class="k">if</span> <span class="n">meta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">Area</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span>

<div class="viewcode-block" id="Colony.set_cell_line"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.set_cell_line">[docs]</a>    <span class="k">def</span> <span class="nf">set_cell_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set name of cell line.</span>

<span class="sd">        Input:</span>
<span class="sd">         cell_line: string with name of cell line</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_line</span> <span class="o">=</span> <span class="n">cell_line</span></div>

<div class="viewcode-block" id="Colony.set_interactive_positions"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.set_interactive_positions">[docs]</a>    <span class="k">def</span> <span class="nf">set_interactive_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_data</span><span class="p">,</span> <span class="n">location_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">app</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Opens up the interactive mode and lets user select cells and</span>
<span class="sd">        return the list of coordinates selected</span>

<span class="sd">        Input:</span>
<span class="sd">         image_data: The pixel data of the image of the colony - numpy array</span>

<span class="sd">         location_list: Coordinates to be preplotted on the image</span>

<span class="sd">         app: pyqt application object</span>

<span class="sd">        Output:</span>
<span class="sd">         location_list: Returns the list of cells selected by the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using pyqtgraph module</span>
        <span class="k">if</span> <span class="n">location_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">location_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">interactive_plot</span> <span class="o">=</span> <span class="n">ImageLocationPicker</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">location_list</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
        <span class="n">interactive_plot</span><span class="o">.</span><span class="n">plot_points</span><span class="p">(</span><span class="s2">&quot;Colony Overview Image&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">interactive_plot</span><span class="o">.</span><span class="n">location_list</span></div>

<div class="viewcode-block" id="Colony.get_cell_line"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.get_cell_line">[docs]</a>    <span class="k">def</span> <span class="nf">get_cell_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get name of cell line.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         cell_line: string with name of cell line</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cell_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_line</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">cell_line</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">cell_line</span></div>

<div class="viewcode-block" id="Colony.set_clone"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.set_clone">[docs]</a>    <span class="k">def</span> <span class="nf">set_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set name of clone.</span>

<span class="sd">        Input:</span>
<span class="sd">         clone: string with name of clone</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone</span> <span class="o">=</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="Colony.get_clone"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.get_clone">[docs]</a>    <span class="k">def</span> <span class="nf">get_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get name of clone.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         clone: string with name of clone</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">clone</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="Colony.update_zero"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.update_zero">[docs]</a>    <span class="k">def</span> <span class="nf">update_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update zero position of colony in well coordinates.</span>

<span class="sd">        Input:</span>
<span class="sd">         images: list with image objects of class ImageAICS</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         x, y, z: new zero position</span>
<span class="sd">         z after drift correction (as if no drift had happended)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># calculate median of all x, y, z-Positions</span>
        <span class="n">x_stage_positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_stage_positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">z_stage_positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
            <span class="n">x_stage_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imageAbsPosX&quot;</span><span class="p">))</span>
            <span class="n">y_stage_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imageAbsPosY&quot;</span><span class="p">))</span>
            <span class="n">z_stage_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">image</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;aics_imageAbsPosZ(driftCorrected)&quot;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">x_stage_positions</span><span class="p">)</span>
        <span class="n">x_stage_median</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_stage_positions</span><span class="p">))</span>
        <span class="n">y_stage_median</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_stage_positions</span><span class="p">))</span>
        <span class="n">z_stage_median</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_stage_positions</span><span class="p">))</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">get_pos_from_abs_pos</span><span class="p">(</span>
            <span class="n">x_stage_median</span><span class="p">,</span> <span class="n">y_stage_median</span><span class="p">,</span> <span class="n">z_stage_median</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_zero</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span></div>

<div class="viewcode-block" id="Colony.add_cells"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.add_cells">[docs]</a>    <span class="k">def</span> <span class="nf">add_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_objects_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds cells to colony.</span>

<span class="sd">        This method will update cell line and clone information foe cells based</span>
<span class="sd">        on clone information (if available)</span>

<span class="sd">        Input:</span>
<span class="sd">         cell_objects_dict: dictionary of form {&#39;name&#39;: cellObject}</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cell_objects_dict</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_objects_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">set_cell_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell_line</span><span class="p">())</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">set_clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_clone</span><span class="p">())</span></div>

<div class="viewcode-block" id="Colony.get_cells"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.get_cells">[docs]</a>    <span class="k">def</span> <span class="nf">get_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all cells in colony.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         cells: dictionary of form {&#39;name&#39;: cellObject}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span></div>

<div class="viewcode-block" id="Colony.number_cells"><a class="viewcode-back" href="../../../microscope_automation.samples.html#microscope_automation.samples.samples.Colony.number_cells">[docs]</a>    <span class="k">def</span> <span class="nf">number_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span></div>

<div class="viewcode-block" id="Colony.find_cells_cell_profiler"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.find_cells_cell_profiler">[docs]</a>    <span class="k">def</span> <span class="nf">find_cells_cell_profiler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO Add comments plus clean up</span>
        <span class="sd">&quot;&quot;&quot;Find locations of cells to be imaged in colony and add them to colony.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_0001&quot;</span>
        <span class="n">new_cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">colony_object</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cell_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">cell_name</span><span class="p">:</span> <span class="n">new_cell</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_cells</span><span class="p">(</span><span class="n">cell_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Colony.find_cells_distance_map"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.find_cells_distance_map">[docs]</a>    <span class="k">def</span> <span class="nf">find_cells_distance_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefs</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="c1"># TODO Add comments + clean up</span>
        <span class="sd">&quot;&quot;&quot;Find locations of cells to be imaged in colony and add them to colony.</span>

<span class="sd">        Input:</span>
<span class="sd">         prefs: preferences read with module preferences with criteria for cells</span>

<span class="sd">         image: ImageAICS object with colony</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">find_cells</span>

        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO: Works only with Zeiss, not with 3i</span>
            <span class="n">li</span> <span class="o">=</span> <span class="n">LoadImageCzi</span><span class="p">()</span>
            <span class="n">li</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefs</span><span class="o">.</span><span class="n">get_pref</span><span class="p">(</span><span class="s2">&quot;Tile&quot;</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="n">VALID_TILE</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;Fixed&quot;</span><span class="p">:</span>
            <span class="n">image</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">prefs</span><span class="o">.</span><span class="n">get_pref_as_meta</span><span class="p">(</span><span class="s2">&quot;CellFinder&quot;</span><span class="p">))</span>
        <span class="n">cell_finder</span> <span class="o">=</span> <span class="n">find_cells</span><span class="o">.</span><span class="n">CellFinder</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">prefs</span><span class="o">.</span><span class="n">get_pref_as_meta</span><span class="p">(</span><span class="s2">&quot;CellFinder&quot;</span><span class="p">),</span> <span class="bp">self</span>
        <span class="p">)</span>
        <span class="n">cell_dict</span> <span class="o">=</span> <span class="n">cell_finder</span><span class="o">.</span><span class="n">find_cells</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_cells</span><span class="p">(</span><span class="n">cell_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Colony.find_cell_interactive_distance_map"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.find_cell_interactive_distance_map">[docs]</a>    <span class="k">def</span> <span class="nf">find_cell_interactive_distance_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find locations of cells to be imaged in colony and add them to colony.</span>

<span class="sd">        Input:</span>
<span class="sd">         location: center of the cell in the form (x, y)</span>

<span class="sd">        Output:</span>
<span class="sd">         cell_to_add: object of class Cell</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cell_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_</span><span class="si">{:04}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cell_to_add</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">colony_object</span><span class="o">=</span><span class="bp">self</span>
        <span class="p">)</span>
        <span class="n">cell_dict</span><span class="p">[</span><span class="n">cell_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_to_add</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_cells</span><span class="p">(</span><span class="n">cell_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cell_to_add</span></div>

<div class="viewcode-block" id="Colony.execute_experiment"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Colony.execute_experiment">[docs]</a>    <span class="k">def</span> <span class="nf">execute_experiment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">experiment</span><span class="p">,</span>
        <span class="n">camera_id</span><span class="p">,</span>
        <span class="n">reference_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meta_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Acquire single image using settings defined in microscope software</span>
<span class="sd">        and optionally save.</span>

<span class="sd">        Methods calls method of container instance until container has method</span>
<span class="sd">        implemented that actually performs action.</span>

<span class="sd">        Input:</span>
<span class="sd">         experiment: string with experiment name as defined within microscope software</span>

<span class="sd">         camera_id: string with unique camera ID</span>

<span class="sd">         reference_object: object of type sample (ImagingSystem) used to correct for</span>
<span class="sd">         xyz offset between different objectives</span>

<span class="sd">         file_path: filename with path to save image in original format.</span>
<span class="sd">         Default=None: no saving</span>

<span class="sd">         meta_dict: directory with additional meta data, e.g. {&#39;aics_well&#39;:, &#39;A1&#39;}</span>

<span class="sd">         focus: use autofocus (default = False)</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         image: ImageAICS object. At this moment they do not include the pixel data.</span>
<span class="sd">         Get pixel data with load_image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_clone</span><span class="p">()</span>
        <span class="n">cell_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_line</span><span class="p">()</span>
        <span class="n">meta_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;aics_colonyClone&quot;</span><span class="p">:</span> <span class="n">clone</span><span class="p">,</span> <span class="s2">&quot;aics_colonyCellLine&quot;</span><span class="p">:</span> <span class="n">cell_line</span><span class="p">})</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">execute_experiment</span><span class="p">(</span>
            <span class="n">experiment</span><span class="p">,</span>
            <span class="n">camera_id</span><span class="p">,</span>
            <span class="n">reference_object</span><span class="o">=</span><span class="n">reference_object</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
            <span class="n">meta_dict</span><span class="o">=</span><span class="n">meta_dict</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span></div></div>


<span class="n">position_number</span> <span class="o">=</span> <span class="mi">1</span>


<div class="viewcode-block" id="Cell"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Cell">[docs]</a><span class="k">class</span> <span class="nc">Cell</span><span class="p">(</span><span class="n">ImagingSystem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and manipulate cells within a colony.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Cell&quot;</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">colony_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize class Cell.</span>

<span class="sd">        Input:</span>
<span class="sd">         name: id for cell</span>

<span class="sd">         center: (x, y, z) center of cell relative to colony center in mum</span>

<span class="sd">         colony_object: object of type Colony the cell is associated with</span>

<span class="sd">         x_flip, y_flip, z_flip: -1 if coordinate system of plate holder</span>
<span class="sd">         is flipped in respect to stage</span>

<span class="sd">         x_correction, y_correction, z_correction: correction factor if</span>
<span class="sd">         there is a discrepancy between the stage and the plate holder calibration</span>

<span class="sd">        Output:</span>
<span class="sd">         None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Cell</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">colony_object</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">x_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">z_zero</span><span class="o">=</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">x_flip</span><span class="o">=</span><span class="n">x_flip</span><span class="p">,</span>
            <span class="n">y_flip</span><span class="o">=</span><span class="n">y_flip</span><span class="p">,</span>
            <span class="n">z_flip</span><span class="o">=</span><span class="n">z_flip</span><span class="p">,</span>
            <span class="n">x_correction</span><span class="o">=</span><span class="n">x_correction</span><span class="p">,</span>
            <span class="n">y_correction</span><span class="o">=</span><span class="n">y_correction</span><span class="p">,</span>
            <span class="n">z_correction</span><span class="o">=</span><span class="n">z_correction</span><span class="p">,</span>
            <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="n">z_correction_x_slope</span><span class="p">,</span>
            <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="n">z_correction_y_slope</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">global</span> <span class="n">position_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position_number</span> <span class="o">=</span> <span class="n">position_number</span>
        <span class="n">position_number</span> <span class="o">=</span> <span class="n">position_number</span> <span class="o">+</span> <span class="mi">1</span>

<div class="viewcode-block" id="Cell.set_cell_line"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Cell.set_cell_line">[docs]</a>    <span class="k">def</span> <span class="nf">set_cell_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set name of cell line.</span>

<span class="sd">        Input:</span>
<span class="sd">         cell_line: string with name of cell line</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_line</span> <span class="o">=</span> <span class="n">cell_line</span></div>

<div class="viewcode-block" id="Cell.get_cell_line"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Cell.get_cell_line">[docs]</a>    <span class="k">def</span> <span class="nf">get_cell_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get name of cell line.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         cell_line: string with name of cell line</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cell_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_line</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">cell_line</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">cell_line</span></div>

<div class="viewcode-block" id="Cell.set_clone"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Cell.set_clone">[docs]</a>    <span class="k">def</span> <span class="nf">set_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set name of clone.</span>

<span class="sd">        Input:</span>
<span class="sd">         clone: string with name of clone</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone</span> <span class="o">=</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="Cell.get_clone"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Cell.get_clone">[docs]</a>    <span class="k">def</span> <span class="nf">get_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get name of clone.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         clone: string with name of clone</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">clone</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="Cell.set_interactive_positions"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Cell.set_interactive_positions">[docs]</a>    <span class="k">def</span> <span class="nf">set_interactive_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_data</span><span class="p">,</span> <span class="n">location_list</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Opens up the interactive mode and lets user select objects and</span>
<span class="sd">        return the list of coordinates selected</span>

<span class="sd">        Input:</span>
<span class="sd">        image_data: The pixel data of the image of the cell - numpy array</span>

<span class="sd">        Output:</span>
<span class="sd">        location_list: Returns the list of objects selected by the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Using pyqtgraph module</span>
        <span class="n">interactive_plot</span> <span class="o">=</span> <span class="n">ImageLocationPicker</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">location_list</span><span class="p">)</span>
        <span class="n">interactive_plot</span><span class="o">.</span><span class="n">plot_points</span><span class="p">(</span><span class="s2">&quot;Cell Overview Image&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">interactive_plot</span><span class="o">.</span><span class="n">location_list</span></div>

<div class="viewcode-block" id="Cell.execute_experiment"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.Cell.execute_experiment">[docs]</a>    <span class="k">def</span> <span class="nf">execute_experiment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">experiment</span><span class="p">,</span>
        <span class="n">camera_id</span><span class="p">,</span>
        <span class="n">reference_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meta_dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Acquire single image using settings defined in microscope software</span>
<span class="sd">        and optionally save.</span>

<span class="sd">        Methods calls method of container instance until container has</span>
<span class="sd">        method implemented that actually performs action.</span>

<span class="sd">        Input:</span>
<span class="sd">         experiment: string with experiment name as defined within microscope software</span>

<span class="sd">         camera_id: string with unique camera ID</span>

<span class="sd">         reference_object: object of type sample (ImagingSystem) used to correct for</span>
<span class="sd">         xyz offset between different objectives</span>

<span class="sd">         file_path: filename with path to save image in original format.</span>
<span class="sd">         Default=None: no saving</span>

<span class="sd">         meta_dict: directory with additional meta data, e.g. {&#39;aics_well&#39;:, &#39;A1&#39;}</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         image: ImageAICS object. At this moment they do not include the pixel data.</span>
<span class="sd">         Get pixel data with load_image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">meta_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">meta_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">meta_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;aics_cellClone&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_clone</span><span class="p">(),</span>
                <span class="s2">&quot;aics_cellCellLine&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_line</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">execute_experiment</span><span class="p">(</span>
            <span class="n">experiment</span><span class="p">,</span>
            <span class="n">camera_id</span><span class="p">,</span>
            <span class="n">reference_object</span><span class="o">=</span><span class="n">reference_object</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
            <span class="n">meta_dict</span><span class="o">=</span><span class="n">meta_dict</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span></div></div>


<span class="c1">#################################################################</span>
<span class="c1">#</span>
<span class="c1"># Functions for testing of module</span>
<span class="c1">#</span>
<span class="c1">#################################################################</span>


<div class="viewcode-block" id="create_plate_holder_manually"><a class="viewcode-back" href="../../../samples.html#microscope_automation.samples.samples.create_plate_holder_manually">[docs]</a><span class="k">def</span> <span class="nf">create_plate_holder_manually</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">prefs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create plate holder manually instead of using setup_samples.&quot;&quot;&quot;</span>
    <span class="c1"># create plate holder and fill with plate, wells, colonies, cells, &amp; water delivery</span>
    <span class="c1"># create plate holder and connect it to microscope</span>
    <span class="n">ph</span> <span class="o">=</span> <span class="n">PlateHolder</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;PlateHolder&quot;</span><span class="p">,</span>
        <span class="n">microscope_object</span><span class="o">=</span><span class="n">m</span><span class="p">,</span>
        <span class="n">stage_id</span><span class="o">=</span><span class="s2">&quot;TestStage&quot;</span><span class="p">,</span>
        <span class="n">focus_id</span><span class="o">=</span><span class="s2">&quot;Focus&quot;</span><span class="p">,</span>
        <span class="n">objective_changer_id</span><span class="o">=</span><span class="s2">&quot;Nosepiece&quot;</span><span class="p">,</span>
        <span class="n">safety_id</span><span class="o">=</span><span class="s2">&quot;SafeArea_plateHolder&quot;</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PlateHolder created&quot;</span><span class="p">)</span>

    <span class="c1"># create immersion delivery system as part of PlateHolder and add to PlateHolder</span>
    <span class="n">pump_object</span> <span class="o">=</span> <span class="n">hardware_components</span><span class="o">.</span><span class="n">Pump</span><span class="p">(</span><span class="s2">&quot;Immersion&quot;</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_microscope_object</span><span class="p">(</span><span class="n">pump_object</span><span class="p">)</span>

    <span class="c1"># Add pump to plateHolder</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ImmersionDelivery</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Immersion&quot;</span><span class="p">,</span> <span class="n">plate_holder_object</span><span class="o">=</span><span class="n">ph</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="c1"># ph.add_immersionDelivery(immersion_delivery_systemsDict={&#39;Water Immersion&#39;: im})</span>
    <span class="n">ph</span><span class="o">.</span><span class="n">immersion_delivery_system</span> <span class="o">=</span> <span class="n">im</span>

    <span class="c1"># create Plate as part of PlateHolder and add it to PlateHolder</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Plate</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Plate&quot;</span><span class="p">,</span>
        <span class="n">plate_holder_object</span><span class="o">=</span><span class="n">ph</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">6891</span><span class="p">,</span> <span class="mi">3447</span><span class="p">,</span> <span class="mi">9500</span><span class="p">],</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">set_barcode</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
    <span class="n">ph</span><span class="o">.</span><span class="n">add_plates</span><span class="p">(</span><span class="n">plate_object_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Test Plate&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">})</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plate created and added to PlateHolder&quot;</span><span class="p">)</span>

    <span class="c1"># create Wells as part of Plate and add to Plate</span>
    <span class="n">plate_layout</span> <span class="o">=</span> <span class="n">create_plate</span><span class="p">(</span><span class="s2">&quot;96&quot;</span><span class="p">)</span>

    <span class="n">d5</span> <span class="o">=</span> <span class="n">Well</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;D5&quot;</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="n">plate_layout</span><span class="p">[</span><span class="s2">&quot;D5&quot;</span><span class="p">],</span>
        <span class="n">diameter</span><span class="o">=</span><span class="n">plate_layout</span><span class="p">[</span><span class="s2">&quot;well_diameter&quot;</span><span class="p">],</span>
        <span class="n">plate_object</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
        <span class="n">well_position_numeric</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="n">well_position_string</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">),</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">d6</span> <span class="o">=</span> <span class="n">Well</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;D6&quot;</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="n">plate_layout</span><span class="p">[</span><span class="s2">&quot;D6&quot;</span><span class="p">],</span>
        <span class="n">diameter</span><span class="o">=</span><span class="n">plate_layout</span><span class="p">[</span><span class="s2">&quot;well_diameter&quot;</span><span class="p">],</span>
        <span class="n">plate_object</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
        <span class="n">well_position_numeric</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="n">well_position_string</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">),</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">wellDict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;D5&quot;</span><span class="p">:</span> <span class="n">d5</span><span class="p">,</span> <span class="s2">&quot;D6&quot;</span><span class="p">:</span> <span class="n">d6</span><span class="p">}</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_wells</span><span class="p">(</span><span class="n">wellDict</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wells created and added to Plate&quot;</span><span class="p">)</span>

    <span class="c1"># create Colonies as part of Wells and add to Wells</span>
    <span class="n">meta_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;ImageNumber&quot;</span><span class="p">:</span> <span class="mi">134</span><span class="p">,</span>
        <span class="s2">&quot;ColonyNumber&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;WellRow&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WellColumn&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Center_X&quot;</span><span class="p">:</span> <span class="mf">800.16150465195233</span><span class="p">,</span>
        <span class="s2">&quot;Center_Y&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">149.09623005031244</span><span class="p">,</span>
        <span class="s2">&quot;Area&quot;</span><span class="p">:</span> <span class="mf">3854.0</span><span class="p">,</span>
        <span class="s2">&quot;ColonyMajorAxis&quot;</span><span class="p">:</span> <span class="mf">137.58512073673762</span><span class="p">,</span>
        <span class="s2">&quot;ColonyMinorAxis&quot;</span><span class="p">:</span> <span class="mf">49.001285888466853</span><span class="p">,</span>
        <span class="s2">&quot;Orientation&quot;</span><span class="p">:</span> <span class="mf">50.015418444799394</span><span class="p">,</span>
        <span class="s2">&quot;WellCenter_ImageCoordinates_X&quot;</span><span class="p">:</span> <span class="mf">3885.1862986357551</span><span class="p">,</span>
        <span class="s2">&quot;WellCenter_ImageCoordinates_Y&quot;</span><span class="p">:</span> <span class="mf">4153.2891461366862</span><span class="p">,</span>
        <span class="s2">&quot;Well&quot;</span><span class="p">:</span> <span class="s2">&quot;C3&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">meta_dict</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">804</span><span class="p">])</span>
    <span class="c1"># meta data not checked for compatibility with settings below</span>
    <span class="n">c1d5</span> <span class="o">=</span> <span class="n">Colony</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C1D5&quot;</span><span class="p">,</span>
        <span class="n">image</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">ellipse</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
        <span class="n">well_object</span><span class="o">=</span><span class="n">d5</span><span class="p">,</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">c1d5</span><span class="o">.</span><span class="n">set_cell_line</span><span class="p">(</span><span class="s2">&quot;AICS0&quot;</span><span class="p">)</span>
    <span class="n">c1d5</span><span class="o">.</span><span class="n">set_clone</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">)</span>
    <span class="n">c2d5</span> <span class="o">=</span> <span class="n">Colony</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C2D5&quot;</span><span class="p">,</span>
        <span class="n">image</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
        <span class="n">ellipse</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
        <span class="n">well_object</span><span class="o">=</span><span class="n">d5</span><span class="p">,</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">c2d5</span><span class="o">.</span><span class="n">set_cell_line</span><span class="p">(</span><span class="s2">&quot;AICS0&quot;</span><span class="p">)</span>
    <span class="n">c2d5</span><span class="o">.</span><span class="n">set_clone</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">)</span>

    <span class="n">colonyDict_d5</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C1D5&quot;</span><span class="p">:</span> <span class="n">c1d5</span><span class="p">,</span> <span class="s2">&quot;C2D5&quot;</span><span class="p">:</span> <span class="n">c2d5</span><span class="p">}</span>
    <span class="n">d5</span><span class="o">.</span><span class="n">add_colonies</span><span class="p">(</span><span class="n">colonyDict_d5</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Colonies created and added to Wells&quot;</span><span class="p">)</span>

    <span class="c1"># create cells and add to colonies</span>
    <span class="n">c1d5_1</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;c1d5_1&quot;</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">colony_object</span><span class="o">=</span><span class="n">c1d5</span><span class="p">,</span>
        <span class="n">x_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_flip</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">x_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">z_correction_x_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">z_correction_y_slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">cellsDict_c1d5</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;c1d5_1&quot;</span><span class="p">:</span> <span class="n">c1d5_1</span><span class="p">}</span>
    <span class="n">c1d5</span><span class="o">.</span><span class="n">add_cells</span><span class="p">(</span><span class="n">cellsDict_c1d5</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">______________________________________________</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cells created and added to Colonies:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of cells in colony &quot;</span><span class="p">,</span> <span class="n">c1d5</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">c1d5</span><span class="o">.</span><span class="n">number_cells</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">c1d5</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Microscope Automation</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Hardware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_components.html">hardware_components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_control.html">hardware_control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../RS232.html">RS232</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../setup_microscope.html">setup_microscope</a></li>
</ul>
<p class="caption"><span class="caption-text">Samples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../correct_background.html">correct_background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../draw_plate.html">draw_plate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../find_well_center.html">find_well_center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../find_cells.html">find_cells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interactive_location_picker_pyqtgraph.html">interactive_location_picker_pyqtgraph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../positions_list.html">positions_list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples.html">samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../setup_samples.html">setup_samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tile_images.html">tile_images</a></li>
</ul>
<p class="caption"><span class="caption-text">Zeiss Microscopes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../connect_zen_blue.html">connect_zen_blue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../connect_zen_black.html">connect_zen_black</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_control_zeiss.html">hardware_control_zeiss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../write_zen_tiles_experiment.html">write_zen_tiles_experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zen_experiment_info.html">zen_experiment_info</a></li>
</ul>
<p class="caption"><span class="caption-text">3i Microscopes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_control_3i.html">hardware_control_3i</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../connect_slidebook.html">connect_slidebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../slidebook_experiment_info.html">slidebook_experiment_info</a></li>
</ul>
<p class="caption"><span class="caption-text">General Methods</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../automation_exceptions.html">automation_exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../automation_messages_form_layout.html">automation_messages_form_layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../error_handling.html">error_handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_path.html">get_path</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../image_AICS.html">image_AICS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../load_image_czi.html">load_image_czi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../meta_data_file.html">meta_data_file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../preferences.html">preferences</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTRIBUTING.html">Allen Institute Contribution Agreement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../LICENSE.html">LICENSE</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../microscope_automation.html">microscope_automation</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Allen Institute.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>