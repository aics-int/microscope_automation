
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>microscope_automation.hardware.hardware_components &#8212; Microscope Automation 0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for microscope_automation.hardware.hardware_components</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Abstract classes that define common microscope components.</span>
<span class="sd">These components are system independent, so not all microscopes implement all classes.</span>
<span class="sd">They are the bridge between automation software and hardware specific implementations.</span>
<span class="sd">These classes should only be called by hardware_control.Microscope.</span>
<span class="sd">Created on Jul 7, 2016</span>
<span class="sd">Split into hardware_control and hardware_components on May 25, 2020</span>

<span class="sd">@author: winfriedw</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="kn">import</span> <span class="n">Path</span> <span class="k">as</span> <span class="n">mpl_path</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">inspect</span>

<span class="c1"># import modules from project microscope_automation</span>
<span class="kn">from</span> <span class="nn">microscope_automation.util.image_AICS</span> <span class="kn">import</span> <span class="n">ImageAICS</span>
<span class="kn">from</span> <span class="nn">microscope_automation.util</span> <span class="kn">import</span> <span class="n">automation_messages_form_layout</span> <span class="k">as</span> <span class="n">message</span>
<span class="kn">from</span> <span class="nn">microscope_automation.util.automation_exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ExperimentNotExistError</span><span class="p">,</span>
    <span class="n">AutofocusError</span><span class="p">,</span>
    <span class="n">AutofocusNotSetError</span><span class="p">,</span>
    <span class="n">AutofocusObjectiveChangedError</span><span class="p">,</span>
    <span class="n">ObjectiveNotDefinedError</span><span class="p">,</span>
    <span class="n">LoadNotDefinedError</span><span class="p">,</span>
    <span class="n">WorkNotDefinedError</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># setup logging</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span>


<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Switched on debug level logging in module &quot;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span>


<span class="c1"># keep track of xPos, yPos, and zPos of stage and focus for debugging purposes</span>


<div class="viewcode-block" id="log_method"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.log_method">[docs]</a><span class="k">def</span> <span class="nf">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methodName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log name of module and method if logging level is DEBUG.</span>

<span class="sd">    Input:</span>
<span class="sd">     methodName: string with  name of method</span>

<span class="sd">    Output:</span>
<span class="sd">     none</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">log_method------------------------------&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;Calling &#39;</span><span class="si">{}</span><span class="s2">&#39; in module &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Method: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">methodName</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Docstring: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span></div>


<span class="n">xPos</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">yPos</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">zPos</span> <span class="o">=</span> <span class="mi">0</span>


<div class="viewcode-block" id="log_message"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.log_message">[docs]</a><span class="k">def</span> <span class="nf">log_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">methodName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shows message if logging level is INFO.</span>

<span class="sd">    Input:</span>
<span class="sd">     message: string with message</span>
<span class="sd">     methodName: string with  name of method</span>

<span class="sd">    Output:</span>
<span class="sd">     none</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">log_message------------------------------&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Message from method &#39;</span><span class="si">{}</span><span class="s2">&#39;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">methodName</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="log_warning"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.log_warning">[docs]</a><span class="k">def</span> <span class="nf">log_warning</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">methodName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shows message if logging level is WARNING.</span>

<span class="sd">    Input:</span>
<span class="sd">     message: string with message</span>
<span class="sd">     methodName: string with  name of method</span>

<span class="sd">    Output:</span>
<span class="sd">     none</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">log_warning------------------------------&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Message from method &#39;</span><span class="si">{}</span><span class="s2">&#39;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">methodName</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<span class="c1">################################################################################</span>


<div class="viewcode-block" id="Experiment"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Experiment">[docs]</a><span class="k">class</span> <span class="nc">Experiment</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to validate, read, and write to experiment files</span>
<span class="sd">    They are handled in different ways in Zen Blue and Black.</span>
<span class="sd">    Hence this feature was moved to hardware level</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">microscope_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup and edit experiment file</span>

<span class="sd">        Input:</span>
<span class="sd">         file_path: File path to the experiment file (in zen black it will be none)</span>

<span class="sd">         name: Name of the experiment file</span>

<span class="sd">         microscope_object: microscope object that contains the connection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__init__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_path</span> <span class="o">=</span> <span class="n">experiment_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span> <span class="o">=</span> <span class="n">microscope_object</span>

<div class="viewcode-block" id="Experiment.validate_experiment"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Experiment.validate_experiment">[docs]</a>    <span class="k">def</span> <span class="nf">validate_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to check if the experiment is defined and valid</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         valid_experiment: bool describing if the experiment is valid or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;validate_experiment&quot;</span><span class="p">)</span>
        <span class="n">microscope_connection</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_control_software</span><span class="p">()</span><span class="o">.</span><span class="n">connection</span>
        <span class="p">)</span>
        <span class="n">valid_experiment</span> <span class="o">=</span> <span class="n">microscope_connection</span><span class="o">.</span><span class="n">validate_experiment</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">experiment_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">valid_experiment</span></div>

<div class="viewcode-block" id="Experiment.is_z_stack"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Experiment.is_z_stack">[docs]</a>    <span class="k">def</span> <span class="nf">is_z_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to check if the experiment contains z-stack acquisition.</span>
<span class="sd">        Raises ExperimentNotExistError for invalid experiments.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         is_zstack: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;is_z_stack&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_experiment</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ExperimentNotExistError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">)</span>

        <span class="n">microscope_connection</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_control_software</span><span class="p">()</span><span class="o">.</span><span class="n">connection</span>
        <span class="p">)</span>
        <span class="n">is_zstack</span> <span class="o">=</span> <span class="n">microscope_connection</span><span class="o">.</span><span class="n">is_z_stack</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">experiment_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">is_zstack</span></div>

<div class="viewcode-block" id="Experiment.z_stack_range"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Experiment.z_stack_range">[docs]</a>    <span class="k">def</span> <span class="nf">z_stack_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to calculate the range of the first experiment.</span>
<span class="sd">        Raises ExperimentNotExistError for invalid experiments.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         zstack_range: range</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;z_stack_range&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_experiment</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ExperimentNotExistError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">)</span>

        <span class="n">microscope_connection</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_control_software</span><span class="p">()</span><span class="o">.</span><span class="n">connection</span>
        <span class="p">)</span>
        <span class="n">zstack_range</span> <span class="o">=</span> <span class="n">microscope_connection</span><span class="o">.</span><span class="n">z_stack_range</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">experiment_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">zstack_range</span></div>

<div class="viewcode-block" id="Experiment.is_tile_scan"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Experiment.is_tile_scan">[docs]</a>    <span class="k">def</span> <span class="nf">is_tile_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to check if the experiment contains a tile scan.</span>
<span class="sd">        Raises ExperimentNotExistError for invalid experiments.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         is_tilescan: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;is_tile_scan&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_experiment</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ExperimentNotExistError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">)</span>

        <span class="n">microscope_connection</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_control_software</span><span class="p">()</span><span class="o">.</span><span class="n">connection</span>
        <span class="p">)</span>
        <span class="n">is_tilescan</span> <span class="o">=</span> <span class="n">microscope_connection</span><span class="o">.</span><span class="n">is_tile_scan</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">experiment_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">is_tilescan</span></div>

<div class="viewcode-block" id="Experiment.update_tile_positions"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Experiment.update_tile_positions">[docs]</a>    <span class="k">def</span> <span class="nf">update_tile_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_value</span><span class="p">,</span> <span class="n">y_value</span><span class="p">,</span> <span class="n">z_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to set the tile position.</span>
<span class="sd">        Raises ExperimentNotExistError for invalid experiments.</span>

<span class="sd">        Input:</span>
<span class="sd">         x_value: x coordinate</span>

<span class="sd">         y_value: y coordinate</span>

<span class="sd">         z_value: z coordinate</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;update_tile_positions&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_experiment</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ExperimentNotExistError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">)</span>

        <span class="n">microscope_connection</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_control_software</span><span class="p">()</span><span class="o">.</span><span class="n">connection</span>
        <span class="p">)</span>
        <span class="n">microscope_connection</span><span class="o">.</span><span class="n">update_tile_positions</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">experiment_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">,</span> <span class="n">x_value</span><span class="p">,</span> <span class="n">y_value</span><span class="p">,</span> <span class="n">z_value</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Experiment.get_objective_position"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Experiment.get_objective_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_objective_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to get the position of the objective used in the experiment.</span>
<span class="sd">        Raises ExperimentNotExistError for invalid experiments.</span>

<span class="sd">        Input:</span>
<span class="sd">         experiment_path: path of the experiment file</span>

<span class="sd">         experiment_name: name of the experiment</span>

<span class="sd">        Output:</span>
<span class="sd">         position: the integer position of the objective</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_objective_position&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_experiment</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ExperimentNotExistError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">)</span>

        <span class="n">microscope_connection</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_control_software</span><span class="p">()</span><span class="o">.</span><span class="n">connection</span>
        <span class="p">)</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">microscope_connection</span><span class="o">.</span><span class="n">get_objective_position_from_experiment_file</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">experiment_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">position</span></div>

<div class="viewcode-block" id="Experiment.get_focus_settings"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Experiment.get_focus_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_focus_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to get focus settings to test focus setup in test_zen_experiment.py</span>
<span class="sd">        Raises ExperimentNotExistError for invalid experiments.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         focus_settings: All instances of focus settings in experiment file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_focus_settings&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_experiment</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ExperimentNotExistError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">)</span>

        <span class="n">microscope_connection</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_control_software</span><span class="p">()</span><span class="o">.</span><span class="n">connection</span>
        <span class="p">)</span>
        <span class="n">focus_settings</span> <span class="o">=</span> <span class="n">microscope_connection</span><span class="o">.</span><span class="n">get_focus_settings</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">experiment_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">focus_settings</span></div></div>


<div class="viewcode-block" id="MicroscopeComponent"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.MicroscopeComponent">[docs]</a><span class="k">class</span> <span class="nc">MicroscopeComponent</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for all microscope components.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_id</span><span class="p">(</span><span class="n">component_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="c1"># settings during operation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_experiment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_camera</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_live_mode</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="MicroscopeComponent.set_id"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.MicroscopeComponent.set_id">[docs]</a>    <span class="k">def</span> <span class="nf">set_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set unique id for microscope component.</span>

<span class="sd">        Input:</span>
<span class="sd">         component_id: string with unique component id</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">component_id</span></div>

<div class="viewcode-block" id="MicroscopeComponent.get_id"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.MicroscopeComponent.get_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get unique id for component.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         component_id: string with unique component id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span></div>

<div class="viewcode-block" id="MicroscopeComponent.set_init_experiment"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.MicroscopeComponent.set_init_experiment">[docs]</a>    <span class="k">def</span> <span class="nf">set_init_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set experiment that will be used for initialization.</span>

<span class="sd">        Input:</span>
<span class="sd">         experiment: string with experiment name as defined within microscope software</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_experiment</span> <span class="o">=</span> <span class="n">experiment</span></div>

<div class="viewcode-block" id="MicroscopeComponent.get_init_experiment"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.MicroscopeComponent.get_init_experiment">[docs]</a>    <span class="k">def</span> <span class="nf">get_init_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get experiment that will be used for initialization.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: not usesd</span>

<span class="sd">        Output:</span>
<span class="sd">         init_experiment: string with experiment name defined within microscope software</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_experiment</span></div>

<div class="viewcode-block" id="MicroscopeComponent.initialize"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.MicroscopeComponent.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">communication_object</span><span class="p">,</span>
        <span class="n">action_list</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">reference_object_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Catch initialization method if not defined in sub class.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>
<span class="sd">         (not used)</span>

<span class="sd">         action_list: will not be processed</span>

<span class="sd">         reference_object_id: ID of plate the hardware is initialized for.</span>
<span class="sd">         Used for setting up of autofocus</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communication_object</span> <span class="o">=</span> <span class="n">communication_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_list</span> <span class="o">=</span> <span class="n">action_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plate_object_id</span> <span class="o">=</span> <span class="n">reference_object_id</span></div>

<div class="viewcode-block" id="MicroscopeComponent.set_component"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.MicroscopeComponent.set_component">[docs]</a>    <span class="k">def</span> <span class="nf">set_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Catch settings method if not defined in sub class.</span>

<span class="sd">        Input:</span>
<span class="sd">         settings: dictionary with flags</span>

<span class="sd">        Output:</span>
<span class="sd">         new_settings: dictionary with updated flags flags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">settings</span></div>

<div class="viewcode-block" id="MicroscopeComponent.get_information"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.MicroscopeComponent.get_information">[docs]</a>    <span class="k">def</span> <span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Catch get_information method if not defined in sub class.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>
<span class="sd">         (not used)</span>

<span class="sd">        Output:</span>
<span class="sd">         None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>


<span class="c1">################################################################################</span>


<div class="viewcode-block" id="ControlSoftware"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ControlSoftware">[docs]</a><span class="k">class</span> <span class="nc">ControlSoftware</span><span class="p">(</span><span class="n">MicroscopeComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Connect to software that controls specific Microscope.</span>
<span class="sd">    Import correct module based on Microscope software.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">software</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connect to microscope software</span>

<span class="sd">        Input:</span>
<span class="sd">         software: string with software name</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__init__&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlSoftware</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">software</span><span class="p">)</span>
        <span class="c1"># get name for software that controls Microscope</span>
        <span class="c1">#         self.software=software</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_to_microscope_software</span><span class="p">()</span>

<div class="viewcode-block" id="ControlSoftware.connect_to_microscope_software"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ControlSoftware.connect_to_microscope_software">[docs]</a>    <span class="k">def</span> <span class="nf">connect_to_microscope_software</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Import connect module based on software name and connect to microscope.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;connect_to_microscope_software&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ZEN Blue&quot;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">microscope_automation.connectors.connect_zen_blue</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">ConnectMicroscope</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">ConnectMicroscope</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ZEN Black&quot;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">microscope_automation.connectors.connect_zen_black</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">ConnectMicroscope</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">ConnectMicroscope</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Slidebook&quot;</span><span class="p">:</span>
            <span class="c1"># this is the only way to import modules starting with numbers</span>
            <span class="kn">from</span> <span class="nn">microscope_automation.connectors.connect_slidebook</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">ConnectMicroscope</span><span class="p">,</span>
            <span class="p">)</span>  <span class="c1"># noqa</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">ConnectMicroscope</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ZEN Blue Dummy&quot;</span><span class="p">:</span>
            <span class="c1"># create microscope Zeiss spinning disk simulation</span>
            <span class="c1"># Uses same module as standard Zen Blue microscope, but without dll</span>
            <span class="kn">from</span> <span class="nn">microscope_automation.connectors.connect_zen_blue</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">ConnectMicroscope</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">ConnectMicroscope</span><span class="p">(</span><span class="n">connect_dll</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Slidebook Dummy&quot;</span><span class="p">:</span>
            <span class="c1"># this is the only way to import modules starting with numbers</span>
            <span class="kn">from</span> <span class="nn">microscope_automation.connectors.connect_slidebook</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">ConnectMicroscope</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">ConnectMicroscope</span><span class="p">(</span><span class="n">dummy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>

        <span class="c1"># logger.info(&#39;selected software: %s&#39;, self.get_id())</span>


<span class="c1">################################################################################</span>


<div class="viewcode-block" id="Safety"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Safety">[docs]</a><span class="k">class</span> <span class="nc">Safety</span><span class="p">(</span><span class="n">MicroscopeComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class with methods to avoid hardware damage of microscope.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">safety_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define safe area for stage to travel.</span>

<span class="sd">        Input:</span>
<span class="sd">         safety_id: unique string to describe area</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__init__&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Safety</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">safety_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safe_areas</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Safety.add_safe_area"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Safety.add_safe_area">[docs]</a>    <span class="k">def</span> <span class="nf">add_safe_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">safe_vertices</span><span class="p">,</span> <span class="n">safe_area_id</span><span class="p">,</span> <span class="n">z_max</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set safe travel area for microscope stage.</span>

<span class="sd">        Input:</span>
<span class="sd">         safe_vertices: coordinates in absolute stage positions that define safe area</span>
<span class="sd">         in the form [(x_0, y_0), (x_1, y_1),c(x_2, y_2), ...).</span>

<span class="sd">         safe_area_id: unique string to identify safe area</span>

<span class="sd">         z_max: maximum z value in focus drive coordinates within safe area</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;add_safe_area&quot;</span><span class="p">)</span>
        <span class="n">safe_verts</span> <span class="o">=</span> <span class="n">safe_vertices</span> <span class="o">+</span> <span class="p">[</span><span class="n">safe_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">safe_codes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">mpl_path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">mpl_path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">safe_verts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">mpl_path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">safe_area</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">mpl_path</span><span class="p">(</span><span class="n">safe_verts</span><span class="p">,</span> <span class="n">safe_codes</span><span class="p">),</span> <span class="s2">&quot;z_max&quot;</span><span class="p">:</span> <span class="n">z_max</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safe_areas</span><span class="p">[</span><span class="n">safe_area_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">safe_area</span></div>

<div class="viewcode-block" id="Safety.get_safe_area"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Safety.get_safe_area">[docs]</a>    <span class="k">def</span> <span class="nf">get_safe_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">safe_area_id</span><span class="o">=</span><span class="s2">&quot;Compound&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get safe travel area for microscope stage. Create compound area if requested.</span>
<span class="sd">        This compound area is a union of the x-y plane&#39;s areas with the minimum z value.</span>

<span class="sd">        Input:</span>
<span class="sd">         safe_area_id: unique string to identify safe area.</span>
<span class="sd">         Default: &#39;Compound&#39; = combination of all safe areas</span>

<span class="sd">        Output:</span>
<span class="sd">         safe_area: dictionary of the form:</span>
<span class="sd">          path: matplotlib path object of safe area&#39;s perimeter</span>

<span class="sd">          z_max: maximum value the microscope can safely move in the z direction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_safe_area&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">safe_area_id</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">safe_areas</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">safe_areas</span><span class="p">[</span><span class="n">safe_area_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">safe_area_id</span> <span class="o">==</span> <span class="s2">&quot;Compound&quot;</span><span class="p">:</span>
            <span class="c1"># create compound area out of all existing safe areas</span>
            <span class="n">compound_path</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">safe_area_name</span><span class="p">,</span> <span class="n">safe_area</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">safe_areas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">safe_path</span> <span class="o">=</span> <span class="n">safe_area</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">compound_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">compound_path</span> <span class="o">=</span> <span class="n">safe_path</span>
                    <span class="n">z_max</span> <span class="o">=</span> <span class="n">safe_area</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">compound_path</span> <span class="o">=</span> <span class="n">mpl_path</span><span class="o">.</span><span class="n">make_compound_path</span><span class="p">(</span>
                        <span class="n">compound_path</span><span class="p">,</span> <span class="n">safe_path</span>
                    <span class="p">)</span>
                    <span class="n">z_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">z_max</span><span class="p">,</span> <span class="n">safe_area</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]))</span>

            <span class="n">safe_area</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">compound_path</span><span class="p">,</span> <span class="s2">&quot;z_max&quot;</span><span class="p">:</span> <span class="n">z_max</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">safe_area</span></div>

<div class="viewcode-block" id="Safety.is_safe_position"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Safety.is_safe_position">[docs]</a>    <span class="k">def</span> <span class="nf">is_safe_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">safe_area_id</span><span class="o">=</span><span class="s2">&quot;Compound&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if absolute position is safe.</span>
<span class="sd">        Compound area is a union of the x-y plane&#39;s areas with the minimum z value.</span>

<span class="sd">        Input:</span>
<span class="sd">         x, y: absolute stage position in um to be tested</span>

<span class="sd">         z: absolute focus position in um to be tested</span>

<span class="sd">         safe_area_id: unique string to identify safe area.</span>
<span class="sd">         Default: &#39;Compound&#39; = combination of all safe areas</span>

<span class="sd">        Output:</span>
<span class="sd">         is_safe: True if position is safe, otherwise False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;is_safe_position&quot;</span><span class="p">)</span>
        <span class="n">safe_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_safe_area</span><span class="p">(</span><span class="n">safe_area_id</span><span class="p">)</span>

        <span class="n">is_safe</span> <span class="o">=</span> <span class="n">safe_area</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">contains_point</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span> <span class="ow">and</span> <span class="n">safe_area</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">z</span>
        <span class="k">return</span> <span class="n">is_safe</span></div>

<div class="viewcode-block" id="Safety.is_safe_travel_path"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Safety.is_safe_travel_path">[docs]</a>    <span class="k">def</span> <span class="nf">is_safe_travel_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">safe_area_id</span><span class="o">=</span><span class="s2">&quot;Compound&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if intended travel path is safe.</span>
<span class="sd">        Compound area is a union of the x-y plane&#39;s areas with the minimum z value.</span>

<span class="sd">        Input:</span>
<span class="sd">         path: travel path to be tested as matplotlib.Path object</span>

<span class="sd">         z: maximum focus position in um of the travel path</span>

<span class="sd">         safe_area_id: unique string to identify safe area.</span>
<span class="sd">         Default: &#39;Compound&#39; = combination of all safe areas</span>

<span class="sd">         verbose: if True, show travel path and safe area. Default: True</span>

<span class="sd">        Output:</span>
<span class="sd">         is_safe: True if path is safe, otherwise False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;is_safe_travel_path&quot;</span><span class="p">)</span>
        <span class="n">safe_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_safe_area</span><span class="p">(</span><span class="n">safe_area_id</span><span class="p">)</span>

        <span class="c1"># Interpolate path. Path.contains_path appears to test only vertices.</span>
        <span class="c1"># Find necessary density for interpolation steps</span>
        <span class="c1"># Length of path</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">is_safe</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">iter_segments</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">mpl_path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">mpl_path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">length</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">vert</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">vert</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="p">)</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">is_safe</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">safe_area</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">contains_path</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">interpolated</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)))</span>
                <span class="ow">and</span> <span class="n">safe_area</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">z</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_safe</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">is_safe</span></div>

<div class="viewcode-block" id="Safety.is_safe_move_from_to"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Safety.is_safe_move_from_to">[docs]</a>    <span class="k">def</span> <span class="nf">is_safe_move_from_to</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">safe_area_id</span><span class="p">,</span>
        <span class="n">xy_path</span><span class="p">,</span>
        <span class="n">z_max_pos</span><span class="p">,</span>
        <span class="n">x_current</span><span class="p">,</span>
        <span class="n">y_current</span><span class="p">,</span>
        <span class="n">z_current</span><span class="p">,</span>
        <span class="n">x_target</span><span class="p">,</span>
        <span class="n">y_target</span><span class="p">,</span>
        <span class="n">z_target</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if it is safe to travel from current to target position.</span>

<span class="sd">        Input:</span>
<span class="sd">         safe_area_id: string id for safe area</span>

<span class="sd">         xy_path: matplotlib path object that describes travel path of stage</span>

<span class="sd">         z_max_pos: the highest position for z focus during travel</span>

<span class="sd">         x_current, y_current, z_current: current x, y, z positions of stage in um</span>

<span class="sd">         x_target, y_target, z_target: target x, y, z positions of stage in um</span>

<span class="sd">         verbose: if True, show tavel path and safe area (default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         is_safe: True if travel path is safe, otherwise False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;is_safe_move_from_to&quot;</span><span class="p">)</span>
        <span class="c1"># show safe area and travel path if verbose</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_safe_areas</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">xy_path</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="p">(</span><span class="n">x_current</span><span class="p">,</span> <span class="n">y_current</span><span class="p">))</span>
        <span class="c1"># is start position in safe area?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_safe_position</span><span class="p">(</span><span class="n">x_current</span><span class="p">,</span> <span class="n">y_current</span><span class="p">,</span> <span class="n">z_current</span><span class="p">,</span> <span class="n">safe_area_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># is target position in safe area?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_safe_position</span><span class="p">(</span><span class="n">x_target</span><span class="p">,</span> <span class="n">y_target</span><span class="p">,</span> <span class="n">z_target</span><span class="p">,</span> <span class="n">safe_area_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># is path in safe area?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_safe_travel_path</span><span class="p">(</span>
            <span class="n">xy_path</span><span class="p">,</span> <span class="n">z_max_pos</span><span class="p">,</span> <span class="n">safe_area_id</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Safety.show_safe_areas"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Safety.show_safe_areas">[docs]</a>    <span class="k">def</span> <span class="nf">show_safe_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show all safe areas defined in this class instance.</span>

<span class="sd">        Input:</span>
<span class="sd">         path: travel path to overlay with safe areas as matplotlib.Path object</span>

<span class="sd">         point: point to overlay with safe area as (x, y) tuple</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;show_safe_areas&quot;</span><span class="p">)</span>
        <span class="c1"># setup figure</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Spectral&quot;</span><span class="p">)</span>
        <span class="c1"># add all safe areas to figure</span>
        <span class="n">compound_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">safe_area_name</span><span class="p">,</span> <span class="n">safe_area</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">safe_areas</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">safe_path</span> <span class="o">=</span> <span class="n">safe_area</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">patch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">safe_path</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
            <span class="c1"># combine all path objects to one compound path</span>
            <span class="k">if</span> <span class="n">compound_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">compound_path</span> <span class="o">=</span> <span class="n">safe_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">compound_path</span> <span class="o">=</span> <span class="n">mpl_path</span><span class="o">.</span><span class="n">make_compound_path</span><span class="p">(</span><span class="n">compound_path</span><span class="p">,</span> <span class="n">safe_path</span><span class="p">)</span>

        <span class="c1"># add point and path information to image</span>

        <span class="c1"># define size of viewing area</span>
        <span class="k">if</span> <span class="n">point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path_patch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">path_patch</span><span class="p">)</span>
        <span class="c1"># get bounding box</span>
        <span class="n">view_box</span> <span class="o">=</span> <span class="n">compound_path</span><span class="o">.</span><span class="n">get_extents</span><span class="p">()</span>

        <span class="c1"># increase size of bounding box to view_box</span>
        <span class="n">view_box</span> <span class="o">=</span> <span class="n">view_box</span><span class="o">.</span><span class="n">expanded</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">view_box</span><span class="o">.</span><span class="n">min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">view_box</span><span class="o">.</span><span class="n">max</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">view_box</span><span class="o">.</span><span class="n">min</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">view_box</span><span class="o">.</span><span class="n">max</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>


<span class="c1">################################################################################</span>


<div class="viewcode-block" id="Camera"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Camera">[docs]</a><span class="k">class</span> <span class="nc">Camera</span><span class="p">(</span><span class="n">MicroscopeComponent</span><span class="p">,</span> <span class="n">ImageAICS</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and operate microscope camera&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">camera_id</span><span class="p">,</span>
        <span class="n">pixel_size</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">pixel_number</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">pixel_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">detector_type</span><span class="o">=</span><span class="s2">&quot;generic&quot;</span><span class="p">,</span>
        <span class="n">manufacturer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Describe and operate camera</span>

<span class="sd">        Input:</span>
<span class="sd">         camera_id: string with unique camera id</span>

<span class="sd">         pixel_size: (x, y) pixel size in mum</span>

<span class="sd">         pixel_number: (x, y) pixel number</span>

<span class="sd">         pixel_type: type of pixels (e.g. int32)</span>

<span class="sd">         name: string with brand name of camera, e.g. Flash 4.0</span>

<span class="sd">         detector_type: string with camera type, e.g. EMCCD, sCMOS</span>

<span class="sd">         manufacturer: string with name of manufacturere, e.g. Hamamatsu</span>

<span class="sd">         model: string of the name of the model</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__init__&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Camera</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">camera_id</span><span class="p">)</span>

        <span class="c1"># keep track of live mode status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">live_mode_on</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Specifications for used camera.</span>
        <span class="c1"># Names for keys are based on OME-XML</span>
        <span class="c1"># http://www.openmicroscopy.org/Schemas/Documentation/Generated/OME-2015-01/ome.html</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;aics_cameraID&quot;</span><span class="p">:</span> <span class="n">camera_id</span><span class="p">,</span>
            <span class="c1"># The variable type used to represent each pixel in the image.</span>
            <span class="s2">&quot;aics_PixelType&quot;</span><span class="p">:</span> <span class="n">pixel_type</span><span class="p">,</span>
            <span class="c1"># Dimensional size of pixel data array [units:none].</span>
            <span class="s2">&quot;aics_SizeX&quot;</span><span class="p">:</span> <span class="n">pixel_number</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="c1"># Dimensional size of pixel data array [units:none].</span>
            <span class="s2">&quot;aics_SizeY&quot;</span><span class="p">:</span> <span class="n">pixel_number</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="c1"># Physical size of a pixel. Units are set by PhysicalSizeXUnit.</span>
            <span class="s2">&quot;aics_PhysicalSizeX&quot;</span><span class="p">:</span> <span class="n">pixel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="c1"># Physical size of a pixel. Units are set by PhysicalSizeYUnit.</span>
            <span class="s2">&quot;aics_PhysicalSizeY&quot;</span><span class="p">:</span> <span class="n">pixel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="c1"># The units of the physical size of a pixel - default:microns[micron].</span>
            <span class="s2">&quot;aics_PhysicalSizeXUnit&quot;</span><span class="p">:</span> <span class="s2">&quot;mum&quot;</span><span class="p">,</span>
            <span class="c1"># The units of the physical size of a pixel - default:microns[micron].</span>
            <span class="s2">&quot;aics_PhysicalSizeYUnit&quot;</span><span class="p">:</span> <span class="s2">&quot;mum&quot;</span><span class="p">,</span>
            <span class="c1"># The manufacturer of the component. [plain text string]</span>
            <span class="s2">&quot;aics_Manufacturer&quot;</span><span class="p">:</span> <span class="n">manufacturer</span><span class="p">,</span>
            <span class="c1"># The Model of the component. [plain text string]</span>
            <span class="s2">&quot;aics_Model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
            <span class="c1"># The Type of detector. E.g. CCD, PMT, EMCCD etc.</span>
            <span class="s2">&quot;aics_Type&quot;</span><span class="p">:</span> <span class="n">detector_type</span><span class="p">,</span>
        <span class="p">}</span>

<div class="viewcode-block" id="Camera.get_information"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Camera.get_information">[docs]</a>    <span class="k">def</span> <span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get camera status</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software.</span>
<span class="sd">         Not used by Camera class, but maintained for consistency with</span>
<span class="sd">         parent class MicroscopeComponent</span>

<span class="sd">        Output:</span>
<span class="sd">         camera_dict: dictionary {&#39;live&#39;: True/False, &#39;settings&#39;:  dict with settings}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_information&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;live&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_mode_on</span><span class="p">,</span> <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">}</span></div>

<div class="viewcode-block" id="Camera.snap_image"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Camera.snap_image">[docs]</a>    <span class="k">def</span> <span class="nf">snap_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Snap image with parameters defined in experiment.</span>
<span class="sd">        Class ImageAICS is a container for meta and image data.</span>
<span class="sd">        To add image data use method load_image.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         experiment: string with name of experiment defined within Microscope software.</span>
<span class="sd">         If None uses active/default experiment.</span>

<span class="sd">        Return:</span>
<span class="sd">         image: image of class ImageAICS to hold metadata.</span>
<span class="sd">         Does not contain image data at this moment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;snap_image&quot;</span><span class="p">)</span>
        <span class="c1"># call snap_image method in ConnectMicroscope instance.</span>
        <span class="c1"># This instance will be based on a microscope specific connect module.</span>
        <span class="n">communication_object</span><span class="o">.</span><span class="n">snap_image</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">ImageAICS</span><span class="p">(</span><span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;aics_Experiment&quot;</span><span class="p">:</span> <span class="n">experiment</span><span class="p">})</span>
        <span class="n">image</span><span class="o">.</span><span class="n">add_meta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="Camera.live_mode_start"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Camera.live_mode_start">[docs]</a>    <span class="k">def</span> <span class="nf">live_mode_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start live mode of ZEN software.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         experiment: name of ZEN experiment (default = None)</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;live_mode_start&quot;</span><span class="p">)</span>
        <span class="n">communication_object</span><span class="o">.</span><span class="n">live_mode_start</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">live_mode_on</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Camera.live_mode_stop"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Camera.live_mode_stop">[docs]</a>    <span class="k">def</span> <span class="nf">live_mode_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop live mode of ZEN software.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         experiment: name of ZEN experiment (default = None).</span>
<span class="sd">         If None use actual experiment.</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;live_mode_stop&quot;</span><span class="p">)</span>
        <span class="n">communication_object</span><span class="o">.</span><span class="n">live_mode_stop</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">live_mode_on</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<span class="c1">################################################################################</span>


<div class="viewcode-block" id="Stage"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Stage">[docs]</a><span class="k">class</span> <span class="nc">Stage</span><span class="p">(</span><span class="n">MicroscopeComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and operate microscope stage&quot;&quot;&quot;</span>

    <span class="c1">#     def __init__(self, stageObject, id, safe_area_object = None):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">stage_id</span><span class="p">,</span>
        <span class="n">safe_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">safe_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">objective_changer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">microscope_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">default_experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Describe and operate microscope stage</span>

<span class="sd">        Input:</span>
<span class="sd">         stage_id: string with unique stage id</span>

<span class="sd">         safe_area: Name of area to stage can travel safely</span>

<span class="sd">         safe_position: Position of stage that is safe</span>

<span class="sd">         objective_changer: string with unique id for objective changer assoziated</span>
<span class="sd">         with stage required for par-centrizity correction</span>

<span class="sd">         microscope_object: microscope component is attached to</span>

<span class="sd">         default_experiment: default experiment (ZEN) or capture settings (Slidebook)</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__init__&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Stage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">stage_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safe_area</span> <span class="o">=</span> <span class="n">safe_area</span>
        <span class="k">if</span> <span class="n">safe_position</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">safe_position_x</span> <span class="o">=</span> <span class="n">safe_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">safe_position_y</span> <span class="o">=</span> <span class="n">safe_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">safe_position_x</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">safe_position_y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer</span> <span class="o">=</span> <span class="n">objective_changer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span> <span class="o">=</span> <span class="n">microscope_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_experiment</span> <span class="o">=</span> <span class="n">default_experiment</span>

<div class="viewcode-block" id="Stage.initialize"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Stage.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">communication_object</span><span class="p">,</span>
        <span class="n">action_list</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">reference_object_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize stage.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         action_list: not used</span>

<span class="sd">         reference_object_id: not used</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">         test: if True do not move stage</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;initialize&quot;</span><span class="p">)</span>
        <span class="c1"># Move stage to safe position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span>
            <span class="n">communication_object</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">safe_position_x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">safe_position_y</span><span class="p">,</span>
            <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Stage.get_information"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Stage.get_information">[docs]</a>    <span class="k">def</span> <span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get actual stage position from hardware in mum</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         positions_dict: dictionary with stage position in mum of the form:</span>
<span class="sd">          {&#39;absolute&#39;: (x, y, z), &#39;centricity_corrected&#39;: ()}</span>

<span class="sd">         z is optional depending on microscope used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_information&quot;</span><span class="p">)</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">get_stage_pos</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">positions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer</span><span class="p">:</span>
            <span class="n">obj_changer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_microscope_object</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer</span>
            <span class="p">)</span>
            <span class="n">obj_info</span> <span class="o">=</span> <span class="n">obj_changer</span><span class="o">.</span><span class="n">get_objective_information</span><span class="p">(</span><span class="n">communication_object</span><span class="p">)</span>
            <span class="n">centricity_cor</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj_info</span><span class="p">[</span><span class="s2">&quot;x_offset&quot;</span><span class="p">],</span> <span class="n">obj_info</span><span class="p">[</span><span class="s2">&quot;y_offset&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">centricity_cor</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;absolute&quot;</span><span class="p">:</span> <span class="n">positions</span><span class="p">,</span> <span class="s2">&quot;centricity_corrected&quot;</span><span class="p">:</span> <span class="n">centricity_cor</span><span class="p">}</span></div>

<div class="viewcode-block" id="Stage.move_to_position"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Stage.move_to_position">[docs]</a>    <span class="k">def</span> <span class="nf">move_to_position</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set stage position in mum and move stage</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         x, y, z: stage position in mum</span>

<span class="sd">         experiment: experiment (ZEN) of capture settings (Slidebook) to use</span>
<span class="sd">         when operation stage (not allways required).</span>
<span class="sd">         None: use default experiment</span>

<span class="sd">         test: if True return travel path and do not move stage</span>

<span class="sd">        Output:</span>
<span class="sd">         xStage, yStage: position of stage after movement in mum</span>

<span class="sd">         zStage: position of stage after movement in mum</span>
<span class="sd">         (optional depending on whether a z value was input)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;move_to_position&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test</span><span class="p">:</span>
            <span class="n">xy_path</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">move_stage_to</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zPos</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">)</span>
            <span class="n">path_object</span> <span class="o">=</span> <span class="n">mpl_path</span><span class="p">(</span><span class="n">xy_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">path_object</span>
        <span class="k">if</span> <span class="n">experiment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">experiment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_experiment</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">move_stage_to</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">positions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></div></div>


<span class="c1">################################################################################</span>


<div class="viewcode-block" id="ObjectiveChanger"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger">[docs]</a><span class="k">class</span> <span class="nc">ObjectiveChanger</span><span class="p">(</span><span class="n">MicroscopeComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and change objectives&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">objective_changer_id</span><span class="p">,</span>
        <span class="n">n_positions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">objectives</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ref_objective</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">microscope_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Describe and change objectives</span>

<span class="sd">        Input:</span>
<span class="sd">         objective_changer_id: string with unique objective changer id</span>

<span class="sd">         n_positions: number of objective positions</span>

<span class="sd">         objectives: dictionary of the form:</span>
<span class="sd">          &#39;objective_name&#39;:</span>
<span class="sd">           &#39;x_offset&#39;: x</span>

<span class="sd">           &#39;y_offset&#39;: y</span>

<span class="sd">           &#39;z_offset&#39;: z</span>

<span class="sd">           &#39;magnification&#39;: m</span>

<span class="sd">           &#39;immersion&#39;: &#39;type&#39;</span>

<span class="sd">           &#39;experiment&#39;: &#39;name&#39;</span>

<span class="sd">          ref_objective: string with name of objective which defines reference position</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__init__&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ObjectiveChanger</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">objective_changer_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">number_positions</span> <span class="o">=</span> <span class="n">n_positions</span>

        <span class="c1"># Set dictionary of objectives with self.get_all_objectives(n)</span>
        <span class="c1"># Required when using self.change_magnification(magnification)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objectives_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objective_information</span> <span class="o">=</span> <span class="n">objectives</span>

        <span class="c1"># set experiment for initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_objective</span> <span class="o">=</span> <span class="n">ref_objective</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_information</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_objective</span><span class="p">:</span>
            <span class="n">init_experiment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_information</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_objective</span><span class="p">][</span>
                <span class="s2">&quot;experiment&quot;</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_experiment</span> <span class="o">=</span> <span class="n">init_experiment</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_information</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_objective</span><span class="p">][</span>
                <span class="s2">&quot;camera&quot;</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_camera</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_experiment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_live_mode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span> <span class="o">=</span> <span class="n">microscope_object</span>

<div class="viewcode-block" id="ObjectiveChanger.initialize"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">communication_object</span><span class="p">,</span>
        <span class="n">action_list</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">reference_object_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize objective changer and set reference positions.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         action_list: list with item &#39;set_reference&#39;. If empty no action.</span>

<span class="sd">         reference_object_id: ID of plate, plate holder, or other sample object</span>
<span class="sd">         the hardware is initialized for. Used for setting up of autofocus</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;initialize&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;set_reference&quot;</span> <span class="ow">in</span> <span class="n">action_list</span><span class="p">:</span>
            <span class="c1"># setup microscope to initialize ObjectiveChanger</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">setup_microscope_for_initialization</span><span class="p">(</span>
                <span class="n">component_object</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">experiment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_init_experiment</span><span class="p">(),</span>
                <span class="n">before_initialization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">reference_position</span><span class="p">(</span>
                <span class="n">find_surface</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">reference_object_id</span><span class="o">=</span><span class="n">reference_object_id</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Clean up after initialization</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">setup_microscope_for_initialization</span><span class="p">(</span>
                <span class="n">component_object</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">experiment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_init_experiment</span><span class="p">(),</span>
                <span class="n">before_initialization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ObjectiveChanger.set_number_positions"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger.set_number_positions">[docs]</a>    <span class="k">def</span> <span class="nf">set_number_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_positions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the number of objective positions.</span>

<span class="sd">        Input:</span>
<span class="sd">         n_positions:  number of objective positions</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;set_number_positions&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_positions</span> <span class="o">=</span> <span class="n">n_positions</span></div>

<div class="viewcode-block" id="ObjectiveChanger.get_number_positions"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger.get_number_positions">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of objective positions.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         n_positions:  number of objective positions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_number_positions&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_positions</span></div>

<div class="viewcode-block" id="ObjectiveChanger.get_all_objectives"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger.get_all_objectives">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_objectives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve name and magnification of all objectives.</span>
<span class="sd">        Required when using self.change_magnification(magnification)</span>

<span class="sd">        Warning! Objectives will move!</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         objectives_dict: dictionary of all objectives mounted at microscope</span>
<span class="sd">         in form {&#39;magnification&#39;: {&#39;Position&#39;: position, &#39;Name&#39;: name}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_all_objectives&quot;</span><span class="p">)</span>
        <span class="n">number_objectives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_positions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objectives_dict</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">get_all_objectives</span><span class="p">(</span>
            <span class="n">number_objectives</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives_dict</span></div>

<div class="viewcode-block" id="ObjectiveChanger.get_objectives_dict"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger.get_objectives_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_objectives_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves dictionary with all names and magnifications of objectives.</span>

<span class="sd">        Requires to run self.get_all_objectives once before usage.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         objectives_dict: dictionary of all objectives mounted at microscope</span>
<span class="sd">         in form {&#39;magnification&#39;: {&#39;Position&#39;: position, &#39;Name&#39;: name}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_objectives_dict&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives_dict</span></div>

<div class="viewcode-block" id="ObjectiveChanger.get_objective_magnification"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger.get_objective_magnification">[docs]</a>    <span class="k">def</span> <span class="nf">get_objective_magnification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get magnification of actual objective.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         magnification: magnification of actual objective, objective in imaging position</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_objective_magnification&quot;</span><span class="p">)</span>
        <span class="c1"># get magnification from hardware</span>
        <span class="n">magnification</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">get_objective_magnification</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">magnification</span></div>

<div class="viewcode-block" id="ObjectiveChanger.get_objective_information"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger.get_objective_information">[docs]</a>    <span class="k">def</span> <span class="nf">get_objective_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get offset to correct for parfocality and parcentrality for current objective</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         objective_information: dictionary for the current objective in the form:</span>
<span class="sd">          &#39;x_offset&#39;: x</span>

<span class="sd">          &#39;y_offset&#39;: y</span>

<span class="sd">          &#39;z_offset&#39;: z</span>

<span class="sd">          &#39;magnification&#39;: m</span>

<span class="sd">          &#39;immersion&#39;: &#39;type&#39;</span>

<span class="sd">          &#39;experiment&#39;: &#39;name&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_objective_information&quot;</span><span class="p">)</span>
        <span class="n">objective_name</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">get_objective_name</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">objective_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_information</span><span class="p">:</span>
            <span class="n">objective_information</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_information</span><span class="p">[</span><span class="n">objective_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">objective_information</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;x_offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;y_offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;z_offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;magnification&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;immersion&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;Information for objective </span><span class="si">{}</span><span class="s2"> is not defined&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">objective_name</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">objective_information</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">objective_name</span>
        <span class="k">return</span> <span class="n">objective_information</span></div>

<div class="viewcode-block" id="ObjectiveChanger.update_objective_offset"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger.update_objective_offset">[docs]</a>    <span class="k">def</span> <span class="nf">update_objective_offset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">,</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">,</span> <span class="n">z_offset</span><span class="p">,</span> <span class="n">objective_name</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update offset to correct for parfocality and parcentrality</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         x_offset, y_offset, z_offset: new offset values in absolute coordinates</span>

<span class="sd">         objective_name: string with unique name for objective.</span>
<span class="sd">         If None use current objective</span>

<span class="sd">        Output:</span>
<span class="sd">         objective_information: dictionary for the current objective in the form:</span>
<span class="sd">          &#39;x_offset&#39;: x</span>

<span class="sd">          &#39;y_offset&#39;: y</span>

<span class="sd">          &#39;z_offset&#39;: z</span>

<span class="sd">          &#39;magnification&#39;: m</span>

<span class="sd">          &#39;immersion&#39;: &#39;type&#39;</span>

<span class="sd">          &#39;experiment&#39;: &#39;name&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;update_objective_offset&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">objective_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">objective_name</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">get_objective_name</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objective_information</span><span class="p">[</span><span class="n">objective_name</span><span class="p">][</span><span class="s2">&quot;x_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_offset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objective_information</span><span class="p">[</span><span class="n">objective_name</span><span class="p">][</span><span class="s2">&quot;y_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_offset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objective_information</span><span class="p">[</span><span class="n">objective_name</span><span class="p">][</span><span class="s2">&quot;z_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_offset</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ObjectiveNotDefinedError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No objective with name </span><span class="si">{}</span><span class="s2"> defined.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">objective_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_information</span><span class="p">[</span><span class="n">objective_name</span><span class="p">]</span></div>

<div class="viewcode-block" id="ObjectiveChanger.get_information"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger.get_information">[docs]</a>    <span class="k">def</span> <span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get name and magnification of actual objective.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         name, magnification, position, and experiment of objective in imaging position</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_information&quot;</span><span class="p">)</span>
        <span class="c1"># get name of objective from hardware</span>
        <span class="n">objective_name</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">get_objective_name</span><span class="p">()</span>
        <span class="n">objective_magnification</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_objective_magnification</span><span class="p">(</span><span class="n">communication_object</span><span class="p">)</span>
        <span class="n">objective_position</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">get_objective_position</span><span class="p">()</span>
        <span class="n">init_experiment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_information</span><span class="p">[</span><span class="n">objective_name</span><span class="p">][</span><span class="s2">&quot;experiment&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">objective_name</span><span class="p">,</span>
            <span class="s2">&quot;magnification&quot;</span><span class="p">:</span> <span class="n">objective_magnification</span><span class="p">,</span>
            <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">objective_position</span><span class="p">,</span>
            <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="n">init_experiment</span><span class="p">,</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="ObjectiveChanger.change_magnification"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger.change_magnification">[docs]</a>    <span class="k">def</span> <span class="nf">change_magnification</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">communication_object</span><span class="p">,</span>
        <span class="n">magnification</span><span class="p">,</span>
        <span class="n">sample_object</span><span class="p">,</span>
        <span class="n">use_safe_position</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change to objective with given magnification.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: object that connects to microscope specific software</span>

<span class="sd">         magnification: magnification of selected objective as float.</span>
<span class="sd">         Not well defined if multiple objectives with identical magnification exist.</span>

<span class="sd">         sample_object: object that has safe coordinates attached.</span>
<span class="sd">         If use_safe_position == True than stage and focus drive will move to</span>
<span class="sd">         this position before magnification is changed to avoid collision</span>
<span class="sd">         between objective and stage.</span>

<span class="sd">         use_safe_position: move stage and focus drive to safe position before switching</span>
<span class="sd">         magnification to minimize risk of collision (Default: True)</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">         load: if True, move objective to load position before switching (Default: True)</span>

<span class="sd">        Output:</span>
<span class="sd">         objective_name: name of new objective</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;change_magnification&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">objectives_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_objectives</span><span class="p">(</span><span class="n">communication_object</span><span class="p">)</span>
            <span class="n">objective</span> <span class="o">=</span> <span class="n">objectives_dict</span><span class="p">[</span><span class="n">magnification</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ObjectiveNotDefinedError</span><span class="p">(</span>
                <span class="s2">&quot;No objective with magnification </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">magnification</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># move to safe position before changing objective</span>
        <span class="k">if</span> <span class="n">use_safe_position</span><span class="p">:</span>
            <span class="n">sample_object</span><span class="o">.</span><span class="n">move_to_safe</span><span class="p">(</span><span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">objective_name</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">switch_objective</span><span class="p">(</span>
            <span class="n">objective</span><span class="p">[</span><span class="s2">&quot;Position&quot;</span><span class="p">],</span> <span class="n">load</span><span class="o">=</span><span class="n">load</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">objective_name</span></div>

<div class="viewcode-block" id="ObjectiveChanger.change_position"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.ObjectiveChanger.change_position">[docs]</a>    <span class="k">def</span> <span class="nf">change_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change to objective at given position.</span>
<span class="sd">        Requires self.get_all_objectives run once before usage.</span>

<span class="sd">        Input:</span>
<span class="sd">         position: position of objective</span>

<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         load: if True, move objective to load position before switching (Default: True)</span>

<span class="sd">        Output:</span>
<span class="sd">         objective_name: name of new objective</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;change_position&quot;</span><span class="p">)</span>
        <span class="n">objective_name</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">switch_objective</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="n">load</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">objective_name</span></div></div>


<span class="c1">################################################################################</span>


<div class="viewcode-block" id="FocusDrive"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.FocusDrive">[docs]</a><span class="k">class</span> <span class="nc">FocusDrive</span><span class="p">(</span><span class="n">MicroscopeComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and operate focus drive&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">focus_drive_id</span><span class="p">,</span>
        <span class="n">max_load_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">min_work_position</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">auto_focus_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">objective_changer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">microscope_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Describe and operate focus drive</span>

<span class="sd">        Input:</span>
<span class="sd">         focus_drive_id: string with unique focus drive id</span>

<span class="sd">         max_load_position: maximum load position in um (Default = 0)</span>

<span class="sd">         min_work_position: minimum work position in um (Default = 10</span>

<span class="sd">         auto_focus_id: unique string to identify autofocus used with focus drive</span>
<span class="sd">         (None if no autofocus)</span>

<span class="sd">         objective_changer: string with unique id for objective changer assoziated</span>
<span class="sd">         with stage required for par-centrizity correction</span>

<span class="sd">         microscope_object: microscope component is attached to</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__init__&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FocusDrive</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">focus_drive_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">auto_focus_id</span> <span class="o">=</span> <span class="n">auto_focus_id</span>

        <span class="c1"># define max and min load and work positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_load_position</span> <span class="o">=</span> <span class="n">max_load_position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_work_position</span> <span class="o">=</span> <span class="n">min_work_position</span>

        <span class="c1"># predefine focus load and work positions as 0 to avoid crashes</span>
        <span class="c1"># between objective and stage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_load</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_work</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer</span> <span class="o">=</span> <span class="n">objective_changer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span> <span class="o">=</span> <span class="n">microscope_object</span>

<div class="viewcode-block" id="FocusDrive.initialize"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.FocusDrive.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">communication_object</span><span class="p">,</span>
        <span class="n">action_list</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">reference_object_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize focus drive.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         action_list: list with items &#39;set_load&#39; and/or &#39;set_work&#39;. If empty no action.</span>

<span class="sd">         microscope_object: microscope component is attached to</span>

<span class="sd">         reference_object_id: not used</span>

<span class="sd">         verbose: if True print debug information (Default = True)</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;initialize&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;set_load&quot;</span> <span class="ow">in</span> <span class="n">action_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">test</span><span class="p">:</span>
                <span class="n">message</span><span class="o">.</span><span class="n">operate_message</span><span class="p">(</span>
                    <span class="s2">&quot;Move focus drive </span><span class="si">{}</span><span class="s2"> to load position.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()),</span>
                    <span class="n">return_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">load_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_load_position</span><span class="p">(</span><span class="n">communication_object</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">load_pos</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_load_position</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">test</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">LoadNotDefinedError</span><span class="p">(</span>
                        <span class="s2">&quot;Load position </span><span class="si">{}</span><span class="s2"> is higher than allowed maximum </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">load_pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_load_position</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message_text</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;Load position </span><span class="si">{}</span><span class="s2"> is higher than allowed maximum </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">load_pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_load_position</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">return_code</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">error_message</span><span class="p">(</span>
                        <span class="s1">&#39;Please move objective to load position or cancel program.</span><span class="se">\n</span><span class="s1">Error message:</span><span class="se">\n</span><span class="s1">&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>  <span class="c1"># noqa</span>
                            <span class="n">message_text</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">return_code</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">LoadNotDefinedError</span><span class="p">(</span>
                            <span class="s2">&quot;Load position </span><span class="si">{}</span><span class="s2"> is higher than allowed maximum </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>  <span class="c1"># noqa</span>
                                <span class="n">load_pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_load_position</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;set_work&quot;</span> <span class="ow">in</span> <span class="n">action_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">test</span><span class="p">:</span>
                <span class="n">message</span><span class="o">.</span><span class="n">operate_message</span><span class="p">(</span>
                    <span class="s1">&#39;Please move focus drive &quot;</span><span class="si">{}</span><span class="s1">&quot; to work position.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span>
                    <span class="p">),</span>
                    <span class="n">return_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">work_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_work_position</span><span class="p">(</span><span class="n">communication_object</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">work_pos</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_work_position</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WorkNotDefinedError</span><span class="p">(</span>
                    <span class="s2">&quot;Work position </span><span class="si">{}</span><span class="s2"> is lower than allowed minimum </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">work_pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_work_position</span>
                    <span class="p">)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="FocusDrive.get_abs_position"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.FocusDrive.get_abs_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_abs_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get absolute focus position from hardware in mum</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         z: focus position in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_abs_position&quot;</span><span class="p">)</span>
        <span class="c1"># get current absolute focus position w/o any drift corrections</span>
        <span class="n">absZ</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">get_focus_pos</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">absZ</span></div>

<div class="viewcode-block" id="FocusDrive.get_information"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.FocusDrive.get_information">[docs]</a>    <span class="k">def</span> <span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get absolute and absolute position after drift correction for focus drive.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         positions_dict: dictionary with</span>
<span class="sd">          &#39;absolute&#39;: absolute position of focus drive as shown in software</span>

<span class="sd">          &#39;z_focus_offset&#39;: parfocality offset</span>

<span class="sd">          &#39;focality_corrected&#39;: absolute focus position - z_focus_offset</span>

<span class="sd">          &#39;load_position&#39;: load position of focus drive</span>

<span class="sd">          &#39;work_position&#39;: work position of focus drive</span>

<span class="sd">         with focus positions in um</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_information&quot;</span><span class="p">)</span>

        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_position</span><span class="p">(</span><span class="n">communication_object</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer</span><span class="p">:</span>
            <span class="n">obj_changer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_microscope_object</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer</span>
            <span class="p">)</span>
            <span class="n">obj_info</span> <span class="o">=</span> <span class="n">obj_changer</span><span class="o">.</span><span class="n">get_objective_information</span><span class="p">(</span><span class="n">communication_object</span><span class="p">)</span>
            <span class="n">z_focus_offset</span> <span class="o">=</span> <span class="n">obj_info</span><span class="p">[</span><span class="s2">&quot;z_offset&quot;</span><span class="p">]</span>
            <span class="n">focality_corrected</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">z_focus_offset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z_focus_offset</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">focality_corrected</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;absolute&quot;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span>
            <span class="s2">&quot;load_position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_load_position</span><span class="p">(),</span>
            <span class="s2">&quot;work_position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_work_position</span><span class="p">(),</span>
            <span class="s2">&quot;focality_corrected&quot;</span><span class="p">:</span> <span class="n">focality_corrected</span><span class="p">,</span>
            <span class="s2">&quot;z_focus_offset&quot;</span><span class="p">:</span> <span class="n">z_focus_offset</span><span class="p">,</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="FocusDrive.move_to_position"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.FocusDrive.move_to_position">[docs]</a>    <span class="k">def</span> <span class="nf">move_to_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set focus position in mum and move focus drive.</span>
<span class="sd">        If use_autofocus is set, correct z value according to new autofocus position.</span>

<span class="sd">        Raises HardwareCommandNotDefinedError for Slidebook connections.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         z: focus drive position in mum</span>

<span class="sd">        Output:</span>
<span class="sd">         zFocus: position of focus drive after movement in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;move_to_position&quot;</span><span class="p">)</span>

        <span class="n">zFocus</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">move_focus_to</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">zFocus</span></div>

<div class="viewcode-block" id="FocusDrive.goto_load"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.FocusDrive.goto_load">[docs]</a>    <span class="k">def</span> <span class="nf">goto_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set focus position to load position.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         z_load: load position in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;goto_load&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">z_load</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">move_focus_to_load</span><span class="p">()</span>
        <span class="c1"># check if load was set. If not, ask user to set load</span>
        <span class="k">except</span> <span class="n">LoadNotDefinedError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="c1"># add focus drive instance to exception</span>
            <span class="k">raise</span> <span class="n">LoadNotDefinedError</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">error_component</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">z_load</span></div>

<div class="viewcode-block" id="FocusDrive.goto_work"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.FocusDrive.goto_work">[docs]</a>    <span class="k">def</span> <span class="nf">goto_work</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set focus position to work position.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         z_work: work position in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;goto_work&quot;</span><span class="p">)</span>
        <span class="n">z_work</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">move_focus_to_work</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">z_work</span></div>

<div class="viewcode-block" id="FocusDrive.define_load_position"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.FocusDrive.define_load_position">[docs]</a>    <span class="k">def</span> <span class="nf">define_load_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define current focus position as load position for focus drive.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         z_load: load postion in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;define_load_position&quot;</span><span class="p">)</span>
        <span class="n">z_load</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">set_focus_load_position</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_load</span> <span class="o">=</span> <span class="n">z_load</span>
        <span class="k">return</span> <span class="n">z_load</span></div>

<div class="viewcode-block" id="FocusDrive.get_load_position"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.FocusDrive.get_load_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_load_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get load position for focus drive.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         z_load: load position in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_load_position&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_load</span></div>

<div class="viewcode-block" id="FocusDrive.define_work_position"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.FocusDrive.define_work_position">[docs]</a>    <span class="k">def</span> <span class="nf">define_work_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define current focus position as work position for focus drive.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         z_work: load postion in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;define_work_position&quot;</span><span class="p">)</span>
        <span class="n">z_work</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">set_focus_work_position</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_work</span> <span class="o">=</span> <span class="n">z_work</span>
        <span class="k">return</span> <span class="n">z_work</span></div>

<div class="viewcode-block" id="FocusDrive.get_work_position"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.FocusDrive.get_work_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_work_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get work position for focus drive.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         z_work: load position in mum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_work_position&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_work</span></div></div>


<span class="c1">################################################################################</span>


<div class="viewcode-block" id="AutoFocus"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus">[docs]</a><span class="k">class</span> <span class="nc">AutoFocus</span><span class="p">(</span><span class="n">MicroscopeComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and operate hardware autofocus.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">auto_focus_id</span><span class="p">,</span>
        <span class="n">default_camera</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">objective_changer_instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">default_reference_position</span><span class="o">=</span><span class="p">[[</span><span class="mi">50000</span><span class="p">,</span> <span class="mi">37000</span><span class="p">,</span> <span class="mi">6900</span><span class="p">]],</span>
        <span class="n">microscope_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Describe and operate hardware autofocus.</span>

<span class="sd">        Input:</span>
<span class="sd">         auto_focus_id: string with unique autofocus id</span>

<span class="sd">         init_experiment: experiment used for live mode during auto-focus</span>

<span class="sd">         default_camera: camera used for live mode during auto-focus</span>

<span class="sd">         objective_changer_instance: instance of class ObjectiveChanger</span>
<span class="sd">         which is connected to this autofocus</span>

<span class="sd">         default_reference_position: reference position to set parfocality and</span>
<span class="sd">         parcentricity. Used if no reference object (e.g. well center) is used.</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__init__&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AutoFocus</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">auto_focus_id</span><span class="p">)</span>

        <span class="c1"># enable auto focus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_autofocus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_use_autofocus</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># settings during operation</span>
        <span class="c1">#         self.set_init_experiment(init_experiment)</span>

        <span class="k">if</span> <span class="n">default_camera</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">default_camera</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_camera</span> <span class="o">=</span> <span class="n">default_camera</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">use_live_mode</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># object from class ImagingSystem (module samples.py)</span>
        <span class="c1"># that is used as reference (zero plane) for autofocus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus_reference_obj_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer_instance</span> <span class="o">=</span> <span class="n">objective_changer_instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_objective</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_reference_position</span> <span class="o">=</span> <span class="n">default_reference_position</span>

        <span class="c1"># Save position when autofocus was initialized the first time.</span>
        <span class="c1"># This value is used to correct for focus drift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_autofocus_position</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Store difference between _initial_autofocus_position</span>
        <span class="c1"># and autofocus position from &#39;Recall Focus&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_delta_z</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span> <span class="o">=</span> <span class="n">microscope_object</span>

<div class="viewcode-block" id="AutoFocus.get_init_experiment"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.get_init_experiment">[docs]</a>    <span class="k">def</span> <span class="nf">get_init_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get experiment used for initialization based on current objective.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         init_experiment: string with name of experiment used for initialization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_init_experiment&quot;</span><span class="p">)</span>
        <span class="c1"># connect to associated objective changer and retrieve current objective</span>
        <span class="c1"># retrieve init_experiment for this objective</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">init_experiment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer_instance</span><span class="o">.</span><span class="n">get_information</span><span class="p">(</span>
                <span class="n">communication_object</span>
            <span class="p">)[</span><span class="s2">&quot;experiment&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">init_experiment</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Not defined&quot;</span></div>

<div class="viewcode-block" id="AutoFocus.initialize"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">communication_object</span><span class="p">,</span>
        <span class="n">action_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;find_surface&quot;</span><span class="p">],</span>
        <span class="n">reference_object_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize auto-focus (default: do nothing if already initialized).</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         action_list: if list includes &#39;no_find_surface&#39; auto-focus will not try</span>
<span class="sd">         to find cover slip before operator refocuses</span>

<span class="sd">         no_interaction: no user interaction, no live image</span>

<span class="sd">         force_initialization: initialize even if already initialized.</span>
<span class="sd">         If empty no action</span>

<span class="sd">         sample_object: ID of plate, plate holder or other sample object</span>
<span class="sd">         the hardware is initialized for. Used for setting up of autofocus</span>

<span class="sd">         verbose: if True, print debug messages (Default: True)</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;initialize&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action_list</span><span class="p">:</span>
            <span class="c1"># if auto-focus is already initialized,</span>
            <span class="c1"># initialize only if &#39;force_initialization&#39; is set in action_list</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_autofocus_ready</span><span class="p">(</span><span class="n">communication_object</span><span class="p">)</span>
                <span class="ow">or</span> <span class="s2">&quot;force_initialization&quot;</span> <span class="ow">in</span> <span class="n">action_list</span>
            <span class="p">):</span>
                <span class="c1"># if auto-focus was on, switch off autofocus</span>
                <span class="n">auto_focus_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_autofocus</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_use_autofocus</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">if</span> <span class="s2">&quot;no_interaction&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action_list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">setup_microscope_for_initialization</span><span class="p">(</span>
                        <span class="n">component_object</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">experiment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_init_experiment</span><span class="p">(</span><span class="n">communication_object</span><span class="p">),</span>
                        <span class="n">before_initialization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">reference_object_id</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">microscope_is_ready</span><span class="p">(</span>
                            <span class="n">experiment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_init_experiment</span><span class="p">(</span><span class="n">communication_object</span><span class="p">),</span>
                            <span class="n">component_dict</span><span class="o">=</span><span class="p">{</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_objective_changer_id</span><span class="p">(</span>
                                    <span class="n">reference_object_id</span>
                                <span class="p">):</span> <span class="p">[]</span>
                            <span class="p">},</span>
                            <span class="n">focus_drive_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_focus_id</span><span class="p">(</span>
                                <span class="n">reference_object_id</span>
                            <span class="p">),</span>
                            <span class="n">objective_changer_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_objective_changer_id</span><span class="p">(</span>  <span class="c1"># noqa</span>
                                <span class="n">reference_object_id</span>
                            <span class="p">),</span>
                            <span class="n">safety_object_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">_get_safety_id</span><span class="p">(</span>
                                <span class="n">reference_object_id</span>
                            <span class="p">),</span>
                            <span class="n">reference_object_id</span><span class="o">=</span><span class="n">reference_object_id</span><span class="p">,</span>
                            <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">make_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="s2">&quot;no_find_surface&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action_list</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_surface</span><span class="p">(</span><span class="n">communication_object</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">message</span><span class="o">.</span><span class="n">operate_message</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Please focus on top of cover slip.&quot;</span><span class="p">,</span>
                            <span class="n">return_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">message</span><span class="o">.</span><span class="n">operate_message</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;1) Bring the objective to focus position using the TFT</span><span class="se">\n</span><span class="s2">2) Click Find Surface in ZenBlue&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
                            <span class="n">return_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">microscope_object</span><span class="o">.</span><span class="n">setup_microscope_for_initialization</span><span class="p">(</span>
                        <span class="n">component_object</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">experiment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_init_experiment</span><span class="p">(</span><span class="n">communication_object</span><span class="p">),</span>
                        <span class="n">before_initialization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">_z_abs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_focus</span><span class="p">(</span>
                    <span class="n">communication_object</span><span class="p">,</span> <span class="n">focus_reference_obj_id</span><span class="o">=</span><span class="n">reference_object_id</span>
                <span class="p">)</span>

                <span class="c1"># Save position when autofocus was initialized the first time.</span>
                <span class="c1"># This value is used to correct for focus drift</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initial_autofocus_position</span> <span class="o">=</span> <span class="n">_z_abs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_use_autofocus</span><span class="p">(</span><span class="n">auto_focus_status</span><span class="p">)</span></div>

<div class="viewcode-block" id="AutoFocus.get_information"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.get_information">[docs]</a>    <span class="k">def</span> <span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get status of auto-focus.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         positions_dict: dictionary with focus position in mum of the form:</span>
<span class="sd">          {&#39;absolute&#39;: z_abs, &#39;focality_corrected&#39;: z_cor}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_information&quot;</span><span class="p">)</span>
        <span class="n">autofocus_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;initial_focus&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_autofocus_position</span><span class="p">,</span>
            <span class="s2">&quot;use&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_use_autofocus</span><span class="p">(),</span>
            <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_init_experiment</span><span class="p">(</span><span class="n">communication_object</span><span class="p">),</span>
            <span class="s2">&quot;camera&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_camera</span><span class="p">,</span>
            <span class="s2">&quot;live_mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_live_mode</span><span class="p">,</span>
            <span class="s2">&quot;reference_object_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_focus_reference_obj_id</span><span class="p">(),</span>
            <span class="s2">&quot;delta_z&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_delta_z</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">autofocus_info</span></div>

<div class="viewcode-block" id="AutoFocus.set_component"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.set_component">[docs]</a>    <span class="k">def</span> <span class="nf">set_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Switch on/off the use of auto-focus</span>

<span class="sd">        Input:</span>
<span class="sd">         settings: dictionary {use_auto_focus: True/False}.</span>
<span class="sd">         If empty do not change setting</span>

<span class="sd">        Output:</span>
<span class="sd">         new_settings: dictionary with updated status</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;set_component&quot;</span><span class="p">)</span>
        <span class="n">new_settings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">settings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_use_autofocus</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;use_auto_focus&quot;</span><span class="p">])</span>
        <span class="n">new_settings</span><span class="p">[</span><span class="s2">&quot;use_auto_focus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_autofocus</span>
        <span class="k">return</span> <span class="n">new_settings</span></div>

<div class="viewcode-block" id="AutoFocus.set_use_autofocus"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.set_use_autofocus">[docs]</a>    <span class="k">def</span> <span class="nf">set_use_autofocus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set flag to enable the use of autofocus.</span>
<span class="sd">        If no autofocus position is stored, store current position.</span>

<span class="sd">        Input:</span>
<span class="sd">         flag: if True, use autofocus</span>

<span class="sd">        Output:</span>
<span class="sd">         use_autofocus: status of use_autofocus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;set_use_autofocus&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_autofocus</span> <span class="o">=</span> <span class="n">flag</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_autofocus</span></div>

<div class="viewcode-block" id="AutoFocus.get_use_autofocus"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.get_use_autofocus">[docs]</a>    <span class="k">def</span> <span class="nf">get_use_autofocus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return flag about autofocus usage</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         use_autofocus: boolean varaible indicating if autofocus should be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_use_autofocus&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_autofocus</span></div>

<div class="viewcode-block" id="AutoFocus.get_autofocus_ready"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.get_autofocus_ready">[docs]</a>    <span class="k">def</span> <span class="nf">get_autofocus_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if auto-focus is ready</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         is_ready: True, if auto-focus is ready</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_autofocus_ready&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">is_ready</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">get_autofocus_ready</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">AutofocusError</span><span class="p">:</span>
            <span class="n">is_ready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">is_ready</span></div>

<div class="viewcode-block" id="AutoFocus.find_surface"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.find_surface">[docs]</a>    <span class="k">def</span> <span class="nf">find_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find cover slip using Definite Focus 2. Does not store found position.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         z: position of focus drive after find surface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;find_surface&quot;</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">find_surface</span><span class="p">()</span>
        <span class="c1">#         self.store_focus()</span>
        <span class="k">return</span> <span class="n">z</span></div>

<div class="viewcode-block" id="AutoFocus.set_focus_reference_obj_id"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.set_focus_reference_obj_id">[docs]</a>    <span class="k">def</span> <span class="nf">set_focus_reference_obj_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus_reference_obj_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set object from class ImagingSystem (module samples)</span>
<span class="sd">        used as zero plane for autofocus.</span>

<span class="sd">        Input:</span>
<span class="sd">         focus_reference_obj_id: Sample object used as reference for autofocus</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;set_focus_reference_obj_id&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus_reference_obj_id</span> <span class="o">=</span> <span class="n">focus_reference_obj_id</span></div>

<div class="viewcode-block" id="AutoFocus.get_focus_reference_obj_id"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.get_focus_reference_obj_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_focus_reference_obj_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get object from class ImagingSystem (module samples)</span>
<span class="sd">        used as zero plane for autofocus.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         focus_reference_obj_id: Sample object used as reference for autofocus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_focus_reference_obj_id&quot;</span><span class="p">)</span>
        <span class="n">focus_reference_obj_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_reference_obj_id</span>
        <span class="k">return</span> <span class="n">focus_reference_obj_id</span></div>

<div class="viewcode-block" id="AutoFocus.store_focus"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.store_focus">[docs]</a>    <span class="k">def</span> <span class="nf">store_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">,</span> <span class="n">focus_reference_obj_id</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store actual focus position as offset from coverslip.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         focus_reference_obj_id: ID of Sample object used as reference for autofocus</span>

<span class="sd">        Output:</span>
<span class="sd">         z: position of focus drive after store focus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;store_focus&quot;</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">store_focus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_focus_reference_obj_id</span><span class="p">(</span><span class="n">focus_reference_obj_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_objective</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objective_changer_instance</span><span class="o">.</span><span class="n">get_objective_information</span><span class="p">(</span>
                <span class="n">communication_object</span>
            <span class="p">)[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Autofocus position </span><span class="si">{}</span><span class="s2"> stored for </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_objective</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">z</span></div>

<div class="viewcode-block" id="AutoFocus.recall_focus"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.AutoFocus.recall_focus">[docs]</a>    <span class="k">def</span> <span class="nf">recall_focus</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">communication_object</span><span class="p">,</span>
        <span class="n">reference_object_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">pre_set_focus</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find difference between stored focus position and actual autofocus position.</span>
<span class="sd">        Recall focus will move the focus drive to it&#39;s stored position.</span>
<span class="sd">        Will try to recover if  autofocus failed.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">         reference_object_id: ID of object of Sample class used to correct for xyz</span>
<span class="sd">         offset between different objectives</span>

<span class="sd">         verbose: if True, print debug messages (Default: False)</span>

<span class="sd">         pre_set_focus: Move focus to previous auto-focus position.</span>
<span class="sd">         This makes definite focus more robust</span>

<span class="sd">        Output:</span>
<span class="sd">         delta_z: difference between stored z position of focus drive</span>
<span class="sd">         and position after recall focus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;recall_focus&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_use_autofocus</span><span class="p">():</span>
            <span class="c1"># Get store difference between _initial_autofocus_position</span>
            <span class="c1"># and autofocus position from last &#39;Recall Focus&#39;</span>
            <span class="n">delta_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_delta_z</span>
            <span class="k">return</span> <span class="n">delta_z</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">recall_focus</span><span class="p">(</span><span class="n">pre_set_focus</span><span class="o">=</span><span class="n">pre_set_focus</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;From hardware.FocusDrive.recall_focus: recall_focus = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">AutofocusNotSetError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AutofocusNotSetError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                <span class="n">error_component</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">focus_reference_obj_id</span><span class="o">=</span><span class="n">reference_object_id</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">AutofocusObjectiveChangedError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AutofocusObjectiveChangedError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                <span class="n">error_component</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">focus_reference_obj_id</span><span class="o">=</span><span class="n">reference_object_id</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">AutofocusError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">log_warning</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;recall_focus&quot;</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">communication_object</span><span class="o">.</span><span class="n">recover_focus</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;From hardware.FocusDrive.recall_focus: recover_focus = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">z</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_focus</span><span class="p">(</span>
                <span class="n">communication_object</span><span class="p">,</span> <span class="n">focus_reference_obj_id</span><span class="o">=</span><span class="n">reference_object_id</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;From hardware.FocusDrive.recall_focus: store_focus = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">log_message</span><span class="p">(</span><span class="s2">&quot;Autofocus recoverd at </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="s2">&quot;recall_focus&quot;</span><span class="p">)</span>

        <span class="c1"># _initial_autofocus_position was saved position</span>
        <span class="c1"># when autofocus was initialized the first time.</span>
        <span class="c1"># delta_z is the difference between the recalled z-position and</span>
        <span class="c1"># the saved position and is identical to focus drift or non-even sample</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_autofocus_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">delta_z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_autofocus_position</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_z</span> <span class="o">=</span> <span class="n">z</span>

        <span class="c1"># Store delta_z as backup if auto focus should not be used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_delta_z</span> <span class="o">=</span> <span class="n">delta_z</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;From hardware.FocusDrive.recall_focus: _initial_autofocus_position, = </span><span class="si">{}</span><span class="s2">, delta = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>  <span class="c1"># noqa</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_autofocus_position</span><span class="p">,</span> <span class="n">delta_z</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">log_message</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;Autofocus original position in hardware </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Autofocus new position in hardware </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Autofocus delta position in hardware </span><span class="si">{}</span><span class="s2">&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_initial_autofocus_position</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">delta_z</span><span class="p">),</span>
            <span class="n">methodName</span><span class="o">=</span><span class="s2">&quot;recall_focus&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">delta_z</span></div></div>


<span class="c1">################################################################################</span>

<span class="c1">################################################################################</span>


<div class="viewcode-block" id="Pump"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Pump">[docs]</a><span class="k">class</span> <span class="nc">Pump</span><span class="p">(</span><span class="n">MicroscopeComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to describe and operate pump&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pump_id</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;COM1&quot;</span><span class="p">,</span> <span class="n">baudrate</span><span class="o">=</span><span class="mi">19200</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Describe and operate pump.</span>

<span class="sd">        Input:</span>
<span class="sd">         pump_id: string with unique stage id</span>

<span class="sd">         seconds: the number of seconds pump is activated</span>

<span class="sd">         port: com port, default = &#39;COM1&#39;</span>

<span class="sd">         baudrate: baudrate for connection, can be set on pump, typically = 19200</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__init__&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Pump</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">pump_id</span><span class="p">)</span>
        <span class="c1">#         self.pump=pumpObject.pump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_connection</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">baudrate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_time</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>

<div class="viewcode-block" id="Pump.set_connection"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Pump.set_connection">[docs]</a>    <span class="k">def</span> <span class="nf">set_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">baudrate</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set communication parameters for pump.</span>

<span class="sd">        Input:</span>
<span class="sd">         port: com port, default = &#39;COM1&#39;</span>

<span class="sd">         baudrate: baudrate for connection, can be set on pump, typically = 19200</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;set_connection&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baudrate</span> <span class="o">=</span> <span class="n">baudrate</span></div>

<div class="viewcode-block" id="Pump.get_connection"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Pump.get_connection">[docs]</a>    <span class="k">def</span> <span class="nf">get_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get communication parameters for pump.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         conPar: dictionary with</span>
<span class="sd">          port: com port, default = &#39;COM1&#39;</span>

<span class="sd">          baudrate: baudrate for connection, can be set on pump, typically = 19200</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_connection&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baudrate</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pump.set_time"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Pump.set_time">[docs]</a>    <span class="k">def</span> <span class="nf">set_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set time pump is activated.</span>

<span class="sd">        Input:</span>
<span class="sd">         seconds: time in seconds</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;set_time&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">seconds</span></div>

<div class="viewcode-block" id="Pump.get_time"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Pump.get_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get communication parameters for pump.</span>

<span class="sd">        Input:</span>
<span class="sd">         none</span>

<span class="sd">        Output:</span>
<span class="sd">         seconds: time in seconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_time&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span></div>

<div class="viewcode-block" id="Pump.trigger_pump"><a class="viewcode-back" href="../../../microscope_automation.hardware.html#microscope_automation.hardware.hardware_components.Pump.trigger_pump">[docs]</a>    <span class="k">def</span> <span class="nf">trigger_pump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">communication_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Trigger pump.</span>

<span class="sd">        Input:</span>
<span class="sd">         communication_object: Object that connects to microscope specific software</span>

<span class="sd">        Output:</span>
<span class="sd">         none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;trigger_pump&quot;</span><span class="p">)</span>
        <span class="n">con_par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="n">communication_object</span><span class="o">.</span><span class="n">trigger_pump</span><span class="p">(</span>
            <span class="n">seconds</span><span class="o">=</span><span class="n">seconds</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">con_par</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">baudrate</span><span class="o">=</span><span class="n">con_par</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Microscope Automation</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html#packaging-the-zip">Packaging the ZIP</a></li>
</ul>
<p class="caption"><span class="caption-text">Orchestrator</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../find_positions.html">find_positions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../microscope_automation.html">microscope_automation package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../write_zen_tiles_experiment.html">write_zen_tiles_experiment</a></li>
</ul>
<p class="caption"><span class="caption-text">Hardware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_components.html">hardware_components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_control.html">hardware_control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_control_3i.html">hardware_control_3i</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_control_zeiss.html">hardware_control_zeiss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../RS232.html">RS232</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../setup_microscope.html">setup_microscope</a></li>
</ul>
<p class="caption"><span class="caption-text">Samples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../correct_background.html">correct_background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../draw_plate.html">draw_plate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../find_well_center.html">find_well_center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../find_cells.html">find_cells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interactive_location_picker_pyqtgraph.html">interactive_location_picker_pyqtgraph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../positions_list.html">positions_list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples.html">samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../setup_samples.html">setup_samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tile_images.html">tile_images</a></li>
</ul>
<p class="caption"><span class="caption-text">Connectors</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../connect_slidebook.html">connect_slidebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../connect_zen_blue.html">connect_zen_blue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../connect_zen_black.html">connect_zen_black</a></li>
</ul>
<p class="caption"><span class="caption-text">Settings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../meta_data_file.html">meta_data_file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../preferences.html">preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../slidebook_experiment_info.html">slidebook_experiment_info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zen_experiment_info.html">zen_experiment_info</a></li>
</ul>
<p class="caption"><span class="caption-text">Utility</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../automation_exceptions.html">automation_exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../automation_messages_form_layout.html">automation_messages_form_layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../error_handling.html">error_handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_path.html">get_path</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../image_AICS.html">image_AICS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../load_image_czi.html">load_image_czi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software_state.html">software_state</a></li>
</ul>
<p class="caption"><span class="caption-text">Import Helpers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intelligent_imaging_innovations.html">3i Imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zeiss.html">Zeiss Imports</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTRIBUTING.html">Allen Institute Contribution Agreement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../LICENSE.html">LICENSE</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../microscope_automation.html">microscope_automation</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Allen Institute.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>