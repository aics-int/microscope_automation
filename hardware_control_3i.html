
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hardware_control_3i &#8212; Microscope Automation 0.0 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="connect_slidebook" href="connect_slidebook.html" />
    <link rel="prev" title="zen_experiment_info" href="zen_experiment_info.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#hardware-control-3i" id="id2">hardware_control_3i</a></p>
<ul>
<li><p><a class="reference internal" href="#class-spinningdisk3i-basemicroscope" id="id3">class SpinningDisk3i(BaseMicroscope)</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="hardware-control-3i">
<span id="id1"></span><h1><a class="toc-backref" href="#id2">hardware_control_3i</a><a class="headerlink" href="#hardware-control-3i" title="Permalink to this headline">¶</a></h1>
<p>This module contains the class to control specific hardware for 3i Microscopes.
This class is the link between the workflow and sample components of the Microscope Automation Software.
It extends <a class="reference internal" href="hardware_control.html#hardware-control-basemicroscope"><span class="std std-ref">class BaseMicroscope(object)</span></a></p>
<p>The class uses an API to interact with <a class="reference internal" href="connect_slidebook.html#connect-slidebook"><span class="std std-ref">connect_slidebook</span></a>.
We strongly recommend to always access hardware functionality through
the API exposed by <a class="reference internal" href="#hardware-control-3i"><span class="std std-ref">hardware_control_3i</span></a>.</p>
<p>The classes are built around a list of objects of <a class="reference internal" href="hardware_components.html#hardware-components-microscopecomponent"><span class="std std-ref">class MicroscopeComponent(object)</span></a>.
These objects are defined in module <a class="reference internal" href="hardware_components.html#hardware-components"><span class="std std-ref">hardware_components</span></a>.
Most of these objects implement methods to control the hardware and store its
state.</p>
<div class="section" id="class-spinningdisk3i-basemicroscope">
<span id="hardware-control-3i-spinningdisk3i"></span><h2><a class="toc-backref" href="#id3">class SpinningDisk3i(BaseMicroscope)</a><a class="headerlink" href="#class-spinningdisk3i-basemicroscope" title="Permalink to this headline">¶</a></h2>
<p>Class to control a 3i spinning disk microscope with a CSU-W1 confocal head
from Yokogawa using the vendor software, Slidebook. Slidebook does not allow a
direct external control of microscope hardware components. Instead, 3i provided
a custom modification of their hierarchical and conditional capture functionality
to the Allen Institute for Cell Science.</p>
<p>This allows to call MATLAB functions of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="p">[</span><span class="n">N</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">P</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_locations_of_interest</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span>
                                                   <span class="n">xy_pixel_size</span><span class="p">,</span>
                                                   <span class="n">z_spacing</span><span class="p">,</span>
                                                   <span class="n">x_stage_direction</span><span class="p">,</span>
                                                   <span class="n">y_stage_direction</span><span class="p">,</span>
                                                   <span class="n">z_stage_direction</span><span class="p">)</span>
</pre></div>
</div>
<p>after a hierarchical capture or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">is_continue</span> <span class="o">=</span> <span class="n">continue_time_lapse</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
</pre></div>
</div>
<p>after a time lapse capture.</p>
<p>The function called after a hierarchical
capture can return a list with new imaging positions and “capture
settings” that describe experiments to be performed at these locations.
“Capture settings” are defined through a graphical user interface
within Slidebook and are saved to disk at the microscope control computer.
They are equivalient to “experiments” within Zeiss ZEN blue software.</p>
<p>Microservices <a class="reference internal" href="connect_slidebook.html#commands-service"><span class="std std-ref">commands_service</span></a> and <a class="reference internal" href="connect_slidebook.html#data-service"><span class="std std-ref">data_service</span></a>
facilitate the communication between <a class="reference internal" href="#hardware-control-3i-spinningdisk3i"><span class="std std-ref">class SpinningDisk3i(BaseMicroscope)</span></a>
and the Slidebook software that controls the 3i spinning disk microscope.</p>
<ul class="simple">
<li><p><a class="reference internal" href="connect_slidebook.html#commands-service"><span class="std std-ref">commands_service</span></a> implements a queue with
commands to be executed by the microscope. <cite>SpinningDisk3i</cite> writes
to this queue and the MATLAB code invoked by Slidebook pulls
from it.</p></li>
<li><p><a class="reference internal" href="connect_slidebook.html#data-service"><span class="std std-ref">data_service</span></a> implements a queue with image
data from the microscope. Slidebook writes to this queue and
<a class="reference internal" href="#hardware-control-3i-spinningdisk3i"><span class="std std-ref">class SpinningDisk3i(BaseMicroscope)</span></a> pulls from it.
Other microservices (at this moment mainly for visualizations and position selection)
can pull from the queue.</p></li>
</ul>
<p>The <a class="reference internal" href="#hardware-control-3i-spinningdisk3i"><span class="std std-ref">class SpinningDisk3i(BaseMicroscope)</span></a> uses objects from
<a class="reference internal" href="hardware_components.html#hardware-components"><span class="std std-ref">hardware_components</span></a> that call the Slidebook specific
<a class="reference internal" href="connect_slidebook.html#connect-slidebook-connectmicroscope"><span class="std std-ref">class ConnectMicroscope()</span></a> as defined in the module
<a class="reference internal" href="connect_slidebook.html#connect-slidebook"><span class="std std-ref">connect_slidebook</span></a>.</p>
<p>The most important methods are:</p>
<dl class="py function">
<dt id="microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.add_control_software">
<code class="sig-prename descclassname">microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.</code><code class="sig-name descname">add_control_software</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em>, <em class="sig-param"><span class="n">control_software_object</span></em><span class="sig-paren">)</span><a class="headerlink" href="#microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.add_control_software" title="Permalink to this definition">¶</a></dt>
<dd><p>Add object that connects this code to the  vendor specific microscope
control code to Microscope.</p>
<dl class="simple">
<dt>Input:</dt><dd><p>controlSoftwareObject: single object connecting to vendor software</p>
</dd>
<dt>Output:</dt><dd><p>none</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.add_microscope_object">
<code class="sig-prename descclassname">microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.</code><code class="sig-name descname">add_microscope_object</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em>, <em class="sig-param"><span class="n">component_objects</span></em><span class="sig-paren">)</span><a class="headerlink" href="#microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.add_microscope_object" title="Permalink to this definition">¶</a></dt>
<dd><p>Add component to microscope.</p>
<dl class="simple">
<dt>Input:</dt><dd><p>component_objects: object of a component class (e.g. Stage, Camera)
or list of component classes</p>
</dd>
<dt>Output:</dt><dd><p>none</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.create_experiment_path">
<code class="sig-prename descclassname">microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.</code><code class="sig-name descname">create_experiment_path</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em>, <em class="sig-param"><span class="n">experiment</span></em><span class="sig-paren">)</span><a class="headerlink" href="#microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.create_experiment_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates complete path to capture settings (Slidebook).
Raises exception if experiment does not exist.</p>
<dl class="simple">
<dt>Input:</dt><dd><p>experiment: string with name of capture settings
(with or w/o extension .exp.prefs)</p>
</dd>
<dt>Output:</dt><dd><p>experiment_path: path to experiment or capture settings</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.execute_experiment">
<code class="sig-prename descclassname">microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.</code><code class="sig-name descname">execute_experiment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em>, <em class="sig-param"><span class="n">capture_settings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">file_path</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">position_list</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">interactive</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.execute_experiment" title="Permalink to this definition">¶</a></dt>
<dd><p>Trigger microscope to execute experiment defined within vendor software.
Class ImageAICS is a container for meta and image data.
To add image data use method load_image.
Do not try to recover from exceptions on this level.</p>
<dl>
<dt>Input:</dt><dd><p>capture_settings: string or list of strings with names of capture settings
as defined within 3i Slidebook software. If one capture setting is provided
execute same settings at all positions. If list with capture settings is
provided, execute each setting on each position. The number of positions
has to be identical as the number of capture strings.</p>
<p>file_path: string with path to save image to. Do not save if None (default)</p>
<p>position_list: list with stage coordinates for images</p>
<p>interactive: if True, allow user to modify file name if file exists</p>
</dd>
<dt>Output:</dt><dd><p>image: image of class ImageAICS to hold metadata.
Does not contain image data at this moment.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.load_image">
<code class="sig-prename descclassname">microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.</code><code class="sig-name descname">load_image</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em>, <em class="sig-param"><span class="n">image</span></em>, <em class="sig-param"><span class="n">get_meta</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.load_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Load image and return it as class ImageAICS.
Methods ads image and meta data to image.
Methods passes load image to microscope specific load method.</p>
<dl>
<dt>Input:</dt><dd><p>communication_object: Object that connects to microscope specific software</p>
<p>image: image object of class ImageAICS.
Holds meta data at this moment, no image data.</p>
<p>get_meta: if true, retrieve meta data from file. Default is False</p>
</dd>
<dt>Output:</dt><dd><p>image: image with data and meta data as ImageAICS class</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.move_to_abs_pos">
<code class="sig-prename descclassname">microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.</code><code class="sig-name descname">move_to_abs_pos</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em>, <em class="sig-param"><span class="n">stage_id</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">focus_drive_id</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">objective_changer_id</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">auto_focus_id</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">safety_id</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">safe_area</span><span class="o">=</span><span class="default_value">'Compound'</span></em>, <em class="sig-param"><span class="n">x_target</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">y_target</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">z_target</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">z_focus_preset</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">reference_object_id</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">load</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">trials</span><span class="o">=</span><span class="default_value">3</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.move_to_abs_pos" title="Permalink to this definition">¶</a></dt>
<dd><p>Move stage and focus drive to position (x, y, z)
in absolute system coordinates.</p>
<dl>
<dt>Input:</dt><dd><p>stage_id, focus_drive_id: strings to identify stage and focus drive</p>
<p>objective_changer_id: string to identify objective changer</p>
<p>safety_id: string to identify safety object</p>
<p>safe_area: name of safe area withing safety object
(default: ‘compound’ = combine all areas)</p>
<p>x_target, y_target: coordinates of stage after movement
(none = do not move stage)</p>
<p>z_target: coordinate for focus position after movement
(none = do not move focus, but engage auto-focus)</p>
<p>z_focus_preset: z position for focus before focus recall
to make autofocus more reliable. (Default: None, do not use feature)</p>
<p>reference_object_id: ID of object of Sample class used to correct for xyz
offset between different objectives</p>
<p>load: Move focus in load position before move. Default: True</p>
<p>trials: number of trials to retrieve z position before procedure is aborted</p>
</dd>
<dt>Ouput:</dt><dd><p>x_final, y_final, z_final: coordinates after move</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.remove_images">
<code class="sig-prename descclassname">microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.</code><code class="sig-name descname">remove_images</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span><a class="headerlink" href="#microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.remove_images" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all images from queue on data service.</p>
<dl class="simple">
<dt>Input:</dt><dd><p>communication_object: Object that connects to microscope specific software</p>
</dd>
<dt>Output:</dt><dd><p>none</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.stop_microscope">
<code class="sig-prename descclassname">microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.</code><code class="sig-name descname">stop_microscope</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span><a class="headerlink" href="#microscope_automation.slidebook.hardware_control_3i.SpinningDisk3i.stop_microscope" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop Microscope immediately in emergency situation</p>
<dl class="simple">
<dt>Input:</dt><dd><p>none</p>
</dd>
<dt>Output:</dt><dd><p>none</p>
</dd>
</dl>
</dd></dl>

</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Microscope Automation</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Hardware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hardware_components.html">hardware_components</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_control.html">hardware_control</a></li>
<li class="toctree-l1"><a class="reference internal" href="RS232.html">RS232</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup_microscope.html">setup_microscope</a></li>
</ul>
<p class="caption"><span class="caption-text">Samples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="correct_background.html">correct_background</a></li>
<li class="toctree-l1"><a class="reference internal" href="draw_plate.html">draw_plate</a></li>
<li class="toctree-l1"><a class="reference internal" href="find_well_center.html">find_well_center</a></li>
<li class="toctree-l1"><a class="reference internal" href="find_cells.html">find_cells</a></li>
<li class="toctree-l1"><a class="reference internal" href="interactive_location_picker_pyqtgraph.html">interactive_location_picker_pyqtgraph</a></li>
<li class="toctree-l1"><a class="reference internal" href="positions_list.html">positions_list</a></li>
<li class="toctree-l1"><a class="reference internal" href="samples.html">samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup_samples.html">setup_samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="tile_images.html">tile_images</a></li>
</ul>
<p class="caption"><span class="caption-text">Zeiss Microscopes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="connect_zen_blue.html">connect_zen_blue</a></li>
<li class="toctree-l1"><a class="reference internal" href="connect_zen_black.html">connect_zen_black</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_control_zeiss.html">hardware_control_zeiss</a></li>
<li class="toctree-l1"><a class="reference internal" href="write_zen_tiles_experiment.html">write_zen_tiles_experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="zen_experiment_info.html">zen_experiment_info</a></li>
</ul>
<p class="caption"><span class="caption-text">3i Microscopes</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">hardware_control_3i</a></li>
<li class="toctree-l1"><a class="reference internal" href="connect_slidebook.html">connect_slidebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="slidebook_experiment_info.html">slidebook_experiment_info</a></li>
</ul>
<p class="caption"><span class="caption-text">General Methods</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="automation_exceptions.html">automation_exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="automation_messages_form_layout.html">automation_messages_form_layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="error_handling.html">error_handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="get_path.html">get_path</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_AICS.html">image_AICS</a></li>
<li class="toctree-l1"><a class="reference internal" href="load_image_czi.html">load_image_czi</a></li>
<li class="toctree-l1"><a class="reference internal" href="meta_data_file.html">meta_data_file</a></li>
<li class="toctree-l1"><a class="reference internal" href="preferences.html">preferences</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Allen Institute Contribution Agreement</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">LICENSE</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="zen_experiment_info.html" title="previous chapter">zen_experiment_info</a></li>
      <li>Next: <a href="connect_slidebook.html" title="next chapter">connect_slidebook</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Allen Institute.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/hardware_control_3i.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>